{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\components\\\\ImageSearchUpload.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef } from 'react';\nimport Icon from './Icon';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ImageSearchUpload({\n  endpoint = 'http://localhost:8000/api/search/image/',\n  k = 48,\n  label = 'Tìm bằng ảnh',\n  onStart,\n  onFinish,\n  onResults,\n  onError,\n  className = 'btn btn-primary',\n  icon = 'image'\n}) {\n  _s();\n  const inputRef = useRef(null);\n  async function handleChange(e) {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    try {\n      var _json;\n      onStart === null || onStart === void 0 ? void 0 : onStart();\n      const fd = new FormData();\n      fd.append('file', file);\n      const res = await fetch(`${endpoint}?k=${k}`, {\n        method: 'POST',\n        body: fd\n      });\n      const text = await res.text();\n      let json = {};\n      try {\n        json = JSON.parse(text);\n      } catch {/* HTML error page */}\n      if (!res.ok) throw new Error(((_json = json) === null || _json === void 0 ? void 0 : _json.error) || `HTTP ${res.status}`);\n      const results = Array.isArray(json.results) ? json.results : [];\n      const mapped = results.map(p => ({\n        ...p,\n        image: p.image || p.image_url || ''\n      }));\n      onResults === null || onResults === void 0 ? void 0 : onResults(mapped);\n    } catch (err) {\n      console.error(err);\n      onError === null || onError === void 0 ? void 0 : onError(String((err === null || err === void 0 ? void 0 : err.message) || 'Tìm kiếm bằng ảnh thất bại.'));\n    } finally {\n      onFinish === null || onFinish === void 0 ? void 0 : onFinish();\n      if (inputRef.current) inputRef.current.value = '';\n    }\n  }\n  const content = typeof label === 'string' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [icon && /*#__PURE__*/_jsxDEV(Icon, {\n      name: icon,\n      size: 16,\n      style: {\n        marginRight: 6\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 20\n    }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n      children: label\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 11\n    }, this)]\n  }, void 0, true) : label;\n  return /*#__PURE__*/_jsxDEV(\"label\", {\n    className: className,\n    style: {\n      cursor: 'pointer',\n      display: 'inline-flex',\n      alignItems: 'center',\n      gap: 6\n    },\n    children: [content, /*#__PURE__*/_jsxDEV(\"input\", {\n      ref: inputRef,\n      type: \"file\",\n      accept: \"image/*\",\n      style: {\n        display: 'none'\n      },\n      onChange: handleChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }, this);\n}\n_s(ImageSearchUpload, \"iD9XNNsNOlNDckBemnvlLS+aHYk=\");\n_c = ImageSearchUpload;\nvar _c;\n$RefreshReg$(_c, \"ImageSearchUpload\");","map":{"version":3,"names":["React","useRef","Icon","jsxDEV","_jsxDEV","Fragment","_Fragment","ImageSearchUpload","endpoint","k","label","onStart","onFinish","onResults","onError","className","icon","_s","inputRef","handleChange","e","_e$target$files","file","target","files","_json","fd","FormData","append","res","fetch","method","body","text","json","JSON","parse","ok","Error","error","status","results","Array","isArray","mapped","map","p","image","image_url","err","console","String","message","current","value","content","children","name","size","style","marginRight","fileName","_jsxFileName","lineNumber","columnNumber","cursor","display","alignItems","gap","ref","type","accept","onChange","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ImageSearchUpload.jsx"],"sourcesContent":["import React, { useRef } from 'react';\r\nimport Icon from './Icon';\r\n\r\nexport default function ImageSearchUpload({\r\n  endpoint = 'http://localhost:8000/api/search/image/',\r\n  k = 48,\r\n  label = 'Tìm bằng ảnh',\r\n  onStart,\r\n  onFinish,\r\n  onResults,\r\n  onError,\r\n  className = 'btn btn-primary',\r\n  icon = 'image'\r\n}) {\r\n  const inputRef = useRef(null);\r\n\r\n  async function handleChange(e) {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    try {\r\n      onStart?.();\r\n      const fd = new FormData();\r\n      fd.append('file', file);\r\n\r\n      const res = await fetch(`${endpoint}?k=${k}`, { method: 'POST', body: fd });\r\n      const text = await res.text();\r\n      let json = {};\r\n      try { json = JSON.parse(text); } catch { /* HTML error page */ }\r\n\r\n      if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);\r\n\r\n      const results = Array.isArray(json.results) ? json.results : [];\r\n      const mapped = results.map(p => ({ ...p, image: p.image || p.image_url || '' }));\r\n      onResults?.(mapped);\r\n    } catch (err) {\r\n      console.error(err);\r\n      onError?.(String(err?.message || 'Tìm kiếm bằng ảnh thất bại.'));\r\n    } finally {\r\n      onFinish?.();\r\n      if (inputRef.current) inputRef.current.value = '';\r\n    }\r\n  }\r\n\r\n  const content = typeof label === 'string'\r\n    ? (\r\n        <>\r\n          {icon && <Icon name={icon} size={16} style={{ marginRight: 6 }} />}\r\n          <span>{label}</span>\r\n        </>\r\n      )\r\n    : label;\r\n\r\n  return (\r\n    <label\r\n      className={className}\r\n      style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', gap: 6 }}\r\n    >\r\n      {content}\r\n      <input\r\n        ref={inputRef}\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        style={{ display: 'none' }}\r\n        onChange={handleChange}\r\n      />\r\n    </label>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}