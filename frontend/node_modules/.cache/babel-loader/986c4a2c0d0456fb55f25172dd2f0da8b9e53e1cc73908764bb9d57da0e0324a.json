{"ast":null,"code":"const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\nfunction setTokensAndUser(data) {\n  var _data$tokens, _data$tokens2;\n  const access = (data === null || data === void 0 ? void 0 : (_data$tokens = data.tokens) === null || _data$tokens === void 0 ? void 0 : _data$tokens.access) || (data === null || data === void 0 ? void 0 : data.access);\n  const refresh = (data === null || data === void 0 ? void 0 : (_data$tokens2 = data.tokens) === null || _data$tokens2 === void 0 ? void 0 : _data$tokens2.refresh) || (data === null || data === void 0 ? void 0 : data.refresh);\n  if (access) localStorage.setItem('access', access);\n  if (refresh) localStorage.setItem('refresh', refresh);\n  if (data !== null && data !== void 0 && data.user) {\n    try {\n      localStorage.setItem('user', JSON.stringify(data.user));\n    } catch {}\n  }\n}\nasync function parse(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nexport async function login(username, password) {\n  const res = await fetch(`${API_BASE}/users/login/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    const msg = typeof data === 'string' ? data : data.error || data.detail || 'Login failed';\n    const err = new Error(msg);\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  setTokensAndUser(data);\n  return data; // { user, tokens:{access,refresh} }\n}\nexport async function register(userData) {\n  const payload = {\n    ...userData\n  };\n  // Fallback username nếu thiếu\n  if (!payload.username && payload.email) {\n    payload.username = String(payload.email).split('@')[0];\n  }\n  // Fallback password2 nếu serializer yêu cầu\n  if (!payload.password2 && payload.password) {\n    payload.password2 = payload.password;\n  }\n  const res = await fetch(`${API_BASE}/users/register/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    var _Object$values, _Object$values$;\n    const msg = typeof data === 'string' ? data : data.detail || data.error || ((_Object$values = Object.values(data)) === null || _Object$values === void 0 ? void 0 : (_Object$values$ = _Object$values[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$[0]) || 'Registration failed';\n    const err = new Error(msg);\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  setTokensAndUser(data);\n  return data; // { user, tokens:{access,refresh} }\n}\nexport async function getCurrentUser() {\n  const token = localStorage.getItem('access') || localStorage.getItem('access_token');\n  const headers = {\n    Accept: 'application/json'\n  };\n  if (token) headers.Authorization = `Bearer ${token}`;\n  const res = await fetch(`${API_BASE}/users/me/`, {\n    headers,\n    credentials: 'include'\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    const err = new Error('Unauthorized');\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  return data; // user object\n}\nexport async function logout() {\n  // Backend yêu cầu refresh để blacklist; nếu không có cứ xóa local\n  const refresh = localStorage.getItem('refresh');\n  try {\n    await fetch(`${API_BASE}/users/logout/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      body: JSON.stringify({\n        refresh\n      }),\n      credentials: 'include'\n    });\n  } catch {}\n  localStorage.removeItem('access');\n  localStorage.removeItem('access_token');\n  localStorage.removeItem('refresh');\n  localStorage.removeItem('user');\n}\nexport default {\n  login,\n  register,\n  getCurrentUser,\n  logout\n};","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_BASE","setTokensAndUser","data","_data$tokens","_data$tokens2","access","tokens","refresh","localStorage","setItem","user","JSON","stringify","parse","res","text","login","username","password","fetch","method","headers","Accept","body","ok","msg","error","detail","err","Error","response","register","userData","payload","email","String","split","password2","_Object$values","_Object$values$","Object","values","getCurrentUser","token","getItem","Authorization","credentials","logout","removeItem"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\r\n\r\nfunction setTokensAndUser(data) {\r\n  const access = data?.tokens?.access || data?.access;\r\n  const refresh = data?.tokens?.refresh || data?.refresh;\r\n  if (access) localStorage.setItem('access', access);\r\n  if (refresh) localStorage.setItem('refresh', refresh);\r\n  if (data?.user) {\r\n    try { localStorage.setItem('user', JSON.stringify(data.user)); } catch {}\r\n  }\r\n}\r\n\r\nasync function parse(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API_BASE}/users/login/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\r\n    body: JSON.stringify({ username, password })\r\n  });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const msg = typeof data === 'string' ? data : (data.error || data.detail || 'Login failed');\r\n    const err = new Error(msg);\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  setTokensAndUser(data);\r\n  return data; // { user, tokens:{access,refresh} }\r\n}\r\n\r\nexport async function register(userData) {\r\n  const payload = { ...userData };\r\n  // Fallback username nếu thiếu\r\n  if (!payload.username && payload.email) {\r\n    payload.username = String(payload.email).split('@')[0];\r\n  }\r\n  // Fallback password2 nếu serializer yêu cầu\r\n  if (!payload.password2 && payload.password) {\r\n    payload.password2 = payload.password;\r\n  }\r\n\r\n  const res = await fetch(`${API_BASE}/users/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const msg = typeof data === 'string'\r\n      ? data\r\n      : (data.detail || data.error || Object.values(data)?.[0]?.[0] || 'Registration failed');\r\n    const err = new Error(msg);\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  setTokensAndUser(data);\r\n  return data; // { user, tokens:{access,refresh} }\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const token = localStorage.getItem('access') || localStorage.getItem('access_token');\r\n  const headers = { Accept: 'application/json' };\r\n  if (token) headers.Authorization = `Bearer ${token}`;\r\n  const res = await fetch(`${API_BASE}/users/me/`, { headers, credentials: 'include' });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const err = new Error('Unauthorized');\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  return data; // user object\r\n}\r\n\r\nexport async function logout() {\r\n  // Backend yêu cầu refresh để blacklist; nếu không có cứ xóa local\r\n  const refresh = localStorage.getItem('refresh');\r\n  try {\r\n    await fetch(`${API_BASE}/users/logout/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\r\n      body: JSON.stringify({ refresh }),\r\n      credentials: 'include',\r\n    });\r\n  } catch {}\r\n  localStorage.removeItem('access');\r\n  localStorage.removeItem('access_token');\r\n  localStorage.removeItem('refresh');\r\n  localStorage.removeItem('user');\r\n}\r\n\r\nexport default { login, register, getCurrentUser, logout };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}