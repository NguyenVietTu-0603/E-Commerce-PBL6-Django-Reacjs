{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\components\\\\ChatButton.jsx\",\n  _s = $RefreshSig$();\n// components/ChatButton.jsx\nimport React, { useState, useEffect } from 'react';\nimport PopupChat from './PopupChat';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE = 'http://localhost:8000/api'; // backend API URL\n\nexport default function ChatButton({\n  user\n}) {\n  _s();\n  const [conversations, setConversations] = useState([]);\n  const [openChats, setOpenChats] = useState([]);\n\n  // Fetch conversations\n  useEffect(() => {\n    const fetchChats = async () => {\n      try {\n        const token = localStorage.getItem('access_token');\n        const res = await fetch(`${API_BASE}/chat/my-conversations/`, {\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\n        const data = await res.json();\n        setConversations(data);\n      } catch (err) {\n        console.error('Failed to fetch chats', err);\n      }\n    };\n    if (user) fetchChats();\n  }, [user]);\n  const toggleChat = convId => {\n    setOpenChats(prev => prev.includes(convId) ? prev.filter(id => id !== convId) : [...prev, convId]);\n  };\n  if (!user) return null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        bottom: 20,\n        right: 20,\n        display: 'flex',\n        flexDirection: 'column-reverse',\n        gap: 10,\n        zIndex: 9999\n      },\n      children: conversations.map(conv => {\n        // Hiển thị tên người chat\n        const name = user.user_type === 'buyer' ? conv.shop_name || `Shop #${conv.shop_id}` : conv.buyer_name || `Buyer #${conv.buyer_id}`;\n        return /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleChat(conv.id),\n          style: {\n            width: 50,\n            height: 50,\n            borderRadius: '50%',\n            background: '#2563eb',\n            color: '#fff',\n            border: 'none',\n            cursor: 'pointer'\n          },\n          children: name[0].toUpperCase()\n        }, conv.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 59,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 7\n    }, this), openChats.map(convId => {\n      const conv = conversations.find(c => c.id === convId);\n      if (!conv) return null;\n      const chatProps = user.user_type === 'buyer' ? {\n        shopId: conv.shop_id,\n        buyerId: user.user_id\n      } : {\n        shopId: conv.shop_id,\n        buyerId: conv.buyer_id\n      };\n      return /*#__PURE__*/_jsxDEV(PopupChat, {\n        ...chatProps,\n        onClose: () => toggleChat(convId)\n      }, convId, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this);\n    })]\n  }, void 0, true);\n}\n_s(ChatButton, \"NVBGVYMy/iHuWEo8vRbZZRy6hxY=\");\n_c = ChatButton;\nvar _c;\n$RefreshReg$(_c, \"ChatButton\");","map":{"version":3,"names":["React","useState","useEffect","PopupChat","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE","ChatButton","user","_s","conversations","setConversations","openChats","setOpenChats","fetchChats","token","localStorage","getItem","res","fetch","headers","ok","Error","status","data","json","err","console","error","toggleChat","convId","prev","includes","filter","id","children","style","position","bottom","right","display","flexDirection","gap","zIndex","map","conv","name","user_type","shop_name","shop_id","buyer_name","buyer_id","onClick","width","height","borderRadius","background","color","border","cursor","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","find","c","chatProps","shopId","buyerId","user_id","onClose","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ChatButton.jsx"],"sourcesContent":["// components/ChatButton.jsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport PopupChat from './PopupChat';\r\n\r\nconst API_BASE = 'http://localhost:8000/api'; // backend API URL\r\n\r\nexport default function ChatButton({ user }) {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [openChats, setOpenChats] = useState([]);\r\n\r\n  // Fetch conversations\r\n  useEffect(() => {\r\n    const fetchChats = async () => {\r\n      try {\r\n        const token = localStorage.getItem('access_token');\r\n        const res = await fetch(`${API_BASE}/chat/my-conversations/`, {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n          },\r\n        });\r\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n        const data = await res.json();\r\n        setConversations(data);\r\n      } catch (err) {\r\n        console.error('Failed to fetch chats', err);\r\n      }\r\n    };\r\n\r\n    if (user) fetchChats();\r\n  }, [user]);\r\n\r\n  const toggleChat = (convId) => {\r\n    setOpenChats(prev =>\r\n      prev.includes(convId) ? prev.filter(id => id !== convId) : [...prev, convId]\r\n    );\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <>\r\n      {/* Icon Messenger góc phải dưới */}\r\n      <div style={{\r\n        position: 'fixed',\r\n        bottom: 20,\r\n        right: 20,\r\n        display: 'flex',\r\n        flexDirection: 'column-reverse',\r\n        gap: 10,\r\n        zIndex: 9999\r\n      }}>\r\n        {conversations.map(conv => {\r\n          // Hiển thị tên người chat\r\n          const name = user.user_type === 'buyer'\r\n            ? conv.shop_name || `Shop #${conv.shop_id}`\r\n            : conv.buyer_name || `Buyer #${conv.buyer_id}`;\r\n\r\n          return (\r\n            <button\r\n              key={conv.id}\r\n              onClick={() => toggleChat(conv.id)}\r\n              style={{\r\n                width: 50,\r\n                height: 50,\r\n                borderRadius: '50%',\r\n                background: '#2563eb',\r\n                color: '#fff',\r\n                border: 'none',\r\n                cursor: 'pointer'\r\n              }}\r\n            >\r\n              {name[0].toUpperCase()}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Popup chat */}\r\n      {openChats.map(convId => {\r\n        const conv = conversations.find(c => c.id === convId);\r\n        if (!conv) return null;\r\n\r\n        const chatProps = user.user_type === 'buyer'\r\n          ? { shopId: conv.shop_id, buyerId: user.user_id }\r\n          : { shopId: conv.shop_id, buyerId: conv.buyer_id };\r\n\r\n        return (\r\n          <PopupChat\r\n            key={convId}\r\n            {...chatProps}\r\n            onClose={() => toggleChat(convId)}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}