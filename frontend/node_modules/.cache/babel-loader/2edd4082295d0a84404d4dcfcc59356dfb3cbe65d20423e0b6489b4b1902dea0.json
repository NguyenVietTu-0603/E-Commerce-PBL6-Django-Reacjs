{"ast":null,"code":"const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\nfunction setTokens(data) {\n  if (data.access) localStorage.setItem('access', data.access);\n  if (data.access_token) localStorage.setItem('access_token', data.access_token);\n  if (data.refresh) localStorage.setItem('refresh', data.refresh);\n  try {\n    if (data.user) localStorage.setItem('user', JSON.stringify(data.user));\n  } catch {}\n}\nasync function parse(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nasync function login(username, password) {\n  const res = await fetch(`${API_BASE}/auth/login/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    const msg = typeof data === 'string' ? data : data.detail || data.error || 'Login failed';\n    const err = new Error(msg);\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  setTokens(data);\n  return data; // { access?, refresh?, user? }\n}\nasync function register(userData) {\n  // Map payload theo backend phổ biến: username, email, password, password2, full_name, user_type\n  const username = userData.username || (userData.email ? userData.email.split('@')[0] : '');\n  const payload = {\n    username,\n    email: userData.email,\n    password: userData.password,\n    password2: userData.password2 || userData.password_confirmation || userData.password,\n    // nếu backend yêu cầu confirm\n    full_name: userData.full_name || userData.name || '',\n    phone: userData.phone || '',\n    user_type: userData.user_type || 'buyer'\n  };\n  const res = await fetch(`${API_BASE}/auth/register/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Accept: 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    var _Object$values$;\n    const msg = typeof data === 'string' ? data : data.detail || data.error || ((_Object$values$ = Object.values(data)[0]) === null || _Object$values$ === void 0 ? void 0 : _Object$values$[0]) || 'Registration failed';\n    const err = new Error(msg);\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  // Một số backend trả user + tokens, số khác chỉ trả user. Lưu nếu có.\n  setTokens(data);\n  return data; // { user?, access? ... }\n}\nasync function getCurrentUser() {\n  const token = localStorage.getItem('access') || localStorage.getItem('access_token');\n  const headers = {\n    Accept: 'application/json'\n  };\n  if (token) headers.Authorization = `Bearer ${token}`;\n  const res = await fetch(`${API_BASE}/auth/me/`, {\n    headers,\n    credentials: 'include'\n  });\n  const data = await parse(res);\n  if (!res.ok) {\n    const err = new Error('Unauthorized');\n    err.response = {\n      data\n    };\n    throw err;\n  }\n  return data;\n}\nasync function logout() {\n  try {\n    await fetch(`${API_BASE}/auth/logout/`, {\n      method: 'POST',\n      credentials: 'include'\n    });\n  } catch {}\n  localStorage.removeItem('access');\n  localStorage.removeItem('access_token');\n  localStorage.removeItem('refresh');\n  localStorage.removeItem('user');\n}\nexport default {\n  login,\n  register,\n  getCurrentUser,\n  logout\n};","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_BASE","setTokens","data","access","localStorage","setItem","access_token","refresh","user","JSON","stringify","parse","res","text","login","username","password","fetch","method","headers","Accept","body","ok","msg","detail","error","err","Error","response","register","userData","email","split","payload","password2","password_confirmation","full_name","name","phone","user_type","_Object$values$","Object","values","getCurrentUser","token","getItem","Authorization","credentials","logout","removeItem"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\r\n\r\nfunction setTokens(data) {\r\n  if (data.access) localStorage.setItem('access', data.access);\r\n  if (data.access_token) localStorage.setItem('access_token', data.access_token);\r\n  if (data.refresh) localStorage.setItem('refresh', data.refresh);\r\n  try { if (data.user) localStorage.setItem('user', JSON.stringify(data.user)); } catch {}\r\n}\r\n\r\nasync function parse(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nasync function login(username, password) {\r\n  const res = await fetch(`${API_BASE}/auth/login/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\r\n    body: JSON.stringify({ username, password })\r\n  });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const msg = typeof data === 'string' ? data : (data.detail || data.error || 'Login failed');\r\n    const err = new Error(msg);\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  setTokens(data);\r\n  return data; // { access?, refresh?, user? }\r\n}\r\n\r\nasync function register(userData) {\r\n  // Map payload theo backend phổ biến: username, email, password, password2, full_name, user_type\r\n  const username = userData.username || (userData.email ? userData.email.split('@')[0] : '');\r\n  const payload = {\r\n    username,\r\n    email: userData.email,\r\n    password: userData.password,\r\n    password2: userData.password2 || userData.password_confirmation || userData.password, // nếu backend yêu cầu confirm\r\n    full_name: userData.full_name || userData.name || '',\r\n    phone: userData.phone || '',\r\n    user_type: userData.user_type || 'buyer',\r\n  };\r\n\r\n  const res = await fetch(`${API_BASE}/auth/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const msg = typeof data === 'string' ? data : (\r\n      data.detail || data.error || Object.values(data)[0]?.[0] || 'Registration failed'\r\n    );\r\n    const err = new Error(msg);\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  // Một số backend trả user + tokens, số khác chỉ trả user. Lưu nếu có.\r\n  setTokens(data);\r\n  return data; // { user?, access? ... }\r\n}\r\n\r\nasync function getCurrentUser() {\r\n  const token = localStorage.getItem('access') || localStorage.getItem('access_token');\r\n  const headers = { Accept: 'application/json' };\r\n  if (token) headers.Authorization = `Bearer ${token}`;\r\n  const res = await fetch(`${API_BASE}/auth/me/`, { headers, credentials: 'include' });\r\n  const data = await parse(res);\r\n  if (!res.ok) {\r\n    const err = new Error('Unauthorized');\r\n    err.response = { data };\r\n    throw err;\r\n  }\r\n  return data;\r\n}\r\n\r\nasync function logout() {\r\n  try {\r\n    await fetch(`${API_BASE}/auth/logout/`, { method: 'POST', credentials: 'include' });\r\n  } catch {}\r\n  localStorage.removeItem('access');\r\n  localStorage.removeItem('access_token');\r\n  localStorage.removeItem('refresh');\r\n  localStorage.removeItem('user');\r\n}\r\n\r\nexport default { login, register, getCurrentUser, logout };"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}