{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\components\\\\ChatButton.jsx\",\n  _s = $RefreshSig$();\n// components/ChatButton.jsx\nimport React, { useState, useEffect } from 'react';\nimport PopupChat from './PopupChat';\nimport { useAuth } from '../utils/AuthContext';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ChatButton() {\n  _s();\n  const {\n    user\n  } = useAuth();\n  const [conversations, setConversations] = useState([]); // tất cả conversations\n  const [openChats, setOpenChats] = useState([]); // shopId hoặc buyerId đang mở\n\n  useEffect(() => {\n    if (!user) return;\n    const fetchConversations = async () => {\n      try {\n        const token = localStorage.getItem('access_token');\n        const res = await axios.get('http://localhost:8000/api/chat/my-conversations/', {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        setConversations(res.data);\n      } catch (err) {\n        console.error(err);\n      }\n    };\n    fetchConversations();\n  }, [user]);\n  const toggleChat = convId => {\n    setOpenChats(prev => {\n      if (prev.includes(convId)) return prev.filter(id => id !== convId);\n      return [...prev, convId];\n    });\n  };\n  if (!user) return null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        bottom: 20,\n        right: 20,\n        display: 'flex',\n        flexDirection: 'column-reverse',\n        gap: 10,\n        zIndex: 9999\n      },\n      children: conversations.map(conv => {\n        // Người đối diện\n        const target = user.user_type === 'buyer' ? conv.shop : conv.buyer;\n        return /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleChat(conv.id),\n          style: {\n            width: 50,\n            height: 50,\n            borderRadius: '50%',\n            background: '#2563eb',\n            color: '#fff',\n            border: 'none',\n            cursor: 'pointer'\n          },\n          title: target.username,\n          children: target.username[0].toUpperCase()\n        }, conv.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 55,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 7\n    }, this), openChats.map(convId => {\n      const conv = conversations.find(c => c.id === convId);\n      if (!conv) return null;\n      const target = user.user_type === 'buyer' ? conv.shop : conv.buyer;\n      return /*#__PURE__*/_jsxDEV(PopupChat, {\n        shopId: conv.shop.user_id,\n        buyerId: conv.buyer.user_id,\n        userId: user.user_id,\n        onClose: () => toggleChat(conv.id),\n        title: target.username\n      }, conv.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 11\n      }, this);\n    })]\n  }, void 0, true);\n}\n_s(ChatButton, \"MD73r2Ke97u9dbGO6E03fidTNHM=\", false, function () {\n  return [useAuth];\n});\n_c = ChatButton;\nvar _c;\n$RefreshReg$(_c, \"ChatButton\");","map":{"version":3,"names":["React","useState","useEffect","PopupChat","useAuth","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","ChatButton","_s","user","conversations","setConversations","openChats","setOpenChats","fetchConversations","token","localStorage","getItem","res","get","headers","Authorization","data","err","console","error","toggleChat","convId","prev","includes","filter","id","children","style","position","bottom","right","display","flexDirection","gap","zIndex","map","conv","target","user_type","shop","buyer","onClick","width","height","borderRadius","background","color","border","cursor","title","username","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","find","c","shopId","user_id","buyerId","userId","onClose","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ChatButton.jsx"],"sourcesContent":["// components/ChatButton.jsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport PopupChat from './PopupChat';\r\nimport { useAuth } from '../utils/AuthContext';\r\nimport axios from 'axios';\r\n\r\nexport default function ChatButton() {\r\n  const { user } = useAuth();\r\n  const [conversations, setConversations] = useState([]); // tất cả conversations\r\n  const [openChats, setOpenChats] = useState([]); // shopId hoặc buyerId đang mở\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n\r\n    const fetchConversations = async () => {\r\n      try {\r\n        const token = localStorage.getItem('access_token');\r\n        const res = await axios.get('http://localhost:8000/api/chat/my-conversations/', {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        setConversations(res.data);\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    };\r\n\r\n    fetchConversations();\r\n  }, [user]);\r\n\r\n  const toggleChat = (convId) => {\r\n    setOpenChats(prev => {\r\n      if (prev.includes(convId)) return prev.filter(id => id !== convId);\r\n      return [...prev, convId];\r\n    });\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <>\r\n      {/* Icon góc phải dưới */}\r\n      <div style={{\r\n        position: 'fixed',\r\n        bottom: 20,\r\n        right: 20,\r\n        display: 'flex',\r\n        flexDirection: 'column-reverse',\r\n        gap: 10,\r\n        zIndex: 9999\r\n      }}>\r\n        {conversations.map(conv => {\r\n          // Người đối diện\r\n          const target = user.user_type === 'buyer' ? conv.shop : conv.buyer;\r\n          return (\r\n            <button\r\n              key={conv.id}\r\n              onClick={() => toggleChat(conv.id)}\r\n              style={{\r\n                width: 50,\r\n                height: 50,\r\n                borderRadius: '50%',\r\n                background: '#2563eb',\r\n                color: '#fff',\r\n                border: 'none',\r\n                cursor: 'pointer'\r\n              }}\r\n              title={target.username}\r\n            >\r\n              {target.username[0].toUpperCase()}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Popup chat */}\r\n      {openChats.map(convId => {\r\n        const conv = conversations.find(c => c.id === convId);\r\n        if (!conv) return null;\r\n\r\n        const target = user.user_type === 'buyer' ? conv.shop : conv.buyer;\r\n\r\n        return (\r\n          <PopupChat\r\n            key={conv.id}\r\n            shopId={conv.shop.user_id}\r\n            buyerId={conv.buyer.user_id}\r\n            userId={user.user_id}\r\n            onClose={() => toggleChat(conv.id)}\r\n            title={target.username}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}