{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const BASE=process.env.REACT_APP_API_BASE||'http://localhost:8000/api';const TOKEN_KEYS=['access','access_token','accessToken','token','jwt','authToken'];function getToken(){for(const k of TOKEN_KEYS){const v=localStorage.getItem(k);if(v)return v;}return null;}function authHeaders(){const token=getToken();return token?{Authorization:\"Bearer \".concat(token)}:{};}async function parseOrText(res){const text=await res.text();try{return JSON.parse(text);}catch(_unused){return text;}}export async function getProductReviews(productId){const res=await fetch(\"\".concat(BASE,\"/products/\").concat(productId,\"/reviews/\"),{credentials:'include',headers:_objectSpread({Accept:'application/json'},authHeaders())});if(!res.ok)throw new Error(\"Failed to fetch reviews (\".concat(res.status,\")\"));return res.json();// { reviews, average, count }\n}export async function getReviewEligibility(productId){const res=await fetch(\"\".concat(BASE,\"/products/\").concat(productId,\"/reviews/eligibility/\"),{credentials:'include',headers:_objectSpread({Accept:'application/json'},authHeaders())});if(res.status===401){return{can_review:false,reason:'unauthenticated'};}if(!res.ok)throw new Error(\"Failed to check eligibility (\".concat(res.status,\")\"));return res.json();// { can_review, my_review? }\n}export async function submitReview(productId,_ref){let{rating,comment}=_ref;const res=await fetch(\"\".concat(BASE,\"/products/\").concat(productId,\"/reviews/\"),{method:'POST',credentials:'include',headers:_objectSpread({'Content-Type':'application/json',Accept:'application/json'},authHeaders()),body:JSON.stringify({rating,comment})});if(!res.ok){const body=await parseOrText(res);const msg=typeof body==='string'?body:body.detail||'Failed to submit review';throw new Error(\"\".concat(msg,\" (\").concat(res.status,\")\"));}return res.json();}","map":{"version":3,"names":["BASE","process","env","REACT_APP_API_BASE","TOKEN_KEYS","getToken","k","v","localStorage","getItem","authHeaders","token","Authorization","concat","parseOrText","res","text","JSON","parse","_unused","getProductReviews","productId","fetch","credentials","headers","_objectSpread","Accept","ok","Error","status","json","getReviewEligibility","can_review","reason","submitReview","_ref","rating","comment","method","body","stringify","msg","detail"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/reviewsApi.js"],"sourcesContent":["const BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000/api';\r\n\r\nconst TOKEN_KEYS = ['access', 'access_token', 'accessToken', 'token', 'jwt', 'authToken'];\r\nfunction getToken() {\r\n  for (const k of TOKEN_KEYS) {\r\n    const v = localStorage.getItem(k);\r\n    if (v) return v;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction authHeaders() {\r\n  const token = getToken();\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseOrText(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function getProductReviews(productId) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\r\n    credentials: 'include',\r\n    headers: { Accept: 'application/json', ...authHeaders() }\r\n  });\r\n  if (!res.ok) throw new Error(`Failed to fetch reviews (${res.status})`);\r\n  return res.json(); // { reviews, average, count }\r\n}\r\n\r\nexport async function getReviewEligibility(productId) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/eligibility/`, {\r\n    credentials: 'include',\r\n    headers: { Accept: 'application/json', ...authHeaders() }\r\n  });\r\n  if (res.status === 401) {\r\n    return { can_review: false, reason: 'unauthenticated' };\r\n  }\r\n  if (!res.ok) throw new Error(`Failed to check eligibility (${res.status})`);\r\n  return res.json(); // { can_review, my_review? }\r\n}\r\n\r\nexport async function submitReview(productId, { rating, comment }) {\r\n  const res = await fetch(`${BASE}/products/${productId}/reviews/`, {\r\n    method: 'POST',\r\n    credentials: 'include',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      Accept: 'application/json',\r\n      ...authHeaders()\r\n    },\r\n    body: JSON.stringify({ rating, comment })\r\n  });\r\n  if (!res.ok) {\r\n    const body = await parseOrText(res);\r\n    const msg = typeof body === 'string' ? body : (body.detail || 'Failed to submit review');\r\n    throw new Error(`${msg} (${res.status})`);\r\n  }\r\n  return res.json();\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}