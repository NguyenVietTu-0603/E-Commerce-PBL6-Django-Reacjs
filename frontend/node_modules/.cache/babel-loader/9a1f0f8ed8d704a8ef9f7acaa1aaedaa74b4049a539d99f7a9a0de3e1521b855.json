{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import{useAuth}from'../utils/AuthContext';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_BASE=process.env.REACT_APP_API_BASE||'http://localhost:8000';const formatRelativeTime=isoString=>{if(!isoString)return'';const date=new Date(isoString);const diff=Date.now()-date.getTime();if(diff<60000)return'V·ª´a xong';if(diff<3600000)return\"\".concat(Math.floor(diff/60000),\" ph\\xFAt tr\\u01B0\\u1EDBc\");if(diff<86400000)return\"\".concat(Math.floor(diff/3600000),\" gi\\u1EDD tr\\u01B0\\u1EDBc\");return date.toLocaleDateString('vi-VN');};const normalizeConversation=function(){var _raw$shop,_raw$shop2,_raw$shop3,_raw$buyer,_raw$buyer2,_raw$product,_raw$product2;let raw=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return{id:raw.id||raw.conversation_id||\"\".concat(raw.shop_id||'shop',\"-\").concat(raw.buyer_id||'buyer'),shopId:raw.shop_id||((_raw$shop=raw.shop)===null||_raw$shop===void 0?void 0:_raw$shop.id)||raw.shopId,shopName:raw.shop_name||((_raw$shop2=raw.shop)===null||_raw$shop2===void 0?void 0:_raw$shop2.name)||raw.shopName||\"Shop #\".concat(raw.shop_id||raw.shopId||'?'),shopAvatar:raw.shop_avatar||((_raw$shop3=raw.shop)===null||_raw$shop3===void 0?void 0:_raw$shop3.avatar),buyerId:raw.buyer_id||((_raw$buyer=raw.buyer)===null||_raw$buyer===void 0?void 0:_raw$buyer.id)||raw.buyerId,buyerName:raw.buyer_name||((_raw$buyer2=raw.buyer)===null||_raw$buyer2===void 0?void 0:_raw$buyer2.full_name)||raw.buyerName||\"Kh\\xE1ch #\".concat(raw.buyer_id||raw.buyerId||'?'),productId:raw.product_id||((_raw$product=raw.product)===null||_raw$product===void 0?void 0:_raw$product.id),productName:raw.product_name||((_raw$product2=raw.product)===null||_raw$product2===void 0?void 0:_raw$product2.name),lastMessage:raw.last_message||raw.lastMessage||'Ch∆∞a c√≥ tin nh·∫Øn',updatedAt:raw.updated_at||raw.last_message_at||raw.updatedAt||new Date().toISOString(),unreadCount:raw.unread_count||raw.unreadCount||0};};const buildFallbackConversations=user=>{if(!user)return[];const now=new Date();return[{id:'demo-1',shopId:user.user_type==='seller'?user.user_id:101,shopName:user.user_type==='seller'?'Shop c·ªßa b·∫°n':'Shop th·ªùi trang',buyerId:user.user_type==='seller'?501:user.user_id,buyerName:user.user_type==='seller'?'Kh√°ch m·ªõi':'B·∫°n',productName:'√Åo cotton form r·ªông',lastMessage:'Xin ch√†o! Shop c√≤n size M kh√¥ng?',updatedAt:now.toISOString(),unreadCount:user.user_type==='seller'?2:0},{id:'demo-2',shopId:user.user_type==='seller'?user.user_id:205,shopName:user.user_type==='seller'?'Shop c·ªßa b·∫°n':'Gi√†y Sneaker Pro',buyerId:user.user_type==='seller'?777:user.user_id,buyerName:user.user_type==='seller'?'Nguy·ªÖn Tr√† My':'B·∫°n',productName:'Sneaker Runner X',lastMessage:'Shop ph·∫£n h·ªìi: S·∫£n ph·∫©m s·∫Ω giao trong h√¥m nay nha!',updatedAt:new Date(now.getTime()-3600000).toISOString(),unreadCount:0}];};const ChatWidget=()=>{const{user}=useAuth();const[drawerOpen,setDrawerOpen]=useState(false);const[conversations,setConversations]=useState([]);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[activeConversation,setActiveConversation]=useState(null);const hasLoadedRef=useRef(false);const[drawerHeight,setDrawerHeight]=useState(420);const[isResizing,setIsResizing]=useState(false);const resizeStateRef=useRef({startY:0,startHeight:420});const notificationSocketRef=useRef(null);const audioContextRef=useRef(null);const[toasts,setToasts]=useState([]);const toastTimersRef=useRef({});const[unreadTotal,setUnreadTotal]=useState(0);const isSeller=(user===null||user===void 0?void 0:user.user_type)==='seller';const fetchConversations=useCallback(async()=>{if(!user)return;setLoading(true);setError('');try{const token=localStorage.getItem('access_token');if(!token)throw new Error('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng chat.');const res=await fetch(\"\".concat(API_BASE,\"/api/chat/conversations/\"),{headers:{Authorization:\"Bearer \".concat(token)}});if(!res.ok)throw new Error('Kh√¥ng th·ªÉ t·∫£i cu·ªôc tr√≤ chuy·ªán.');const data=await res.json();const list=Array.isArray(data===null||data===void 0?void 0:data.results)?data.results:Array.isArray(data)?data:[];setConversations(list.map(normalizeConversation));hasLoadedRef.current=true;}catch(err){console.error('Fetch conversations error:',err);if(!hasLoadedRef.current){setConversations(buildFallbackConversations(user).map(normalizeConversation));}setError(err.message||'ƒê√£ x·∫£y ra l·ªói khi t·∫£i danh s√°ch cu·ªôc tr√≤ chuy·ªán.');}finally{setLoading(false);}},[user]);useEffect(()=>{setUnreadTotal(conversations.reduce((sum,item)=>sum+(item.unreadCount||0),0));},[conversations]);const ensureAudioContext=useCallback(()=>{const AudioContextClass=window.AudioContext||window.webkitAudioContext;if(!AudioContextClass)return null;if(!audioContextRef.current){audioContextRef.current=new AudioContextClass();}if(audioContextRef.current.state==='suspended'){audioContextRef.current.resume();}return audioContextRef.current;},[]);const playMessageChime=useCallback(()=>{const ctx=ensureAudioContext();if(!ctx)return;try{const oscillator=ctx.createOscillator();const gainNode=ctx.createGain();oscillator.type='triangle';oscillator.frequency.value=920;gainNode.gain.value=0.08;oscillator.connect(gainNode);gainNode.connect(ctx.destination);oscillator.start();oscillator.stop(ctx.currentTime+0.2);}catch(err){console.warn('Unable to play sound',err);}},[ensureAudioContext]);const pushToast=useCallback(toast=>{var _window$crypto,_window$crypto$random;const id=toast.id||((_window$crypto=window.crypto)===null||_window$crypto===void 0?void 0:(_window$crypto$random=_window$crypto.randomUUID)===null||_window$crypto$random===void 0?void 0:_window$crypto$random.call(_window$crypto))||\"\".concat(Date.now(),\"-\").concat(Math.random());const nextToast={id,title:toast.title||'Th√¥ng b√°o',message:toast.message||'',meta:toast.meta||'',accent:toast.accent||'info'};setToasts(prev=>[...prev,nextToast]);const timeout=setTimeout(()=>{setToasts(prev=>prev.filter(item=>item.id!==id));},toast.duration||6000);toastTimersRef.current[id]=timeout;},[]);const dismissToast=useCallback(id=>{setToasts(prev=>prev.filter(item=>item.id!==id));if(toastTimersRef.current[id]){clearTimeout(toastTimersRef.current[id]);delete toastTimersRef.current[id];}},[]);useEffect(()=>{if(drawerOpen&&!hasLoadedRef.current){fetchConversations();}},[drawerOpen,fetchConversations]);useEffect(()=>{const timers=toastTimersRef.current;return()=>{Object.values(timers).forEach(clearTimeout);};},[]);const handleOrderAlert=useCallback(payload=>{if(!payload)return;pushToast({title:'ƒê∆°n h√†ng c·∫≠p nh·∫≠t',message:payload.message||\"\\u0110\\u01A1n h\\xE0ng #\".concat(payload.order_id,\" \\u0111\\xE3 c\\u1EADp nh\\u1EADt.\"),meta:payload.status_label,accent:'order'});},[pushToast]);const handleChatSummary=useCallback(payload=>{if(!(payload!==null&&payload!==void 0&&payload.conversation_id))return;setConversations(prev=>{let exists=false;const mapped=prev.map(conv=>{if(conv.id===payload.conversation_id){exists=true;return _objectSpread(_objectSpread({},conv),{},{lastMessage:payload.last_message||conv.lastMessage,updatedAt:payload.last_message_at||conv.updatedAt,unreadCount:typeof payload.unread_count==='number'?payload.unread_count:conv.unreadCount});}return conv;}).sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));if(exists){return mapped;}const newcomer=normalizeConversation({id:payload.conversation_id,buyer_id:payload.buyer_id,buyer_name:payload.buyer_name,shop_id:payload.shop_id,shop_name:payload.shop_name,product_id:payload.product_id,product_name:payload.product_name,last_message:payload.last_message,last_message_at:payload.last_message_at,unread_count:payload.unread_count||0});return[newcomer,...mapped];});const isActive=(activeConversation===null||activeConversation===void 0?void 0:activeConversation.id)===payload.conversation_id&&drawerOpen;if(!isActive&&payload.sender_id!==(user===null||user===void 0?void 0:user.user_id)){playMessageChime();}},[activeConversation===null||activeConversation===void 0?void 0:activeConversation.id,drawerOpen,playMessageChime,user===null||user===void 0?void 0:user.user_id]);const handleConversationActivity=useCallback(function(conversationId){let latest=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!conversationId)return;setConversations(prev=>{let updated=false;const mapped=prev.map(conv=>{if(conv.id!==conversationId)return conv;updated=true;return _objectSpread(_objectSpread({},conv),{},{lastMessage:latest.lastMessage||conv.lastMessage,updatedAt:latest.updatedAt||new Date().toISOString(),unreadCount:typeof latest.unreadCount==='number'?latest.unreadCount:conv.unreadCount});}).sort((a,b)=>new Date(b.updatedAt)-new Date(a.updatedAt));return updated?mapped:prev;});},[]);useEffect(()=>{if(!user)return;const token=localStorage.getItem('access_token');if(!token)return;const rawHost=API_BASE.replace(/^https?:\\/\\//,'');const protocol=API_BASE.startsWith('https')?'wss':'ws';const ws=new WebSocket(\"\".concat(protocol,\"://\").concat(rawHost,\"/ws/notifications/?token=\").concat(token));notificationSocketRef.current=ws;ws.onmessage=event=>{try{const data=JSON.parse(event.data);if(data.type==='order_status')handleOrderAlert(data);if(data.type==='chat_summary')handleChatSummary(data);}catch(err){console.error('Notification WS parse error',err);}};ws.onerror=err=>console.error('Notification WS error',err);ws.onclose=()=>{notificationSocketRef.current=null;};return()=>ws.close();},[user,handleOrderAlert,handleChatSummary]);const handleConversationClick=conversation=>{setActiveConversation(conversation);setConversations(prev=>prev.map(item=>item.id===conversation.id?_objectSpread(_objectSpread({},item),{},{unreadCount:0}):item));};const counterpartLabel=conversation=>{if(!conversation)return'';return isSeller?conversation.buyerName:conversation.shopName;};const toggleDrawer=()=>{ensureAudioContext();setDrawerOpen(prev=>!prev);};const startResize=event=>{event.preventDefault();const clientY=event.touches?event.touches[0].clientY:event.clientY;resizeStateRef.current={startY:clientY,startHeight:drawerHeight};setIsResizing(true);};useEffect(()=>{if(!isResizing)return;const handleMove=event=>{const clientY=event.touches?event.touches[0].clientY:event.clientY;const delta=resizeStateRef.current.startY-clientY;const nextHeight=Math.max(260,Math.min(620,resizeStateRef.current.startHeight+delta));setDrawerHeight(nextHeight);};const stopResize=()=>setIsResizing(false);window.addEventListener('mousemove',handleMove);window.addEventListener('touchmove',handleMove);window.addEventListener('mouseup',stopResize);window.addEventListener('touchend',stopResize);return()=>{window.removeEventListener('mousemove',handleMove);window.removeEventListener('touchmove',handleMove);window.removeEventListener('mouseup',stopResize);window.removeEventListener('touchend',stopResize);};},[isResizing]);if(!user)return null;return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{className:\"chat-floating-button\",onClick:toggleDrawer,\"aria-label\":\"M\\u1EDF chat\",children:[\"\\uD83D\\uDCAC\",unreadTotal>0&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-floating-button__badge\",children:unreadTotal>99?'99+':unreadTotal})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-drawer \".concat(drawerOpen?'open':'',\" \").concat(isResizing?'resizing':''),style:{height:\"\".concat(drawerHeight,\"px\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-drawer__handle\",role:\"presentation\",onMouseDown:startResize,onTouchStart:startResize}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-drawer__header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"H\\u1ED9p th\\u01B0\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Cu\\u1ED9c tr\\xF2 chuy\\u1EC7n\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setDrawerOpen(false),\"aria-label\":\"\\u0110\\xF3ng chat\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-drawer__body\",children:[loading&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-drawer__empty\",children:\"\\u0110ang t\\u1EA3i cu\\u1ED9c tr\\xF2 chuy\\u1EC7n...\"}),!loading&&error&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-drawer__error\",children:error}),!loading&&!conversations.length&&!error&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-drawer__empty\",children:\"Ch\\u01B0a c\\xF3 cu\\u1ED9c tr\\xF2 chuy\\u1EC7n n\\xE0o.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-conversation-list\",children:conversations.map(conversation=>{var _counterpartLabel;return/*#__PURE__*/_jsxs(\"button\",{className:\"chat-conversation-item \".concat((activeConversation===null||activeConversation===void 0?void 0:activeConversation.id)===conversation.id?'active':''),onClick:()=>handleConversationClick(conversation),children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-conversation-item__avatar\",children:conversation.shopAvatar?/*#__PURE__*/_jsx(\"img\",{src:conversation.shopAvatar,alt:conversation.shopName}):/*#__PURE__*/_jsx(\"span\",{children:(_counterpartLabel=counterpartLabel(conversation))===null||_counterpartLabel===void 0?void 0:_counterpartLabel.charAt(0)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-conversation-item__content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-conversation-item__row\",children:[/*#__PURE__*/_jsx(\"strong\",{children:counterpartLabel(conversation)}),/*#__PURE__*/_jsx(\"span\",{children:formatRelativeTime(conversation.updatedAt)})]}),/*#__PURE__*/_jsxs(\"p\",{children:[conversation.productName&&/*#__PURE__*/_jsxs(\"em\",{children:[conversation.productName,\" \\u2022 \"]}),conversation.lastMessage]})]}),conversation.unreadCount>0&&/*#__PURE__*/_jsx(\"span\",{className:\"chat-conversation-item__badge\",children:conversation.unreadCount})]},conversation.id);})})]})]}),activeConversation&&/*#__PURE__*/_jsx(ChatPopup,{conversation:activeConversation,onClose:()=>setActiveConversation(null),isSeller:isSeller,counterpartName:counterpartLabel(activeConversation),onIncomingMessage:playMessageChime,onConversationActivity:handleConversationActivity}),/*#__PURE__*/_jsx(\"div\",{className:\"notification-toast-stack\",children:toasts.map(toast=>/*#__PURE__*/_jsxs(\"div\",{className:\"notification-toast notification-toast--\".concat(toast.accent),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:toast.title}),/*#__PURE__*/_jsx(\"strong\",{children:toast.message}),toast.meta&&/*#__PURE__*/_jsx(\"span\",{children:toast.meta})]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>dismissToast(toast.id),\"aria-label\":\"\\u0110\\xF3ng th\\xF4ng b\\xE1o\",children:\"\\xD7\"})]},toast.id))})]});};const ChatPopup=_ref=>{let{conversation,onClose,isSeller,counterpartName,onIncomingMessage,onConversationActivity}=_ref;const{user}=useAuth();const[messages,setMessages]=useState([]);const[text,setText]=useState('');const[connecting,setConnecting]=useState(false);const wsRef=useRef(null);const bottomRef=useRef(null);const shopId=useMemo(()=>{if(isSeller)return conversation.shopId||(user===null||user===void 0?void 0:user.user_id);return conversation.shopId;},[conversation.shopId,isSeller,user===null||user===void 0?void 0:user.user_id]);const buyerParam=useMemo(()=>{if(isSeller)return conversation.buyerId;return user===null||user===void 0?void 0:user.user_id;},[conversation.buyerId,isSeller,user===null||user===void 0?void 0:user.user_id]);useEffect(()=>{if(!conversation||!shopId||!buyerParam||!user)return;const token=localStorage.getItem('access_token')||'';const raw=API_BASE.replace(/^https?:\\/\\//,'');const wsProtocol=API_BASE.startsWith('https')?'wss':'ws';const qs=new URLSearchParams({token,buyer:buyerParam});if(conversation.productId)qs.set('product',conversation.productId);const wsUrl=\"\".concat(wsProtocol,\"://\").concat(raw,\"/ws/chat/\").concat(shopId,\"/?\").concat(qs.toString());const ws=new WebSocket(wsUrl);wsRef.current=ws;setConnecting(true);ws.onopen=()=>setConnecting(false);ws.onmessage=evt=>{try{const data=JSON.parse(evt.data);if(data.type==='history')setMessages(data.messages||[]);else if(data.type==='message'&&data.message){setMessages(prev=>[...prev,data.message]);if(data.message.sender_id!==(user===null||user===void 0?void 0:user.user_id)&&typeof onIncomingMessage==='function'){onIncomingMessage();}if(typeof onConversationActivity==='function'){onConversationActivity(conversation===null||conversation===void 0?void 0:conversation.id,{lastMessage:data.message.content,updatedAt:data.message.created_at,unreadCount:0});}}}catch(error){console.error('WS parse error',error);}};ws.onclose=evt=>console.log('Chat popup WS closed',evt);ws.onerror=error=>console.error('Chat popup WS error',error);return()=>ws.close();},[conversation,buyerParam,shopId,user,onIncomingMessage,onConversationActivity]);useEffect(()=>{var _bottomRef$current;(_bottomRef$current=bottomRef.current)===null||_bottomRef$current===void 0?void 0:_bottomRef$current.scrollIntoView({behavior:'smooth'});},[messages]);const sendMessage=()=>{const content=text.trim();if(!content||!wsRef.current||wsRef.current.readyState!==1)return;wsRef.current.send(JSON.stringify({type:'message',content}));setText('');};return/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup__header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:conversation.productName||'Tr√≤ chuy·ªán'}),/*#__PURE__*/_jsx(\"strong\",{children:counterpartName})]}),/*#__PURE__*/_jsx(\"button\",{onClick:onClose,\"aria-label\":\"\\u0110\\xF3ng cu\\u1ED9c tr\\xF2 chuy\\u1EC7n\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup__body\",children:[connecting&&/*#__PURE__*/_jsx(\"div\",{className:\"chat-popup__info\",children:\"\\u0110ang k\\u1EBFt n\\u1ED1i...\"}),messages.map(message=>/*#__PURE__*/_jsx(\"div\",{className:\"chat-popup__message \".concat(message.sender_id===(user===null||user===void 0?void 0:user.user_id)?'me':''),children:/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup__bubble\",children:[/*#__PURE__*/_jsx(\"div\",{children:message.content}),/*#__PURE__*/_jsx(\"span\",{children:new Date(message.created_at).toLocaleString('vi-VN')})]})},message.id||\"\".concat(message.created_at,\"-\").concat(message.sender_id))),/*#__PURE__*/_jsx(\"div\",{ref:bottomRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-popup__footer\",children:[/*#__PURE__*/_jsx(\"input\",{value:text,onChange:e=>setText(e.target.value),onKeyDown:e=>e.key==='Enter'&&sendMessage(),placeholder:\"Nh\\u1EADp n\\u1ED9i dung...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"G\\u1EEDi\"})]})]});};export default ChatWidget;","map":{"version":3,"names":["React","useCallback","useEffect","useMemo","useRef","useState","useAuth","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","API_BASE","process","env","REACT_APP_API_BASE","formatRelativeTime","isoString","date","Date","diff","now","getTime","concat","Math","floor","toLocaleDateString","normalizeConversation","_raw$shop","_raw$shop2","_raw$shop3","_raw$buyer","_raw$buyer2","_raw$product","_raw$product2","raw","arguments","length","undefined","id","conversation_id","shop_id","buyer_id","shopId","shop","shopName","shop_name","name","shopAvatar","shop_avatar","avatar","buyerId","buyer","buyerName","buyer_name","full_name","productId","product_id","product","productName","product_name","lastMessage","last_message","updatedAt","updated_at","last_message_at","toISOString","unreadCount","unread_count","buildFallbackConversations","user","user_type","user_id","ChatWidget","drawerOpen","setDrawerOpen","conversations","setConversations","loading","setLoading","error","setError","activeConversation","setActiveConversation","hasLoadedRef","drawerHeight","setDrawerHeight","isResizing","setIsResizing","resizeStateRef","startY","startHeight","notificationSocketRef","audioContextRef","toasts","setToasts","toastTimersRef","unreadTotal","setUnreadTotal","isSeller","fetchConversations","token","localStorage","getItem","Error","res","fetch","headers","Authorization","ok","data","json","list","Array","isArray","results","map","current","err","console","message","reduce","sum","item","ensureAudioContext","AudioContextClass","window","AudioContext","webkitAudioContext","state","resume","playMessageChime","ctx","oscillator","createOscillator","gainNode","createGain","type","frequency","value","gain","connect","destination","start","stop","currentTime","warn","pushToast","toast","_window$crypto","_window$crypto$random","crypto","randomUUID","call","random","nextToast","title","meta","accent","prev","timeout","setTimeout","filter","duration","dismissToast","clearTimeout","timers","Object","values","forEach","handleOrderAlert","payload","order_id","status_label","handleChatSummary","exists","mapped","conv","_objectSpread","sort","a","b","newcomer","isActive","sender_id","handleConversationActivity","conversationId","latest","updated","rawHost","replace","protocol","startsWith","ws","WebSocket","onmessage","event","JSON","parse","onerror","onclose","close","handleConversationClick","conversation","counterpartLabel","toggleDrawer","startResize","preventDefault","clientY","touches","handleMove","delta","nextHeight","max","min","stopResize","addEventListener","removeEventListener","children","className","onClick","style","height","role","onMouseDown","onTouchStart","_counterpartLabel","src","alt","charAt","ChatPopup","onClose","counterpartName","onIncomingMessage","onConversationActivity","_ref","messages","setMessages","text","setText","connecting","setConnecting","wsRef","bottomRef","buyerParam","wsProtocol","qs","URLSearchParams","set","wsUrl","toString","onopen","evt","content","created_at","log","_bottomRef$current","scrollIntoView","behavior","sendMessage","trim","readyState","send","stringify","toLocaleString","ref","onChange","e","target","onKeyDown","key","placeholder"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ChatWidget.jsx"],"sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\r\nimport { useAuth } from '../utils/AuthContext';\r\n\r\nconst API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000';\r\n\r\nconst formatRelativeTime = (isoString) => {\r\n  if (!isoString) return '';\r\n  const date = new Date(isoString);\r\n  const diff = Date.now() - date.getTime();\r\n  if (diff < 60000) return 'V·ª´a xong';\r\n  if (diff < 3600000) return `${Math.floor(diff / 60000)} ph√∫t tr∆∞·ªõc`;\r\n  if (diff < 86400000) return `${Math.floor(diff / 3600000)} gi·ªù tr∆∞·ªõc`;\r\n  return date.toLocaleDateString('vi-VN');\r\n};\r\n\r\nconst normalizeConversation = (raw = {}) => ({\r\n  id: raw.id || raw.conversation_id || `${raw.shop_id || 'shop'}-${raw.buyer_id || 'buyer'}`,\r\n  shopId: raw.shop_id || raw.shop?.id || raw.shopId,\r\n  shopName: raw.shop_name || raw.shop?.name || raw.shopName || `Shop #${raw.shop_id || raw.shopId || '?'}`,\r\n  shopAvatar: raw.shop_avatar || raw.shop?.avatar,\r\n  buyerId: raw.buyer_id || raw.buyer?.id || raw.buyerId,\r\n  buyerName: raw.buyer_name || raw.buyer?.full_name || raw.buyerName || `Kh√°ch #${raw.buyer_id || raw.buyerId || '?'}`,\r\n  productId: raw.product_id || raw.product?.id,\r\n  productName: raw.product_name || raw.product?.name,\r\n  lastMessage: raw.last_message || raw.lastMessage || 'Ch∆∞a c√≥ tin nh·∫Øn',\r\n  updatedAt: raw.updated_at || raw.last_message_at || raw.updatedAt || new Date().toISOString(),\r\n  unreadCount: raw.unread_count || raw.unreadCount || 0,\r\n});\r\n\r\nconst buildFallbackConversations = (user) => {\r\n  if (!user) return [];\r\n  const now = new Date();\r\n  return [\r\n    {\r\n      id: 'demo-1',\r\n      shopId: user.user_type === 'seller' ? user.user_id : 101,\r\n      shopName: user.user_type === 'seller' ? 'Shop c·ªßa b·∫°n' : 'Shop th·ªùi trang',\r\n      buyerId: user.user_type === 'seller' ? 501 : user.user_id,\r\n      buyerName: user.user_type === 'seller' ? 'Kh√°ch m·ªõi' : 'B·∫°n',\r\n      productName: '√Åo cotton form r·ªông',\r\n      lastMessage: 'Xin ch√†o! Shop c√≤n size M kh√¥ng?',\r\n      updatedAt: now.toISOString(),\r\n      unreadCount: user.user_type === 'seller' ? 2 : 0,\r\n    },\r\n    {\r\n      id: 'demo-2',\r\n      shopId: user.user_type === 'seller' ? user.user_id : 205,\r\n      shopName: user.user_type === 'seller' ? 'Shop c·ªßa b·∫°n' : 'Gi√†y Sneaker Pro',\r\n      buyerId: user.user_type === 'seller' ? 777 : user.user_id,\r\n      buyerName: user.user_type === 'seller' ? 'Nguy·ªÖn Tr√† My' : 'B·∫°n',\r\n      productName: 'Sneaker Runner X',\r\n      lastMessage: 'Shop ph·∫£n h·ªìi: S·∫£n ph·∫©m s·∫Ω giao trong h√¥m nay nha!',\r\n      updatedAt: new Date(now.getTime() - 3600000).toISOString(),\r\n      unreadCount: 0,\r\n    },\r\n  ];\r\n};\r\n\r\nconst ChatWidget = () => {\r\n  const { user } = useAuth();\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [conversations, setConversations] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [activeConversation, setActiveConversation] = useState(null);\r\n  const hasLoadedRef = useRef(false);\r\n  const [drawerHeight, setDrawerHeight] = useState(420);\r\n  const [isResizing, setIsResizing] = useState(false);\r\n  const resizeStateRef = useRef({ startY: 0, startHeight: 420 });\r\n  const notificationSocketRef = useRef(null);\r\n  const audioContextRef = useRef(null);\r\n  const [toasts, setToasts] = useState([]);\r\n  const toastTimersRef = useRef({});\r\n  const [unreadTotal, setUnreadTotal] = useState(0);\r\n\r\n  const isSeller = user?.user_type === 'seller';\r\n\r\n  const fetchConversations = useCallback(async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    setError('');\r\n    try {\r\n      const token = localStorage.getItem('access_token');\r\n      if (!token) throw new Error('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ s·ª≠ d·ª•ng chat.');\r\n      const res = await fetch(`${API_BASE}/api/chat/conversations/`, {\r\n        headers: {\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n      if (!res.ok) throw new Error('Kh√¥ng th·ªÉ t·∫£i cu·ªôc tr√≤ chuy·ªán.');\r\n      const data = await res.json();\r\n      const list = Array.isArray(data?.results) ? data.results : Array.isArray(data) ? data : [];\r\n      setConversations(list.map(normalizeConversation));\r\n      hasLoadedRef.current = true;\r\n    } catch (err) {\r\n      console.error('Fetch conversations error:', err);\r\n      if (!hasLoadedRef.current) {\r\n        setConversations(buildFallbackConversations(user).map(normalizeConversation));\r\n      }\r\n      setError(err.message || 'ƒê√£ x·∫£y ra l·ªói khi t·∫£i danh s√°ch cu·ªôc tr√≤ chuy·ªán.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    setUnreadTotal(conversations.reduce((sum, item) => sum + (item.unreadCount || 0), 0));\r\n  }, [conversations]);\r\n\r\n  const ensureAudioContext = useCallback(() => {\r\n    const AudioContextClass = window.AudioContext || window.webkitAudioContext;\r\n    if (!AudioContextClass) return null;\r\n    if (!audioContextRef.current) {\r\n      audioContextRef.current = new AudioContextClass();\r\n    }\r\n    if (audioContextRef.current.state === 'suspended') {\r\n      audioContextRef.current.resume();\r\n    }\r\n    return audioContextRef.current;\r\n  }, []);\r\n\r\n  const playMessageChime = useCallback(() => {\r\n    const ctx = ensureAudioContext();\r\n    if (!ctx) return;\r\n    try {\r\n      const oscillator = ctx.createOscillator();\r\n      const gainNode = ctx.createGain();\r\n      oscillator.type = 'triangle';\r\n      oscillator.frequency.value = 920;\r\n      gainNode.gain.value = 0.08;\r\n      oscillator.connect(gainNode);\r\n      gainNode.connect(ctx.destination);\r\n      oscillator.start();\r\n      oscillator.stop(ctx.currentTime + 0.2);\r\n    } catch (err) {\r\n      console.warn('Unable to play sound', err);\r\n    }\r\n  }, [ensureAudioContext]);\r\n\r\n  const pushToast = useCallback((toast) => {\r\n    const id = toast.id || window.crypto?.randomUUID?.() || `${Date.now()}-${Math.random()}`;\r\n    const nextToast = {\r\n      id,\r\n      title: toast.title || 'Th√¥ng b√°o',\r\n      message: toast.message || '',\r\n      meta: toast.meta || '',\r\n      accent: toast.accent || 'info',\r\n    };\r\n    setToasts((prev) => [...prev, nextToast]);\r\n    const timeout = setTimeout(() => {\r\n      setToasts((prev) => prev.filter((item) => item.id !== id));\r\n    }, toast.duration || 6000);\r\n    toastTimersRef.current[id] = timeout;\r\n  }, []);\r\n\r\n  const dismissToast = useCallback((id) => {\r\n    setToasts((prev) => prev.filter((item) => item.id !== id));\r\n    if (toastTimersRef.current[id]) {\r\n      clearTimeout(toastTimersRef.current[id]);\r\n      delete toastTimersRef.current[id];\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (drawerOpen && !hasLoadedRef.current) {\r\n      fetchConversations();\r\n    }\r\n  }, [drawerOpen, fetchConversations]);\r\n\r\n  useEffect(() => {\r\n    const timers = toastTimersRef.current;\r\n    return () => {\r\n      Object.values(timers).forEach(clearTimeout);\r\n    };\r\n  }, []);\r\n\r\n  const handleOrderAlert = useCallback(\r\n    (payload) => {\r\n      if (!payload) return;\r\n      pushToast({\r\n        title: 'ƒê∆°n h√†ng c·∫≠p nh·∫≠t',\r\n        message: payload.message || `ƒê∆°n h√†ng #${payload.order_id} ƒë√£ c·∫≠p nh·∫≠t.`,\r\n        meta: payload.status_label,\r\n        accent: 'order',\r\n      });\r\n    },\r\n    [pushToast]\r\n  );\r\n\r\n  const handleChatSummary = useCallback(\r\n    (payload) => {\r\n      if (!payload?.conversation_id) return;\r\n      setConversations((prev) => {\r\n        let exists = false;\r\n        const mapped = prev\r\n          .map((conv) => {\r\n            if (conv.id === payload.conversation_id) {\r\n              exists = true;\r\n              return {\r\n                ...conv,\r\n                lastMessage: payload.last_message || conv.lastMessage,\r\n                updatedAt: payload.last_message_at || conv.updatedAt,\r\n                unreadCount:\r\n                  typeof payload.unread_count === 'number' ? payload.unread_count : conv.unreadCount,\r\n              };\r\n            }\r\n            return conv;\r\n          })\r\n          .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\r\n\r\n      if (exists) {\r\n        return mapped;\r\n      }\r\n\r\n      const newcomer = normalizeConversation({\r\n        id: payload.conversation_id,\r\n        buyer_id: payload.buyer_id,\r\n        buyer_name: payload.buyer_name,\r\n        shop_id: payload.shop_id,\r\n        shop_name: payload.shop_name,\r\n        product_id: payload.product_id,\r\n        product_name: payload.product_name,\r\n        last_message: payload.last_message,\r\n        last_message_at: payload.last_message_at,\r\n        unread_count: payload.unread_count || 0,\r\n      });\r\n      return [newcomer, ...mapped];\r\n      });\r\n\r\n      const isActive = activeConversation?.id === payload.conversation_id && drawerOpen;\r\n      if (!isActive && payload.sender_id !== user?.user_id) {\r\n        playMessageChime();\r\n      }\r\n    },\r\n    [activeConversation?.id, drawerOpen, playMessageChime, user?.user_id]\r\n  );\r\n\r\n  const handleConversationActivity = useCallback((conversationId, latest = {}) => {\r\n    if (!conversationId) return;\r\n    setConversations((prev) => {\r\n      let updated = false;\r\n      const mapped = prev\r\n        .map((conv) => {\r\n          if (conv.id !== conversationId) return conv;\r\n          updated = true;\r\n          return {\r\n            ...conv,\r\n            lastMessage: latest.lastMessage || conv.lastMessage,\r\n            updatedAt: latest.updatedAt || new Date().toISOString(),\r\n            unreadCount: typeof latest.unreadCount === 'number' ? latest.unreadCount : conv.unreadCount,\r\n          };\r\n        })\r\n        .sort((a, b) => new Date(b.updatedAt) - new Date(a.updatedAt));\r\n      return updated ? mapped : prev;\r\n    });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!user) return;\r\n    const token = localStorage.getItem('access_token');\r\n    if (!token) return;\r\n\r\n    const rawHost = API_BASE.replace(/^https?:\\/\\//, '');\r\n    const protocol = API_BASE.startsWith('https') ? 'wss' : 'ws';\r\n    const ws = new WebSocket(`${protocol}://${rawHost}/ws/notifications/?token=${token}`);\r\n    notificationSocketRef.current = ws;\r\n\r\n    ws.onmessage = (event) => {\r\n      try {\r\n        const data = JSON.parse(event.data);\r\n        if (data.type === 'order_status') handleOrderAlert(data);\r\n        if (data.type === 'chat_summary') handleChatSummary(data);\r\n      } catch (err) {\r\n        console.error('Notification WS parse error', err);\r\n      }\r\n    };\r\n    ws.onerror = (err) => console.error('Notification WS error', err);\r\n    ws.onclose = () => {\r\n      notificationSocketRef.current = null;\r\n    };\r\n\r\n    return () => ws.close();\r\n  }, [user, handleOrderAlert, handleChatSummary]);\r\n\r\n  const handleConversationClick = (conversation) => {\r\n    setActiveConversation(conversation);\r\n    setConversations((prev) =>\r\n      prev.map((item) =>\r\n        item.id === conversation.id ? { ...item, unreadCount: 0 } : item\r\n      )\r\n    );\r\n  };\r\n\r\n  const counterpartLabel = (conversation) => {\r\n    if (!conversation) return '';\r\n    return isSeller ? conversation.buyerName : conversation.shopName;\r\n  };\r\n\r\n  const toggleDrawer = () => {\r\n    ensureAudioContext();\r\n    setDrawerOpen((prev) => !prev);\r\n  };\r\n\r\n  const startResize = (event) => {\r\n    event.preventDefault();\r\n    const clientY = event.touches ? event.touches[0].clientY : event.clientY;\r\n    resizeStateRef.current = { startY: clientY, startHeight: drawerHeight };\r\n    setIsResizing(true);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!isResizing) return;\r\n    const handleMove = (event) => {\r\n      const clientY = event.touches ? event.touches[0].clientY : event.clientY;\r\n      const delta = resizeStateRef.current.startY - clientY;\r\n      const nextHeight = Math.max(260, Math.min(620, resizeStateRef.current.startHeight + delta));\r\n      setDrawerHeight(nextHeight);\r\n    };\r\n    const stopResize = () => setIsResizing(false);\r\n\r\n    window.addEventListener('mousemove', handleMove);\r\n    window.addEventListener('touchmove', handleMove);\r\n    window.addEventListener('mouseup', stopResize);\r\n    window.addEventListener('touchend', stopResize);\r\n\r\n    return () => {\r\n      window.removeEventListener('mousemove', handleMove);\r\n      window.removeEventListener('touchmove', handleMove);\r\n      window.removeEventListener('mouseup', stopResize);\r\n      window.removeEventListener('touchend', stopResize);\r\n    };\r\n  }, [isResizing]);\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <>\r\n      <button\r\n        className=\"chat-floating-button\"\r\n        onClick={toggleDrawer}\r\n        aria-label=\"M·ªü chat\"\r\n      >\r\n        üí¨\r\n        {unreadTotal > 0 && (\r\n          <span className=\"chat-floating-button__badge\">\r\n            {unreadTotal > 99 ? '99+' : unreadTotal}\r\n          </span>\r\n        )}\r\n      </button>\r\n\r\n      <div\r\n        className={`chat-drawer ${drawerOpen ? 'open' : ''} ${isResizing ? 'resizing' : ''}`}\r\n        style={{ height: `${drawerHeight}px` }}\r\n      >\r\n        <div\r\n          className=\"chat-drawer__handle\"\r\n          role=\"presentation\"\r\n          onMouseDown={startResize}\r\n          onTouchStart={startResize}\r\n        />\r\n        <div className=\"chat-drawer__header\">\r\n          <div>\r\n            <p>H·ªôp th∆∞</p>\r\n            <h4>Cu·ªôc tr√≤ chuy·ªán</h4>\r\n          </div>\r\n          <button onClick={() => setDrawerOpen(false)} aria-label=\"ƒê√≥ng chat\">√ó</button>\r\n        </div>\r\n\r\n        <div className=\"chat-drawer__body\">\r\n          {loading && <div className=\"chat-drawer__empty\">ƒêang t·∫£i cu·ªôc tr√≤ chuy·ªán...</div>}\r\n          {!loading && error && <div className=\"chat-drawer__error\">{error}</div>}\r\n          {!loading && !conversations.length && !error && (\r\n            <div className=\"chat-drawer__empty\">Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán n√†o.</div>\r\n          )}\r\n\r\n          <div className=\"chat-conversation-list\">\r\n            {conversations.map((conversation) => (\r\n              <button\r\n                key={conversation.id}\r\n                className={`chat-conversation-item ${\r\n                  activeConversation?.id === conversation.id ? 'active' : ''\r\n                }`}\r\n                onClick={() => handleConversationClick(conversation)}\r\n              >\r\n                <div className=\"chat-conversation-item__avatar\">\r\n                  {conversation.shopAvatar ? (\r\n                    <img src={conversation.shopAvatar} alt={conversation.shopName} />\r\n                  ) : (\r\n                    <span>{counterpartLabel(conversation)?.charAt(0)}</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"chat-conversation-item__content\">\r\n                  <div className=\"chat-conversation-item__row\">\r\n                    <strong>{counterpartLabel(conversation)}</strong>\r\n                    <span>{formatRelativeTime(conversation.updatedAt)}</span>\r\n                  </div>\r\n                  <p>\r\n                    {conversation.productName && <em>{conversation.productName} ‚Ä¢ </em>}\r\n                    {conversation.lastMessage}\r\n                  </p>\r\n                </div>\r\n                {conversation.unreadCount > 0 && (\r\n                  <span className=\"chat-conversation-item__badge\">{conversation.unreadCount}</span>\r\n                )}\r\n              </button>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {activeConversation && (\r\n        <ChatPopup\r\n          conversation={activeConversation}\r\n          onClose={() => setActiveConversation(null)}\r\n          isSeller={isSeller}\r\n          counterpartName={counterpartLabel(activeConversation)}\r\n          onIncomingMessage={playMessageChime}\r\n          onConversationActivity={handleConversationActivity}\r\n        />\r\n      )}\r\n\r\n      <div className=\"notification-toast-stack\">\r\n        {toasts.map((toast) => (\r\n          <div key={toast.id} className={`notification-toast notification-toast--${toast.accent}`}>\r\n            <div>\r\n              <p>{toast.title}</p>\r\n              <strong>{toast.message}</strong>\r\n              {toast.meta && <span>{toast.meta}</span>}\r\n            </div>\r\n            <button onClick={() => dismissToast(toast.id)} aria-label=\"ƒê√≥ng th√¥ng b√°o\">√ó</button>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nconst ChatPopup = ({ conversation, onClose, isSeller, counterpartName, onIncomingMessage, onConversationActivity }) => {\r\n  const { user } = useAuth();\r\n  const [messages, setMessages] = useState([]);\r\n  const [text, setText] = useState('');\r\n  const [connecting, setConnecting] = useState(false);\r\n  const wsRef = useRef(null);\r\n  const bottomRef = useRef(null);\r\n\r\n  const shopId = useMemo(() => {\r\n    if (isSeller) return conversation.shopId || user?.user_id;\r\n    return conversation.shopId;\r\n  }, [conversation.shopId, isSeller, user?.user_id]);\r\n\r\n  const buyerParam = useMemo(() => {\r\n    if (isSeller) return conversation.buyerId;\r\n    return user?.user_id;\r\n  }, [conversation.buyerId, isSeller, user?.user_id]);\r\n\r\n  useEffect(() => {\r\n    if (!conversation || !shopId || !buyerParam || !user) return;\r\n\r\n    const token = localStorage.getItem('access_token') || '';\r\n    const raw = API_BASE.replace(/^https?:\\/\\//, '');\r\n    const wsProtocol = API_BASE.startsWith('https') ? 'wss' : 'ws';\r\n    const qs = new URLSearchParams({ token, buyer: buyerParam });\r\n    if (conversation.productId) qs.set('product', conversation.productId);\r\n\r\n    const wsUrl = `${wsProtocol}://${raw}/ws/chat/${shopId}/?${qs.toString()}`;\r\n    const ws = new WebSocket(wsUrl);\r\n    wsRef.current = ws;\r\n    setConnecting(true);\r\n\r\n    ws.onopen = () => setConnecting(false);\r\n    ws.onmessage = (evt) => {\r\n      try {\r\n        const data = JSON.parse(evt.data);\r\n        if (data.type === 'history') setMessages(data.messages || []);\r\n        else if (data.type === 'message' && data.message) {\r\n          setMessages((prev) => [...prev, data.message]);\r\n          if (data.message.sender_id !== user?.user_id && typeof onIncomingMessage === 'function') {\r\n            onIncomingMessage();\r\n          }\r\n          if (typeof onConversationActivity === 'function') {\r\n            onConversationActivity(conversation?.id, {\r\n              lastMessage: data.message.content,\r\n              updatedAt: data.message.created_at,\r\n              unreadCount: 0,\r\n            });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('WS parse error', error);\r\n      }\r\n    };\r\n    ws.onclose = (evt) => console.log('Chat popup WS closed', evt);\r\n    ws.onerror = (error) => console.error('Chat popup WS error', error);\r\n\r\n    return () => ws.close();\r\n  }, [conversation, buyerParam, shopId, user, onIncomingMessage, onConversationActivity]);\r\n\r\n  useEffect(() => {\r\n    bottomRef.current?.scrollIntoView({ behavior: 'smooth' });\r\n  }, [messages]);\r\n\r\n  const sendMessage = () => {\r\n    const content = text.trim();\r\n    if (!content || !wsRef.current || wsRef.current.readyState !== 1) return;\r\n    wsRef.current.send(JSON.stringify({ type: 'message', content }));\r\n    setText('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-popup\">\r\n      <div className=\"chat-popup__header\">\r\n        <div>\r\n          <p>{conversation.productName || 'Tr√≤ chuy·ªán'}</p>\r\n          <strong>{counterpartName}</strong>\r\n        </div>\r\n        <button onClick={onClose} aria-label=\"ƒê√≥ng cu·ªôc tr√≤ chuy·ªán\">√ó</button>\r\n      </div>\r\n\r\n      <div className=\"chat-popup__body\">\r\n        {connecting && <div className=\"chat-popup__info\">ƒêang k·∫øt n·ªëi...</div>}\r\n        {messages.map((message) => (\r\n          <div\r\n            key={message.id || `${message.created_at}-${message.sender_id}`}\r\n            className={`chat-popup__message ${message.sender_id === user?.user_id ? 'me' : ''}`}\r\n          >\r\n            <div className=\"chat-popup__bubble\">\r\n              <div>{message.content}</div>\r\n              <span>{new Date(message.created_at).toLocaleString('vi-VN')}</span>\r\n            </div>\r\n          </div>\r\n        ))}\r\n        <div ref={bottomRef} />\r\n      </div>\r\n\r\n      <div className=\"chat-popup__footer\">\r\n        <input\r\n          value={text}\r\n          onChange={(e) => setText(e.target.value)}\r\n          onKeyDown={(e) => e.key === 'Enter' && sendMessage()}\r\n          placeholder=\"Nh·∫≠p n·ªôi dung...\"\r\n        />\r\n        <button onClick={sendMessage}>G·ª≠i</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatWidget;\r\n"],"mappings":"+GAAA,MAAO,CAAAA,KAAK,EAAIC,WAAW,CAAEC,SAAS,CAAEC,OAAO,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CAChF,OAASC,OAAO,KAAQ,sBAAsB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE/C,KAAM,CAAAC,QAAQ,CAAGC,OAAO,CAACC,GAAG,CAACC,kBAAkB,EAAI,uBAAuB,CAE1E,KAAM,CAAAC,kBAAkB,CAAIC,SAAS,EAAK,CACxC,GAAI,CAACA,SAAS,CAAE,MAAO,EAAE,CACzB,KAAM,CAAAC,IAAI,CAAG,GAAI,CAAAC,IAAI,CAACF,SAAS,CAAC,CAChC,KAAM,CAAAG,IAAI,CAAGD,IAAI,CAACE,GAAG,CAAC,CAAC,CAAGH,IAAI,CAACI,OAAO,CAAC,CAAC,CACxC,GAAIF,IAAI,CAAG,KAAK,CAAE,MAAO,UAAU,CACnC,GAAIA,IAAI,CAAG,OAAO,CAAE,SAAAG,MAAA,CAAUC,IAAI,CAACC,KAAK,CAACL,IAAI,CAAG,KAAK,CAAC,6BACtD,GAAIA,IAAI,CAAG,QAAQ,CAAE,SAAAG,MAAA,CAAUC,IAAI,CAACC,KAAK,CAACL,IAAI,CAAG,OAAO,CAAC,8BACzD,MAAO,CAAAF,IAAI,CAACQ,kBAAkB,CAAC,OAAO,CAAC,CACzC,CAAC,CAED,KAAM,CAAAC,qBAAqB,CAAG,QAAAA,CAAA,MAAAC,SAAA,CAAAC,UAAA,CAAAC,UAAA,CAAAC,UAAA,CAAAC,WAAA,CAAAC,YAAA,CAAAC,aAAA,IAAC,CAAAC,GAAG,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,OAAM,CAC3CG,EAAE,CAAEJ,GAAG,CAACI,EAAE,EAAIJ,GAAG,CAACK,eAAe,KAAAjB,MAAA,CAAOY,GAAG,CAACM,OAAO,EAAI,MAAM,MAAAlB,MAAA,CAAIY,GAAG,CAACO,QAAQ,EAAI,OAAO,CAAE,CAC1FC,MAAM,CAAER,GAAG,CAACM,OAAO,IAAAb,SAAA,CAAIO,GAAG,CAACS,IAAI,UAAAhB,SAAA,iBAARA,SAAA,CAAUW,EAAE,GAAIJ,GAAG,CAACQ,MAAM,CACjDE,QAAQ,CAAEV,GAAG,CAACW,SAAS,IAAAjB,UAAA,CAAIM,GAAG,CAACS,IAAI,UAAAf,UAAA,iBAARA,UAAA,CAAUkB,IAAI,GAAIZ,GAAG,CAACU,QAAQ,WAAAtB,MAAA,CAAaY,GAAG,CAACM,OAAO,EAAIN,GAAG,CAACQ,MAAM,EAAI,GAAG,CAAE,CACxGK,UAAU,CAAEb,GAAG,CAACc,WAAW,IAAAnB,UAAA,CAAIK,GAAG,CAACS,IAAI,UAAAd,UAAA,iBAARA,UAAA,CAAUoB,MAAM,EAC/CC,OAAO,CAAEhB,GAAG,CAACO,QAAQ,IAAAX,UAAA,CAAII,GAAG,CAACiB,KAAK,UAAArB,UAAA,iBAATA,UAAA,CAAWQ,EAAE,GAAIJ,GAAG,CAACgB,OAAO,CACrDE,SAAS,CAAElB,GAAG,CAACmB,UAAU,IAAAtB,WAAA,CAAIG,GAAG,CAACiB,KAAK,UAAApB,WAAA,iBAATA,WAAA,CAAWuB,SAAS,GAAIpB,GAAG,CAACkB,SAAS,eAAA9B,MAAA,CAAcY,GAAG,CAACO,QAAQ,EAAIP,GAAG,CAACgB,OAAO,EAAI,GAAG,CAAE,CACpHK,SAAS,CAAErB,GAAG,CAACsB,UAAU,IAAAxB,YAAA,CAAIE,GAAG,CAACuB,OAAO,UAAAzB,YAAA,iBAAXA,YAAA,CAAaM,EAAE,EAC5CoB,WAAW,CAAExB,GAAG,CAACyB,YAAY,IAAA1B,aAAA,CAAIC,GAAG,CAACuB,OAAO,UAAAxB,aAAA,iBAAXA,aAAA,CAAaa,IAAI,EAClDc,WAAW,CAAE1B,GAAG,CAAC2B,YAAY,EAAI3B,GAAG,CAAC0B,WAAW,EAAI,kBAAkB,CACtEE,SAAS,CAAE5B,GAAG,CAAC6B,UAAU,EAAI7B,GAAG,CAAC8B,eAAe,EAAI9B,GAAG,CAAC4B,SAAS,EAAI,GAAI,CAAA5C,IAAI,CAAC,CAAC,CAAC+C,WAAW,CAAC,CAAC,CAC7FC,WAAW,CAAEhC,GAAG,CAACiC,YAAY,EAAIjC,GAAG,CAACgC,WAAW,EAAI,CACtD,CAAC,EAAC,CAEF,KAAM,CAAAE,0BAA0B,CAAIC,IAAI,EAAK,CAC3C,GAAI,CAACA,IAAI,CAAE,MAAO,EAAE,CACpB,KAAM,CAAAjD,GAAG,CAAG,GAAI,CAAAF,IAAI,CAAC,CAAC,CACtB,MAAO,CACL,CACEoB,EAAE,CAAE,QAAQ,CACZI,MAAM,CAAE2B,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAGD,IAAI,CAACE,OAAO,CAAG,GAAG,CACxD3B,QAAQ,CAAEyB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,cAAc,CAAG,iBAAiB,CAC1EpB,OAAO,CAAEmB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,GAAG,CAAGD,IAAI,CAACE,OAAO,CACzDnB,SAAS,CAAEiB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,WAAW,CAAG,KAAK,CAC5DZ,WAAW,CAAE,qBAAqB,CAClCE,WAAW,CAAE,kCAAkC,CAC/CE,SAAS,CAAE1C,GAAG,CAAC6C,WAAW,CAAC,CAAC,CAC5BC,WAAW,CAAEG,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,CAAC,CAAG,CACjD,CAAC,CACD,CACEhC,EAAE,CAAE,QAAQ,CACZI,MAAM,CAAE2B,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAGD,IAAI,CAACE,OAAO,CAAG,GAAG,CACxD3B,QAAQ,CAAEyB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,cAAc,CAAG,kBAAkB,CAC3EpB,OAAO,CAAEmB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,GAAG,CAAGD,IAAI,CAACE,OAAO,CACzDnB,SAAS,CAAEiB,IAAI,CAACC,SAAS,GAAK,QAAQ,CAAG,eAAe,CAAG,KAAK,CAChEZ,WAAW,CAAE,kBAAkB,CAC/BE,WAAW,CAAE,oDAAoD,CACjEE,SAAS,CAAE,GAAI,CAAA5C,IAAI,CAACE,GAAG,CAACC,OAAO,CAAC,CAAC,CAAG,OAAO,CAAC,CAAC4C,WAAW,CAAC,CAAC,CAC1DC,WAAW,CAAE,CACf,CAAC,CACF,CACH,CAAC,CAED,KAAM,CAAAM,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAAEH,IAAK,CAAC,CAAGjE,OAAO,CAAC,CAAC,CAC1B,KAAM,CAACqE,UAAU,CAAEC,aAAa,CAAC,CAAGvE,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAACwE,aAAa,CAAEC,gBAAgB,CAAC,CAAGzE,QAAQ,CAAC,EAAE,CAAC,CACtD,KAAM,CAAC0E,OAAO,CAAEC,UAAU,CAAC,CAAG3E,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAAC4E,KAAK,CAAEC,QAAQ,CAAC,CAAG7E,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAAC8E,kBAAkB,CAAEC,qBAAqB,CAAC,CAAG/E,QAAQ,CAAC,IAAI,CAAC,CAClE,KAAM,CAAAgF,YAAY,CAAGjF,MAAM,CAAC,KAAK,CAAC,CAClC,KAAM,CAACkF,YAAY,CAAEC,eAAe,CAAC,CAAGlF,QAAQ,CAAC,GAAG,CAAC,CACrD,KAAM,CAACmF,UAAU,CAAEC,aAAa,CAAC,CAAGpF,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAAAqF,cAAc,CAAGtF,MAAM,CAAC,CAAEuF,MAAM,CAAE,CAAC,CAAEC,WAAW,CAAE,GAAI,CAAC,CAAC,CAC9D,KAAM,CAAAC,qBAAqB,CAAGzF,MAAM,CAAC,IAAI,CAAC,CAC1C,KAAM,CAAA0F,eAAe,CAAG1F,MAAM,CAAC,IAAI,CAAC,CACpC,KAAM,CAAC2F,MAAM,CAAEC,SAAS,CAAC,CAAG3F,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAAA4F,cAAc,CAAG7F,MAAM,CAAC,CAAC,CAAC,CAAC,CACjC,KAAM,CAAC8F,WAAW,CAAEC,cAAc,CAAC,CAAG9F,QAAQ,CAAC,CAAC,CAAC,CAEjD,KAAM,CAAA+F,QAAQ,CAAG,CAAA7B,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEC,SAAS,IAAK,QAAQ,CAE7C,KAAM,CAAA6B,kBAAkB,CAAGpG,WAAW,CAAC,SAAY,CACjD,GAAI,CAACsE,IAAI,CAAE,OACXS,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,EAAE,CAAC,CACZ,GAAI,CACF,KAAM,CAAAoB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAClD,GAAI,CAACF,KAAK,CAAE,KAAM,IAAI,CAAAG,KAAK,CAAC,qCAAqC,CAAC,CAClE,KAAM,CAAAC,GAAG,CAAG,KAAM,CAAAC,KAAK,IAAAnF,MAAA,CAAIX,QAAQ,6BAA4B,CAC7D+F,OAAO,CAAE,CACPC,aAAa,WAAArF,MAAA,CAAY8E,KAAK,CAChC,CACF,CAAC,CAAC,CACF,GAAI,CAACI,GAAG,CAACI,EAAE,CAAE,KAAM,IAAI,CAAAL,KAAK,CAAC,gCAAgC,CAAC,CAC9D,KAAM,CAAAM,IAAI,CAAG,KAAM,CAAAL,GAAG,CAACM,IAAI,CAAC,CAAC,CAC7B,KAAM,CAAAC,IAAI,CAAGC,KAAK,CAACC,OAAO,CAACJ,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEK,OAAO,CAAC,CAAGL,IAAI,CAACK,OAAO,CAAGF,KAAK,CAACC,OAAO,CAACJ,IAAI,CAAC,CAAGA,IAAI,CAAG,EAAE,CAC1FjC,gBAAgB,CAACmC,IAAI,CAACI,GAAG,CAACzF,qBAAqB,CAAC,CAAC,CACjDyD,YAAY,CAACiC,OAAO,CAAG,IAAI,CAC7B,CAAE,MAAOC,GAAG,CAAE,CACZC,OAAO,CAACvC,KAAK,CAAC,4BAA4B,CAAEsC,GAAG,CAAC,CAChD,GAAI,CAAClC,YAAY,CAACiC,OAAO,CAAE,CACzBxC,gBAAgB,CAACR,0BAA0B,CAACC,IAAI,CAAC,CAAC8C,GAAG,CAACzF,qBAAqB,CAAC,CAAC,CAC/E,CACAsD,QAAQ,CAACqC,GAAG,CAACE,OAAO,EAAI,kDAAkD,CAAC,CAC7E,CAAC,OAAS,CACRzC,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAE,CAACT,IAAI,CAAC,CAAC,CAEVrE,SAAS,CAAC,IAAM,CACdiG,cAAc,CAACtB,aAAa,CAAC6C,MAAM,CAAC,CAACC,GAAG,CAAEC,IAAI,GAAKD,GAAG,EAAIC,IAAI,CAACxD,WAAW,EAAI,CAAC,CAAC,CAAE,CAAC,CAAC,CAAC,CACvF,CAAC,CAAE,CAACS,aAAa,CAAC,CAAC,CAEnB,KAAM,CAAAgD,kBAAkB,CAAG5H,WAAW,CAAC,IAAM,CAC3C,KAAM,CAAA6H,iBAAiB,CAAGC,MAAM,CAACC,YAAY,EAAID,MAAM,CAACE,kBAAkB,CAC1E,GAAI,CAACH,iBAAiB,CAAE,MAAO,KAAI,CACnC,GAAI,CAAChC,eAAe,CAACwB,OAAO,CAAE,CAC5BxB,eAAe,CAACwB,OAAO,CAAG,GAAI,CAAAQ,iBAAiB,CAAC,CAAC,CACnD,CACA,GAAIhC,eAAe,CAACwB,OAAO,CAACY,KAAK,GAAK,WAAW,CAAE,CACjDpC,eAAe,CAACwB,OAAO,CAACa,MAAM,CAAC,CAAC,CAClC,CACA,MAAO,CAAArC,eAAe,CAACwB,OAAO,CAChC,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAc,gBAAgB,CAAGnI,WAAW,CAAC,IAAM,CACzC,KAAM,CAAAoI,GAAG,CAAGR,kBAAkB,CAAC,CAAC,CAChC,GAAI,CAACQ,GAAG,CAAE,OACV,GAAI,CACF,KAAM,CAAAC,UAAU,CAAGD,GAAG,CAACE,gBAAgB,CAAC,CAAC,CACzC,KAAM,CAAAC,QAAQ,CAAGH,GAAG,CAACI,UAAU,CAAC,CAAC,CACjCH,UAAU,CAACI,IAAI,CAAG,UAAU,CAC5BJ,UAAU,CAACK,SAAS,CAACC,KAAK,CAAG,GAAG,CAChCJ,QAAQ,CAACK,IAAI,CAACD,KAAK,CAAG,IAAI,CAC1BN,UAAU,CAACQ,OAAO,CAACN,QAAQ,CAAC,CAC5BA,QAAQ,CAACM,OAAO,CAACT,GAAG,CAACU,WAAW,CAAC,CACjCT,UAAU,CAACU,KAAK,CAAC,CAAC,CAClBV,UAAU,CAACW,IAAI,CAACZ,GAAG,CAACa,WAAW,CAAG,GAAG,CAAC,CACxC,CAAE,MAAO3B,GAAG,CAAE,CACZC,OAAO,CAAC2B,IAAI,CAAC,sBAAsB,CAAE5B,GAAG,CAAC,CAC3C,CACF,CAAC,CAAE,CAACM,kBAAkB,CAAC,CAAC,CAExB,KAAM,CAAAuB,SAAS,CAAGnJ,WAAW,CAAEoJ,KAAK,EAAK,KAAAC,cAAA,CAAAC,qBAAA,CACvC,KAAM,CAAA/G,EAAE,CAAG6G,KAAK,CAAC7G,EAAE,IAAA8G,cAAA,CAAIvB,MAAM,CAACyB,MAAM,UAAAF,cAAA,kBAAAC,qBAAA,CAAbD,cAAA,CAAeG,UAAU,UAAAF,qBAAA,iBAAzBA,qBAAA,CAAAG,IAAA,CAAAJ,cAA4B,CAAC,MAAA9H,MAAA,CAAOJ,IAAI,CAACE,GAAG,CAAC,CAAC,MAAAE,MAAA,CAAIC,IAAI,CAACkI,MAAM,CAAC,CAAC,CAAE,CACxF,KAAM,CAAAC,SAAS,CAAG,CAChBpH,EAAE,CACFqH,KAAK,CAAER,KAAK,CAACQ,KAAK,EAAI,WAAW,CACjCpC,OAAO,CAAE4B,KAAK,CAAC5B,OAAO,EAAI,EAAE,CAC5BqC,IAAI,CAAET,KAAK,CAACS,IAAI,EAAI,EAAE,CACtBC,MAAM,CAAEV,KAAK,CAACU,MAAM,EAAI,MAC1B,CAAC,CACD/D,SAAS,CAAEgE,IAAI,EAAK,CAAC,GAAGA,IAAI,CAAEJ,SAAS,CAAC,CAAC,CACzC,KAAM,CAAAK,OAAO,CAAGC,UAAU,CAAC,IAAM,CAC/BlE,SAAS,CAAEgE,IAAI,EAAKA,IAAI,CAACG,MAAM,CAAEvC,IAAI,EAAKA,IAAI,CAACpF,EAAE,GAAKA,EAAE,CAAC,CAAC,CAC5D,CAAC,CAAE6G,KAAK,CAACe,QAAQ,EAAI,IAAI,CAAC,CAC1BnE,cAAc,CAACqB,OAAO,CAAC9E,EAAE,CAAC,CAAGyH,OAAO,CACtC,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAI,YAAY,CAAGpK,WAAW,CAAEuC,EAAE,EAAK,CACvCwD,SAAS,CAAEgE,IAAI,EAAKA,IAAI,CAACG,MAAM,CAAEvC,IAAI,EAAKA,IAAI,CAACpF,EAAE,GAAKA,EAAE,CAAC,CAAC,CAC1D,GAAIyD,cAAc,CAACqB,OAAO,CAAC9E,EAAE,CAAC,CAAE,CAC9B8H,YAAY,CAACrE,cAAc,CAACqB,OAAO,CAAC9E,EAAE,CAAC,CAAC,CACxC,MAAO,CAAAyD,cAAc,CAACqB,OAAO,CAAC9E,EAAE,CAAC,CACnC,CACF,CAAC,CAAE,EAAE,CAAC,CAENtC,SAAS,CAAC,IAAM,CACd,GAAIyE,UAAU,EAAI,CAACU,YAAY,CAACiC,OAAO,CAAE,CACvCjB,kBAAkB,CAAC,CAAC,CACtB,CACF,CAAC,CAAE,CAAC1B,UAAU,CAAE0B,kBAAkB,CAAC,CAAC,CAEpCnG,SAAS,CAAC,IAAM,CACd,KAAM,CAAAqK,MAAM,CAAGtE,cAAc,CAACqB,OAAO,CACrC,MAAO,IAAM,CACXkD,MAAM,CAACC,MAAM,CAACF,MAAM,CAAC,CAACG,OAAO,CAACJ,YAAY,CAAC,CAC7C,CAAC,CACH,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAK,gBAAgB,CAAG1K,WAAW,CACjC2K,OAAO,EAAK,CACX,GAAI,CAACA,OAAO,CAAE,OACdxB,SAAS,CAAC,CACRS,KAAK,CAAE,mBAAmB,CAC1BpC,OAAO,CAAEmD,OAAO,CAACnD,OAAO,4BAAAjG,MAAA,CAAiBoJ,OAAO,CAACC,QAAQ,mCAAe,CACxEf,IAAI,CAAEc,OAAO,CAACE,YAAY,CAC1Bf,MAAM,CAAE,OACV,CAAC,CAAC,CACJ,CAAC,CACD,CAACX,SAAS,CACZ,CAAC,CAED,KAAM,CAAA2B,iBAAiB,CAAG9K,WAAW,CAClC2K,OAAO,EAAK,CACX,GAAI,EAACA,OAAO,SAAPA,OAAO,WAAPA,OAAO,CAAEnI,eAAe,EAAE,OAC/BqC,gBAAgB,CAAEkF,IAAI,EAAK,CACzB,GAAI,CAAAgB,MAAM,CAAG,KAAK,CAClB,KAAM,CAAAC,MAAM,CAAGjB,IAAI,CAChB3C,GAAG,CAAE6D,IAAI,EAAK,CACb,GAAIA,IAAI,CAAC1I,EAAE,GAAKoI,OAAO,CAACnI,eAAe,CAAE,CACvCuI,MAAM,CAAG,IAAI,CACb,OAAAG,aAAA,CAAAA,aAAA,IACKD,IAAI,MACPpH,WAAW,CAAE8G,OAAO,CAAC7G,YAAY,EAAImH,IAAI,CAACpH,WAAW,CACrDE,SAAS,CAAE4G,OAAO,CAAC1G,eAAe,EAAIgH,IAAI,CAAClH,SAAS,CACpDI,WAAW,CACT,MAAO,CAAAwG,OAAO,CAACvG,YAAY,GAAK,QAAQ,CAAGuG,OAAO,CAACvG,YAAY,CAAG6G,IAAI,CAAC9G,WAAW,GAExF,CACA,MAAO,CAAA8G,IAAI,CACb,CAAC,CAAC,CACDE,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAlK,IAAI,CAACkK,CAAC,CAACtH,SAAS,CAAC,CAAG,GAAI,CAAA5C,IAAI,CAACiK,CAAC,CAACrH,SAAS,CAAC,CAAC,CAElE,GAAIgH,MAAM,CAAE,CACV,MAAO,CAAAC,MAAM,CACf,CAEA,KAAM,CAAAM,QAAQ,CAAG3J,qBAAqB,CAAC,CACrCY,EAAE,CAAEoI,OAAO,CAACnI,eAAe,CAC3BE,QAAQ,CAAEiI,OAAO,CAACjI,QAAQ,CAC1BY,UAAU,CAAEqH,OAAO,CAACrH,UAAU,CAC9Bb,OAAO,CAAEkI,OAAO,CAAClI,OAAO,CACxBK,SAAS,CAAE6H,OAAO,CAAC7H,SAAS,CAC5BW,UAAU,CAAEkH,OAAO,CAAClH,UAAU,CAC9BG,YAAY,CAAE+G,OAAO,CAAC/G,YAAY,CAClCE,YAAY,CAAE6G,OAAO,CAAC7G,YAAY,CAClCG,eAAe,CAAE0G,OAAO,CAAC1G,eAAe,CACxCG,YAAY,CAAEuG,OAAO,CAACvG,YAAY,EAAI,CACxC,CAAC,CAAC,CACF,MAAO,CAACkH,QAAQ,CAAE,GAAGN,MAAM,CAAC,CAC5B,CAAC,CAAC,CAEF,KAAM,CAAAO,QAAQ,CAAG,CAAArG,kBAAkB,SAAlBA,kBAAkB,iBAAlBA,kBAAkB,CAAE3C,EAAE,IAAKoI,OAAO,CAACnI,eAAe,EAAIkC,UAAU,CACjF,GAAI,CAAC6G,QAAQ,EAAIZ,OAAO,CAACa,SAAS,IAAKlH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,EAAE,CACpD2D,gBAAgB,CAAC,CAAC,CACpB,CACF,CAAC,CACD,CAACjD,kBAAkB,SAAlBA,kBAAkB,iBAAlBA,kBAAkB,CAAE3C,EAAE,CAAEmC,UAAU,CAAEyD,gBAAgB,CAAE7D,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,CACtE,CAAC,CAED,KAAM,CAAAiH,0BAA0B,CAAGzL,WAAW,CAAC,SAAC0L,cAAc,CAAkB,IAAhB,CAAAC,MAAM,CAAAvJ,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,CAAC,CAAC,CACzE,GAAI,CAACsJ,cAAc,CAAE,OACrB7G,gBAAgB,CAAEkF,IAAI,EAAK,CACzB,GAAI,CAAA6B,OAAO,CAAG,KAAK,CACnB,KAAM,CAAAZ,MAAM,CAAGjB,IAAI,CAChB3C,GAAG,CAAE6D,IAAI,EAAK,CACb,GAAIA,IAAI,CAAC1I,EAAE,GAAKmJ,cAAc,CAAE,MAAO,CAAAT,IAAI,CAC3CW,OAAO,CAAG,IAAI,CACd,OAAAV,aAAA,CAAAA,aAAA,IACKD,IAAI,MACPpH,WAAW,CAAE8H,MAAM,CAAC9H,WAAW,EAAIoH,IAAI,CAACpH,WAAW,CACnDE,SAAS,CAAE4H,MAAM,CAAC5H,SAAS,EAAI,GAAI,CAAA5C,IAAI,CAAC,CAAC,CAAC+C,WAAW,CAAC,CAAC,CACvDC,WAAW,CAAE,MAAO,CAAAwH,MAAM,CAACxH,WAAW,GAAK,QAAQ,CAAGwH,MAAM,CAACxH,WAAW,CAAG8G,IAAI,CAAC9G,WAAW,GAE/F,CAAC,CAAC,CACDgH,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAlK,IAAI,CAACkK,CAAC,CAACtH,SAAS,CAAC,CAAG,GAAI,CAAA5C,IAAI,CAACiK,CAAC,CAACrH,SAAS,CAAC,CAAC,CAChE,MAAO,CAAA6H,OAAO,CAAGZ,MAAM,CAAGjB,IAAI,CAChC,CAAC,CAAC,CACJ,CAAC,CAAE,EAAE,CAAC,CAEN9J,SAAS,CAAC,IAAM,CACd,GAAI,CAACqE,IAAI,CAAE,OACX,KAAM,CAAA+B,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,CAClD,GAAI,CAACF,KAAK,CAAE,OAEZ,KAAM,CAAAwF,OAAO,CAAGjL,QAAQ,CAACkL,OAAO,CAAC,cAAc,CAAE,EAAE,CAAC,CACpD,KAAM,CAAAC,QAAQ,CAAGnL,QAAQ,CAACoL,UAAU,CAAC,OAAO,CAAC,CAAG,KAAK,CAAG,IAAI,CAC5D,KAAM,CAAAC,EAAE,CAAG,GAAI,CAAAC,SAAS,IAAA3K,MAAA,CAAIwK,QAAQ,QAAAxK,MAAA,CAAMsK,OAAO,8BAAAtK,MAAA,CAA4B8E,KAAK,CAAE,CAAC,CACrFT,qBAAqB,CAACyB,OAAO,CAAG4E,EAAE,CAElCA,EAAE,CAACE,SAAS,CAAIC,KAAK,EAAK,CACxB,GAAI,CACF,KAAM,CAAAtF,IAAI,CAAGuF,IAAI,CAACC,KAAK,CAACF,KAAK,CAACtF,IAAI,CAAC,CACnC,GAAIA,IAAI,CAAC2B,IAAI,GAAK,cAAc,CAAEiC,gBAAgB,CAAC5D,IAAI,CAAC,CACxD,GAAIA,IAAI,CAAC2B,IAAI,GAAK,cAAc,CAAEqC,iBAAiB,CAAChE,IAAI,CAAC,CAC3D,CAAE,MAAOQ,GAAG,CAAE,CACZC,OAAO,CAACvC,KAAK,CAAC,6BAA6B,CAAEsC,GAAG,CAAC,CACnD,CACF,CAAC,CACD2E,EAAE,CAACM,OAAO,CAAIjF,GAAG,EAAKC,OAAO,CAACvC,KAAK,CAAC,uBAAuB,CAAEsC,GAAG,CAAC,CACjE2E,EAAE,CAACO,OAAO,CAAG,IAAM,CACjB5G,qBAAqB,CAACyB,OAAO,CAAG,IAAI,CACtC,CAAC,CAED,MAAO,IAAM4E,EAAE,CAACQ,KAAK,CAAC,CAAC,CACzB,CAAC,CAAE,CAACnI,IAAI,CAAEoG,gBAAgB,CAAEI,iBAAiB,CAAC,CAAC,CAE/C,KAAM,CAAA4B,uBAAuB,CAAIC,YAAY,EAAK,CAChDxH,qBAAqB,CAACwH,YAAY,CAAC,CACnC9H,gBAAgB,CAAEkF,IAAI,EACpBA,IAAI,CAAC3C,GAAG,CAAEO,IAAI,EACZA,IAAI,CAACpF,EAAE,GAAKoK,YAAY,CAACpK,EAAE,CAAA2I,aAAA,CAAAA,aAAA,IAAQvD,IAAI,MAAExD,WAAW,CAAE,CAAC,GAAKwD,IAC9D,CACF,CAAC,CACH,CAAC,CAED,KAAM,CAAAiF,gBAAgB,CAAID,YAAY,EAAK,CACzC,GAAI,CAACA,YAAY,CAAE,MAAO,EAAE,CAC5B,MAAO,CAAAxG,QAAQ,CAAGwG,YAAY,CAACtJ,SAAS,CAAGsJ,YAAY,CAAC9J,QAAQ,CAClE,CAAC,CAED,KAAM,CAAAgK,YAAY,CAAGA,CAAA,GAAM,CACzBjF,kBAAkB,CAAC,CAAC,CACpBjD,aAAa,CAAEoF,IAAI,EAAK,CAACA,IAAI,CAAC,CAChC,CAAC,CAED,KAAM,CAAA+C,WAAW,CAAIV,KAAK,EAAK,CAC7BA,KAAK,CAACW,cAAc,CAAC,CAAC,CACtB,KAAM,CAAAC,OAAO,CAAGZ,KAAK,CAACa,OAAO,CAAGb,KAAK,CAACa,OAAO,CAAC,CAAC,CAAC,CAACD,OAAO,CAAGZ,KAAK,CAACY,OAAO,CACxEvH,cAAc,CAAC4B,OAAO,CAAG,CAAE3B,MAAM,CAAEsH,OAAO,CAAErH,WAAW,CAAEN,YAAa,CAAC,CACvEG,aAAa,CAAC,IAAI,CAAC,CACrB,CAAC,CAEDvF,SAAS,CAAC,IAAM,CACd,GAAI,CAACsF,UAAU,CAAE,OACjB,KAAM,CAAA2H,UAAU,CAAId,KAAK,EAAK,CAC5B,KAAM,CAAAY,OAAO,CAAGZ,KAAK,CAACa,OAAO,CAAGb,KAAK,CAACa,OAAO,CAAC,CAAC,CAAC,CAACD,OAAO,CAAGZ,KAAK,CAACY,OAAO,CACxE,KAAM,CAAAG,KAAK,CAAG1H,cAAc,CAAC4B,OAAO,CAAC3B,MAAM,CAAGsH,OAAO,CACrD,KAAM,CAAAI,UAAU,CAAG5L,IAAI,CAAC6L,GAAG,CAAC,GAAG,CAAE7L,IAAI,CAAC8L,GAAG,CAAC,GAAG,CAAE7H,cAAc,CAAC4B,OAAO,CAAC1B,WAAW,CAAGwH,KAAK,CAAC,CAAC,CAC3F7H,eAAe,CAAC8H,UAAU,CAAC,CAC7B,CAAC,CACD,KAAM,CAAAG,UAAU,CAAGA,CAAA,GAAM/H,aAAa,CAAC,KAAK,CAAC,CAE7CsC,MAAM,CAAC0F,gBAAgB,CAAC,WAAW,CAAEN,UAAU,CAAC,CAChDpF,MAAM,CAAC0F,gBAAgB,CAAC,WAAW,CAAEN,UAAU,CAAC,CAChDpF,MAAM,CAAC0F,gBAAgB,CAAC,SAAS,CAAED,UAAU,CAAC,CAC9CzF,MAAM,CAAC0F,gBAAgB,CAAC,UAAU,CAAED,UAAU,CAAC,CAE/C,MAAO,IAAM,CACXzF,MAAM,CAAC2F,mBAAmB,CAAC,WAAW,CAAEP,UAAU,CAAC,CACnDpF,MAAM,CAAC2F,mBAAmB,CAAC,WAAW,CAAEP,UAAU,CAAC,CACnDpF,MAAM,CAAC2F,mBAAmB,CAAC,SAAS,CAAEF,UAAU,CAAC,CACjDzF,MAAM,CAAC2F,mBAAmB,CAAC,UAAU,CAAEF,UAAU,CAAC,CACpD,CAAC,CACH,CAAC,CAAE,CAAChI,UAAU,CAAC,CAAC,CAEhB,GAAI,CAACjB,IAAI,CAAE,MAAO,KAAI,CAEtB,mBACE7D,KAAA,CAAAE,SAAA,EAAA+M,QAAA,eACEjN,KAAA,WACEkN,SAAS,CAAC,sBAAsB,CAChCC,OAAO,CAAEf,YAAa,CACtB,aAAW,cAAS,CAAAa,QAAA,EACrB,cAEC,CAACzH,WAAW,CAAG,CAAC,eACd1F,IAAA,SAAMoN,SAAS,CAAC,6BAA6B,CAAAD,QAAA,CAC1CzH,WAAW,CAAG,EAAE,CAAG,KAAK,CAAGA,WAAW,CACnC,CACP,EACK,CAAC,cAETxF,KAAA,QACEkN,SAAS,gBAAApM,MAAA,CAAiBmD,UAAU,CAAG,MAAM,CAAG,EAAE,MAAAnD,MAAA,CAAIgE,UAAU,CAAG,UAAU,CAAG,EAAE,CAAG,CACrFsI,KAAK,CAAE,CAAEC,MAAM,IAAAvM,MAAA,CAAK8D,YAAY,MAAK,CAAE,CAAAqI,QAAA,eAEvCnN,IAAA,QACEoN,SAAS,CAAC,qBAAqB,CAC/BI,IAAI,CAAC,cAAc,CACnBC,WAAW,CAAElB,WAAY,CACzBmB,YAAY,CAAEnB,WAAY,CAC3B,CAAC,cACFrM,KAAA,QAAKkN,SAAS,CAAC,qBAAqB,CAAAD,QAAA,eAClCjN,KAAA,QAAAiN,QAAA,eACEnN,IAAA,MAAAmN,QAAA,CAAG,mBAAO,CAAG,CAAC,cACdnN,IAAA,OAAAmN,QAAA,CAAI,8BAAe,CAAI,CAAC,EACrB,CAAC,cACNnN,IAAA,WAAQqN,OAAO,CAAEA,CAAA,GAAMjJ,aAAa,CAAC,KAAK,CAAE,CAAC,aAAW,mBAAW,CAAA+I,QAAA,CAAC,MAAC,CAAQ,CAAC,EAC3E,CAAC,cAENjN,KAAA,QAAKkN,SAAS,CAAC,mBAAmB,CAAAD,QAAA,EAC/B5I,OAAO,eAAIvE,IAAA,QAAKoN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,CAAC,oDAA2B,CAAK,CAAC,CAChF,CAAC5I,OAAO,EAAIE,KAAK,eAAIzE,IAAA,QAAKoN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,CAAE1I,KAAK,CAAM,CAAC,CACtE,CAACF,OAAO,EAAI,CAACF,aAAa,CAACvC,MAAM,EAAI,CAAC2C,KAAK,eAC1CzE,IAAA,QAAKoN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,CAAC,sDAA4B,CAAK,CACtE,cAEDnN,IAAA,QAAKoN,SAAS,CAAC,wBAAwB,CAAAD,QAAA,CACpC9I,aAAa,CAACwC,GAAG,CAAEuF,YAAY,OAAAuB,iBAAA,oBAC9BzN,KAAA,WAEEkN,SAAS,2BAAApM,MAAA,CACP,CAAA2D,kBAAkB,SAAlBA,kBAAkB,iBAAlBA,kBAAkB,CAAE3C,EAAE,IAAKoK,YAAY,CAACpK,EAAE,CAAG,QAAQ,CAAG,EAAE,CACzD,CACHqL,OAAO,CAAEA,CAAA,GAAMlB,uBAAuB,CAACC,YAAY,CAAE,CAAAe,QAAA,eAErDnN,IAAA,QAAKoN,SAAS,CAAC,gCAAgC,CAAAD,QAAA,CAC5Cf,YAAY,CAAC3J,UAAU,cACtBzC,IAAA,QAAK4N,GAAG,CAAExB,YAAY,CAAC3J,UAAW,CAACoL,GAAG,CAAEzB,YAAY,CAAC9J,QAAS,CAAE,CAAC,cAEjEtC,IAAA,SAAAmN,QAAA,EAAAQ,iBAAA,CAAOtB,gBAAgB,CAACD,YAAY,CAAC,UAAAuB,iBAAA,iBAA9BA,iBAAA,CAAgCG,MAAM,CAAC,CAAC,CAAC,CAAO,CACxD,CACE,CAAC,cACN5N,KAAA,QAAKkN,SAAS,CAAC,iCAAiC,CAAAD,QAAA,eAC9CjN,KAAA,QAAKkN,SAAS,CAAC,6BAA6B,CAAAD,QAAA,eAC1CnN,IAAA,WAAAmN,QAAA,CAASd,gBAAgB,CAACD,YAAY,CAAC,CAAS,CAAC,cACjDpM,IAAA,SAAAmN,QAAA,CAAO1M,kBAAkB,CAAC2L,YAAY,CAAC5I,SAAS,CAAC,CAAO,CAAC,EACtD,CAAC,cACNtD,KAAA,MAAAiN,QAAA,EACGf,YAAY,CAAChJ,WAAW,eAAIlD,KAAA,OAAAiN,QAAA,EAAKf,YAAY,CAAChJ,WAAW,CAAC,UAAG,EAAI,CAAC,CAClEgJ,YAAY,CAAC9I,WAAW,EACxB,CAAC,EACD,CAAC,CACL8I,YAAY,CAACxI,WAAW,CAAG,CAAC,eAC3B5D,IAAA,SAAMoN,SAAS,CAAC,+BAA+B,CAAAD,QAAA,CAAEf,YAAY,CAACxI,WAAW,CAAO,CACjF,GAzBIwI,YAAY,CAACpK,EA0BZ,CAAC,EACV,CAAC,CACC,CAAC,EACH,CAAC,EACH,CAAC,CAEL2C,kBAAkB,eACjB3E,IAAA,CAAC+N,SAAS,EACR3B,YAAY,CAAEzH,kBAAmB,CACjCqJ,OAAO,CAAEA,CAAA,GAAMpJ,qBAAqB,CAAC,IAAI,CAAE,CAC3CgB,QAAQ,CAAEA,QAAS,CACnBqI,eAAe,CAAE5B,gBAAgB,CAAC1H,kBAAkB,CAAE,CACtDuJ,iBAAiB,CAAEtG,gBAAiB,CACpCuG,sBAAsB,CAAEjD,0BAA2B,CACpD,CACF,cAEDlL,IAAA,QAAKoN,SAAS,CAAC,0BAA0B,CAAAD,QAAA,CACtC5H,MAAM,CAACsB,GAAG,CAAEgC,KAAK,eAChB3I,KAAA,QAAoBkN,SAAS,2CAAApM,MAAA,CAA4C6H,KAAK,CAACU,MAAM,CAAG,CAAA4D,QAAA,eACtFjN,KAAA,QAAAiN,QAAA,eACEnN,IAAA,MAAAmN,QAAA,CAAItE,KAAK,CAACQ,KAAK,CAAI,CAAC,cACpBrJ,IAAA,WAAAmN,QAAA,CAAStE,KAAK,CAAC5B,OAAO,CAAS,CAAC,CAC/B4B,KAAK,CAACS,IAAI,eAAItJ,IAAA,SAAAmN,QAAA,CAAOtE,KAAK,CAACS,IAAI,CAAO,CAAC,EACrC,CAAC,cACNtJ,IAAA,WAAQqN,OAAO,CAAEA,CAAA,GAAMxD,YAAY,CAAChB,KAAK,CAAC7G,EAAE,CAAE,CAAC,aAAW,8BAAgB,CAAAmL,QAAA,CAAC,MAAC,CAAQ,CAAC,GAN7EtE,KAAK,CAAC7G,EAOX,CACN,CAAC,CACC,CAAC,EACN,CAAC,CAEP,CAAC,CAED,KAAM,CAAA+L,SAAS,CAAGK,IAAA,EAAqG,IAApG,CAAEhC,YAAY,CAAE4B,OAAO,CAAEpI,QAAQ,CAAEqI,eAAe,CAAEC,iBAAiB,CAAEC,sBAAuB,CAAC,CAAAC,IAAA,CAChH,KAAM,CAAErK,IAAK,CAAC,CAAGjE,OAAO,CAAC,CAAC,CAC1B,KAAM,CAACuO,QAAQ,CAAEC,WAAW,CAAC,CAAGzO,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAAC0O,IAAI,CAAEC,OAAO,CAAC,CAAG3O,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAAC4O,UAAU,CAAEC,aAAa,CAAC,CAAG7O,QAAQ,CAAC,KAAK,CAAC,CACnD,KAAM,CAAA8O,KAAK,CAAG/O,MAAM,CAAC,IAAI,CAAC,CAC1B,KAAM,CAAAgP,SAAS,CAAGhP,MAAM,CAAC,IAAI,CAAC,CAE9B,KAAM,CAAAwC,MAAM,CAAGzC,OAAO,CAAC,IAAM,CAC3B,GAAIiG,QAAQ,CAAE,MAAO,CAAAwG,YAAY,CAAChK,MAAM,GAAI2B,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,EACzD,MAAO,CAAAmI,YAAY,CAAChK,MAAM,CAC5B,CAAC,CAAE,CAACgK,YAAY,CAAChK,MAAM,CAAEwD,QAAQ,CAAE7B,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,CAAC,CAAC,CAElD,KAAM,CAAA4K,UAAU,CAAGlP,OAAO,CAAC,IAAM,CAC/B,GAAIiG,QAAQ,CAAE,MAAO,CAAAwG,YAAY,CAACxJ,OAAO,CACzC,MAAO,CAAAmB,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,CACtB,CAAC,CAAE,CAACmI,YAAY,CAACxJ,OAAO,CAAEgD,QAAQ,CAAE7B,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,CAAC,CAAC,CAEnDvE,SAAS,CAAC,IAAM,CACd,GAAI,CAAC0M,YAAY,EAAI,CAAChK,MAAM,EAAI,CAACyM,UAAU,EAAI,CAAC9K,IAAI,CAAE,OAEtD,KAAM,CAAA+B,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,EAAI,EAAE,CACxD,KAAM,CAAApE,GAAG,CAAGvB,QAAQ,CAACkL,OAAO,CAAC,cAAc,CAAE,EAAE,CAAC,CAChD,KAAM,CAAAuD,UAAU,CAAGzO,QAAQ,CAACoL,UAAU,CAAC,OAAO,CAAC,CAAG,KAAK,CAAG,IAAI,CAC9D,KAAM,CAAAsD,EAAE,CAAG,GAAI,CAAAC,eAAe,CAAC,CAAElJ,KAAK,CAAEjD,KAAK,CAAEgM,UAAW,CAAC,CAAC,CAC5D,GAAIzC,YAAY,CAACnJ,SAAS,CAAE8L,EAAE,CAACE,GAAG,CAAC,SAAS,CAAE7C,YAAY,CAACnJ,SAAS,CAAC,CAErE,KAAM,CAAAiM,KAAK,IAAAlO,MAAA,CAAM8N,UAAU,QAAA9N,MAAA,CAAMY,GAAG,cAAAZ,MAAA,CAAYoB,MAAM,OAAApB,MAAA,CAAK+N,EAAE,CAACI,QAAQ,CAAC,CAAC,CAAE,CAC1E,KAAM,CAAAzD,EAAE,CAAG,GAAI,CAAAC,SAAS,CAACuD,KAAK,CAAC,CAC/BP,KAAK,CAAC7H,OAAO,CAAG4E,EAAE,CAClBgD,aAAa,CAAC,IAAI,CAAC,CAEnBhD,EAAE,CAAC0D,MAAM,CAAG,IAAMV,aAAa,CAAC,KAAK,CAAC,CACtChD,EAAE,CAACE,SAAS,CAAIyD,GAAG,EAAK,CACtB,GAAI,CACF,KAAM,CAAA9I,IAAI,CAAGuF,IAAI,CAACC,KAAK,CAACsD,GAAG,CAAC9I,IAAI,CAAC,CACjC,GAAIA,IAAI,CAAC2B,IAAI,GAAK,SAAS,CAAEoG,WAAW,CAAC/H,IAAI,CAAC8H,QAAQ,EAAI,EAAE,CAAC,CAAC,IACzD,IAAI9H,IAAI,CAAC2B,IAAI,GAAK,SAAS,EAAI3B,IAAI,CAACU,OAAO,CAAE,CAChDqH,WAAW,CAAE9E,IAAI,EAAK,CAAC,GAAGA,IAAI,CAAEjD,IAAI,CAACU,OAAO,CAAC,CAAC,CAC9C,GAAIV,IAAI,CAACU,OAAO,CAACgE,SAAS,IAAKlH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,GAAI,MAAO,CAAAiK,iBAAiB,GAAK,UAAU,CAAE,CACvFA,iBAAiB,CAAC,CAAC,CACrB,CACA,GAAI,MAAO,CAAAC,sBAAsB,GAAK,UAAU,CAAE,CAChDA,sBAAsB,CAAC/B,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEpK,EAAE,CAAE,CACvCsB,WAAW,CAAEiD,IAAI,CAACU,OAAO,CAACqI,OAAO,CACjC9L,SAAS,CAAE+C,IAAI,CAACU,OAAO,CAACsI,UAAU,CAClC3L,WAAW,CAAE,CACf,CAAC,CAAC,CACJ,CACF,CACF,CAAE,MAAOa,KAAK,CAAE,CACduC,OAAO,CAACvC,KAAK,CAAC,gBAAgB,CAAEA,KAAK,CAAC,CACxC,CACF,CAAC,CACDiH,EAAE,CAACO,OAAO,CAAIoD,GAAG,EAAKrI,OAAO,CAACwI,GAAG,CAAC,sBAAsB,CAAEH,GAAG,CAAC,CAC9D3D,EAAE,CAACM,OAAO,CAAIvH,KAAK,EAAKuC,OAAO,CAACvC,KAAK,CAAC,qBAAqB,CAAEA,KAAK,CAAC,CAEnE,MAAO,IAAMiH,EAAE,CAACQ,KAAK,CAAC,CAAC,CACzB,CAAC,CAAE,CAACE,YAAY,CAAEyC,UAAU,CAAEzM,MAAM,CAAE2B,IAAI,CAAEmK,iBAAiB,CAAEC,sBAAsB,CAAC,CAAC,CAEvFzO,SAAS,CAAC,IAAM,KAAA+P,kBAAA,CACd,CAAAA,kBAAA,CAAAb,SAAS,CAAC9H,OAAO,UAAA2I,kBAAA,iBAAjBA,kBAAA,CAAmBC,cAAc,CAAC,CAAEC,QAAQ,CAAE,QAAS,CAAC,CAAC,CAC3D,CAAC,CAAE,CAACtB,QAAQ,CAAC,CAAC,CAEd,KAAM,CAAAuB,WAAW,CAAGA,CAAA,GAAM,CACxB,KAAM,CAAAN,OAAO,CAAGf,IAAI,CAACsB,IAAI,CAAC,CAAC,CAC3B,GAAI,CAACP,OAAO,EAAI,CAACX,KAAK,CAAC7H,OAAO,EAAI6H,KAAK,CAAC7H,OAAO,CAACgJ,UAAU,GAAK,CAAC,CAAE,OAClEnB,KAAK,CAAC7H,OAAO,CAACiJ,IAAI,CAACjE,IAAI,CAACkE,SAAS,CAAC,CAAE9H,IAAI,CAAE,SAAS,CAAEoH,OAAQ,CAAC,CAAC,CAAC,CAChEd,OAAO,CAAC,EAAE,CAAC,CACb,CAAC,CAED,mBACEtO,KAAA,QAAKkN,SAAS,CAAC,YAAY,CAAAD,QAAA,eACzBjN,KAAA,QAAKkN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,eACjCjN,KAAA,QAAAiN,QAAA,eACEnN,IAAA,MAAAmN,QAAA,CAAIf,YAAY,CAAChJ,WAAW,EAAI,YAAY,CAAI,CAAC,cACjDpD,IAAA,WAAAmN,QAAA,CAASc,eAAe,CAAS,CAAC,EAC/B,CAAC,cACNjO,IAAA,WAAQqN,OAAO,CAAEW,OAAQ,CAAC,aAAW,2CAAsB,CAAAb,QAAA,CAAC,MAAC,CAAQ,CAAC,EACnE,CAAC,cAENjN,KAAA,QAAKkN,SAAS,CAAC,kBAAkB,CAAAD,QAAA,EAC9BsB,UAAU,eAAIzO,IAAA,QAAKoN,SAAS,CAAC,kBAAkB,CAAAD,QAAA,CAAC,gCAAe,CAAK,CAAC,CACrEkB,QAAQ,CAACxH,GAAG,CAAEI,OAAO,eACpBjH,IAAA,QAEEoN,SAAS,wBAAApM,MAAA,CAAyBiG,OAAO,CAACgE,SAAS,IAAKlH,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEE,OAAO,EAAG,IAAI,CAAG,EAAE,CAAG,CAAAkJ,QAAA,cAEpFjN,KAAA,QAAKkN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,eACjCnN,IAAA,QAAAmN,QAAA,CAAMlG,OAAO,CAACqI,OAAO,CAAM,CAAC,cAC5BtP,IAAA,SAAAmN,QAAA,CAAO,GAAI,CAAAvM,IAAI,CAACqG,OAAO,CAACsI,UAAU,CAAC,CAACU,cAAc,CAAC,OAAO,CAAC,CAAO,CAAC,EAChE,CAAC,EANDhJ,OAAO,CAACjF,EAAE,KAAAhB,MAAA,CAAOiG,OAAO,CAACsI,UAAU,MAAAvO,MAAA,CAAIiG,OAAO,CAACgE,SAAS,CAO1D,CACN,CAAC,cACFjL,IAAA,QAAKkQ,GAAG,CAAEtB,SAAU,CAAE,CAAC,EACpB,CAAC,cAEN1O,KAAA,QAAKkN,SAAS,CAAC,oBAAoB,CAAAD,QAAA,eACjCnN,IAAA,UACEoI,KAAK,CAAEmG,IAAK,CACZ4B,QAAQ,CAAGC,CAAC,EAAK5B,OAAO,CAAC4B,CAAC,CAACC,MAAM,CAACjI,KAAK,CAAE,CACzCkI,SAAS,CAAGF,CAAC,EAAKA,CAAC,CAACG,GAAG,GAAK,OAAO,EAAIX,WAAW,CAAC,CAAE,CACrDY,WAAW,CAAC,4BAAkB,CAC/B,CAAC,cACFxQ,IAAA,WAAQqN,OAAO,CAAEuC,WAAY,CAAAzC,QAAA,CAAC,UAAG,CAAQ,CAAC,EACvC,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAjJ,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}