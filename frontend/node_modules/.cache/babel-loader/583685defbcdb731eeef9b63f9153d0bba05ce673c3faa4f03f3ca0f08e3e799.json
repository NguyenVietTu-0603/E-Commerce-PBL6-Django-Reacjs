{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\pages\\\\ProductDetail.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useMemo, useRef } from 'react';\nimport { useParams, useNavigate, Link } from 'react-router-dom';\nimport { useCart } from '../utils/CartContext';\nimport { useWishlist } from '../utils/WishlistContext';\nimport { formatPrice } from '../utils/formatPrice';\nimport '../assets/productDetail.css';\nimport StarRating from '../components/StarRating';\nimport { getProductReviews, getReviewEligibility, submitReview } from '../utils/reviewsApi';\nimport Icon from '../components/Icon';\nimport usePageTitle from '../hooks/usePageTitle';\nimport flyToCart from '../utils/flyToCart';\nimport { extractVariantOptions } from '../utils/variantUtils';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ProductDetail() {\n  _s();\n  var _product$category;\n  const {\n    id\n  } = useParams();\n  const navigate = useNavigate();\n  const {\n    addToCart\n  } = useCart();\n  const {\n    findWishlistItem,\n    toggleWishlist,\n    isBuyer\n  } = useWishlist();\n  const [product, setProduct] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [mainImage, setMainImage] = useState('');\n  const [color, setColor] = useState('');\n  const [size, setSize] = useState('');\n  const [qty, setQty] = useState(1);\n  const [reviews, setReviews] = useState([]);\n  const [avgRating, setAvgRating] = useState(0);\n  const [ratingCount, setRatingCount] = useState(0);\n  const [canReview, setCanReview] = useState(false);\n  const [myReview, setMyReview] = useState(null);\n  const [reviewRating, setReviewRating] = useState(0);\n  const [reviewComment, setReviewComment] = useState('');\n  const [reviewsLoading, setReviewsLoading] = useState(true);\n  const [submitting, setSubmitting] = useState(false);\n  const mainImageRef = useRef(null);\n  usePageTitle((product === null || product === void 0 ? void 0 : product.name) || 'Chi tiết sản phẩm');\n  useEffect(() => {\n    fetch(`http://localhost:8000/api/products/${id}/`).then(res => {\n      if (!res.ok) throw new Error('Product not found');\n      return res.json();\n    }).then(data => {\n      setProduct(data);\n      setMainImage(data.image || '/default-product.png');\n      setLoading(false);\n    }).catch(err => {\n      console.error('Error loading product:', err);\n      setLoading(false);\n    });\n  }, [id]);\n  useEffect(() => {\n    let cancelled = false;\n    async function loadReviews() {\n      try {\n        setReviewsLoading(true);\n        const [r1, r2] = await Promise.all([getProductReviews(id), getReviewEligibility(id).catch(() => ({\n          can_review: false\n        }))]);\n        if (cancelled) return;\n        setReviews(r1.reviews || []);\n        setAvgRating(Number(r1.average || 0));\n        setRatingCount(Number(r1.count || 0));\n        setCanReview(Boolean(r2.can_review));\n        if (r2.my_review) {\n          setMyReview(r2.my_review);\n          setReviewRating(r2.my_review.rating || 0);\n          setReviewComment(r2.my_review.comment || '');\n        } else {\n          setMyReview(null);\n          setReviewRating(0);\n          setReviewComment('');\n        }\n        if (r2.reason === 'unauthenticated') {\n          console.debug('Not logged in -> cannot review');\n        }\n      } finally {\n        if (!cancelled) setReviewsLoading(false);\n      }\n    }\n    loadReviews();\n    return () => {\n      cancelled = true;\n    };\n  }, [id]);\n  const {\n    colors,\n    sizes\n  } = useMemo(() => extractVariantOptions(product || {}), [product]);\n  useEffect(() => {\n    if (colors.length > 0) {\n      setColor(prev => prev && colors.includes(prev) ? prev : colors[0]);\n    } else {\n      setColor('');\n    }\n    if (sizes.length > 0) {\n      setSize(prev => prev && sizes.includes(prev) ? prev : sizes[0]);\n    } else {\n      setSize('');\n    }\n  }, [colors, sizes]);\n  async function handleSubmitReview(e) {\n    e.preventDefault();\n    if (!reviewRating) {\n      alert('Vui lòng chọn số sao');\n      return;\n    }\n    try {\n      setSubmitting(true);\n      const saved = await submitReview(id, {\n        rating: reviewRating,\n        comment: reviewComment\n      });\n      // Cập nhật trạng thái của chính review\n      setMyReview(saved);\n      setCanReview(false);\n      // Refresh danh sách + trung bình\n      const r = await getProductReviews(id);\n      setReviews(r.reviews || []);\n      setAvgRating(Number(r.average || 0));\n      setRatingCount(Number(r.count || 0));\n    } catch (err) {\n      console.error(err);\n      if (String(err).includes('401') || String(err.message || '').toLowerCase().includes('auth')) {\n        if (window.confirm('Bạn cần đăng nhập để đánh giá. Đi đến trang đăng nhập?')) {\n          // điều hướng sang login nếu app bạn có route này\n          window.location.href = '/login';\n        }\n      } else {\n        alert('Gửi đánh giá thất bại. Vui lòng thử lại.');\n      }\n    } finally {\n      setSubmitting(false);\n    }\n  }\n  const wishlistEntry = useMemo(() => {\n    if (!product) return null;\n    return findWishlistItem(product.id, color, size);\n  }, [product, color, size, findWishlistItem]);\n  const handleToggleWishlist = async () => {\n    if (!product) return;\n    if (!isBuyer) {\n      alert('Vui lòng đăng nhập bằng tài khoản người mua để sử dụng danh sách yêu thích.');\n      return;\n    }\n    try {\n      await toggleWishlist(product, {\n        color,\n        size\n      });\n    } catch (err) {\n      alert(err.message || 'Không thể cập nhật danh sách yêu thích');\n    }\n  };\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"product-detail\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'center',\n          padding: '80px 20px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\u0110ang t\\u1EA3i s\\u1EA3n ph\\u1EA9m...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 13\n    }, this);\n  }\n  if (!product) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"product-detail\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pd-card\",\n        style: {\n          maxWidth: '600px',\n          margin: '80px auto',\n          textAlign: 'center'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Kh\\xF4ng t\\xECm th\\u1EA5y s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/\",\n            style: {\n              color: 'var(--accent)'\n            },\n            children: \"Quay v\\u1EC1 trang ch\\u1EE7\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 24\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 13\n    }, this);\n  }\n  const vouchers = product.vouchers || [];\n  const specs = product.specs || [];\n  const description = product.description || 'Chưa có mô tả cho sản phẩm này.';\n\n  // Shop info\n  const shop = {\n    id: product.seller_id,\n    name: product.seller_name || 'Cửa hàng V-Market',\n    avatar: 'avatars/default-avatar.png',\n    rating: product.rating || 4.8,\n    followers: product.followers || '150k'\n  };\n  function dec() {\n    setQty(prev => Math.max(1, prev - 1));\n  }\n  function inc() {\n    setQty(prev => Math.min(prev + 1, product.stock || 999));\n  }\n  function handleAddToCart(e) {\n    if (e !== null && e !== void 0 && e.preventDefault) e.preventDefault();\n    if (colors.length > 0 && !color) {\n      alert('Vui lòng chọn màu sắc');\n      return;\n    }\n    if (sizes.length > 0 && !size) {\n      alert('Vui lòng chọn kích thước');\n      return;\n    }\n    addToCart(product, qty, {\n      color,\n      size\n    });\n    flyToCart(mainImageRef.current);\n    alert(`Đã thêm ${qty} sản phẩm vào giỏ hàng`);\n  }\n  function handleBuyNow() {\n    if (colors.length > 0 && !color) {\n      alert('Vui lòng chọn màu sắc');\n      return;\n    }\n    if (sizes.length > 0 && !size) {\n      alert('Vui lòng chọn kích thước');\n      return;\n    }\n    addToCart(product, qty, {\n      color,\n      size\n    });\n    navigate('/cart');\n  }\n  function handleChatWithShop() {\n    navigate(`/chat/${shop.id}?product=${id}`);\n  }\n  function handleViewShop() {\n    navigate(`/shop/${shop.id}`);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"product-detail\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"product-detail-inner\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"product-detail-media\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-main-media\",\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            ref: mainImageRef,\n            src: mainImage,\n            alt: product.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 21\n        }, this), product.images && product.images.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-thumbs\",\n          children: product.images.map((img, i) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `pd-thumb ${mainImage === img ? 'active' : ''}`,\n            onClick: () => setMainImage(img),\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: img,\n              alt: `${product.name} ${i + 1}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 251,\n              columnNumber: 37\n            }, this)\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 33\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 244,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"product-detail-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 12\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n            style: {\n              flex: '1 1 auto',\n              margin: 0\n            },\n            children: product.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 261,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            className: `wishlist-heart ${wishlistEntry ? 'active' : ''}`,\n            onClick: handleToggleWishlist,\n            \"aria-label\": wishlistEntry ? 'Bỏ khỏi yêu thích' : 'Thêm vào yêu thích',\n            style: {\n              position: 'static'\n            },\n            children: /*#__PURE__*/_jsxDEV(Icon, {\n              name: \"heart\",\n              variant: wishlistEntry ? 'solid' : 'regular',\n              size: 22\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 262,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 260,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"product-detail-price\",\n          children: formatPrice(product.price)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            margin: '8px 0 12px 0'\n          },\n          children: /*#__PURE__*/_jsxDEV(StarRating, {\n            value: avgRating,\n            count: ratingCount,\n            readOnly: true,\n            showValue: true,\n            size: 16\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-card\",\n          children: [vouchers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: \"Voucher\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 289,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: vouchers.map(v => /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"pd-chip\",\n                children: v\n              }, v, false, {\n                fileName: _jsxFileName,\n                lineNumber: 292,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 290,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 288,\n            columnNumber: 29\n          }, this), product.shipping && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: \"V\\u1EADn chuy\\u1EC3n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: [\"Giao \\u0111\\u1EBFn: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: product.shipping.area || 'Toàn quốc'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 303,\n                  columnNumber: 52\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 303,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  fontSize: '13px',\n                  color: 'var(--text-muted)',\n                  marginTop: '4px'\n                },\n                children: [\"Ph\\xED ship: \", product.shipping.feeText || 'Freeship đơn từ 0đ']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 304,\n                columnNumber: 37\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 29\n          }, this), colors.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: \"M\\xE0u s\\u1EAFc\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 314,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: colors.map(c => /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `pd-chip ${color === c ? 'active' : ''}`,\n                onClick: () => setColor(c),\n                children: c\n              }, c, false, {\n                fileName: _jsxFileName,\n                lineNumber: 317,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 315,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 313,\n            columnNumber: 29\n          }, this), sizes.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: \"K\\xEDch th\\u01B0\\u1EDBc\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 332,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: sizes.map(s => /*#__PURE__*/_jsxDEV(\"button\", {\n                className: `pd-chip ${size === s ? 'active' : ''}`,\n                onClick: () => setSize(s),\n                children: s\n              }, s, false, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 41\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 333,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 331,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: \"S\\u1ED1 l\\u01B0\\u1EE3ng\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 349,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"pd-qty\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: dec,\n                  \"aria-label\": \"Gi\\u1EA3m s\\u1ED1 l\\u01B0\\u1EE3ng\",\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    name: \"minus\",\n                    size: 12\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 353,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 352,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"number\",\n                  value: qty,\n                  readOnly: true\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 355,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  onClick: inc,\n                  \"aria-label\": \"T\\u0103ng s\\u1ED1 l\\u01B0\\u1EE3ng\",\n                  children: /*#__PURE__*/_jsxDEV(Icon, {\n                    name: \"plus\",\n                    size: 12\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 357,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 356,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 351,\n                columnNumber: 33\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 350,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"add-cart\",\n              onClick: handleAddToCart,\n              children: \"Th\\xEAm v\\xE0o gi\\u1ECF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"buy-now\",\n              onClick: handleBuyNow,\n              children: \"Mua ngay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 364,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-card shop-card\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"shop-avatar\",\n            style: {\n              backgroundImage: `url(${shop.avatar})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 376,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"shop-info\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              style: {\n                margin: '0 0 4px 0',\n                fontSize: '16px',\n                fontWeight: '700'\n              },\n              children: shop.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 385,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                margin: 0,\n                fontSize: '13px',\n                color: 'var(--text-muted)'\n              },\n              children: [\"\\u0110\\xE1nh gi\\xE1: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: shop.rating\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 43\n              }, this), \" \\u2022 Ng\\u01B0\\u1EDDi theo d\\xF5i: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                children: shop.followers\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 389,\n                columnNumber: 92\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 388,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 384,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"shop-actions\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleChatWithShop,\n              children: \"Chat ngay\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 393,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: handleViewShop,\n              children: \"Xem shop\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 394,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-meta\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-meta-row\",\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              name: \"box-open\",\n              size: 18,\n              className: \"pd-meta-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 401,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"Danh m\\u1EE5c: \", ((_product$category = product.category) === null || _product$category === void 0 ? void 0 : _product$category.name) || 'Chưa phân loại']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 402,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 400,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pd-meta-row\",\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              name: \"chart-column\",\n              size: 18,\n              className: \"pd-meta-icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"C\\xF2n l\\u1EA1i: \", product.stock || 0, \" s\\u1EA3n ph\\u1EA9m\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 406,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"detail-sections\",\n      children: [specs.length > 0 && /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"detail-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Chi ti\\u1EBFt s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"specs\",\n          children: specs.map((spec, i) => /*#__PURE__*/_jsxDEV(React.Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"pd-label\",\n              children: [spec.label || spec[0], \":\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 421,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: spec.value || spec[1]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 422,\n              columnNumber: 37\n            }, this)]\n          }, i, true, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 33\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 418,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"detail-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"M\\xF4 t\\u1EA3 s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-description\",\n          children: /*#__PURE__*/_jsxDEV(\"pre\", {\n            children: description\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 430,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n        className: \"detail-section\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\u0110\\xE1nh gi\\xE1 s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 16,\n            marginBottom: 12\n          },\n          children: [/*#__PURE__*/_jsxDEV(StarRating, {\n            value: avgRating,\n            count: ratingCount,\n            readOnly: true,\n            showValue: true,\n            size: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 25\n          }, this), reviewsLoading ? /*#__PURE__*/_jsxDEV(\"span\", {\n            children: \"\\u0110ang t\\u1EA3i \\u0111\\xE1nh gi\\xE1...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 43\n          }, this) : null]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 21\n        }, this), (canReview || myReview) && /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleSubmitReview,\n          className: \"pd-card\",\n          style: {\n            marginBottom: 16\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 10\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginBottom: 6\n              },\n              children: myReview ? 'Cập nhật đánh giá của bạn' : 'Đánh giá của bạn'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(StarRating, {\n              value: reviewRating,\n              readOnly: false,\n              onChange: setReviewRating,\n              size: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 450,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              marginBottom: 10\n            },\n            children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n              placeholder: \"Chia s\\u1EBB c\\u1EA3m nh\\u1EADn v\\u1EC1 s\\u1EA3n ph\\u1EA9m...\",\n              value: reviewComment,\n              onChange: e => setReviewComment(e.target.value),\n              rows: 4,\n              style: {\n                width: '100%',\n                padding: 10,\n                borderRadius: 6,\n                border: '1px solid #e5e7eb'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 458,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 457,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"add-cart\",\n            disabled: submitting,\n            children: submitting ? 'Đang gửi...' : myReview ? 'Cập nhật đánh giá' : 'Gửi đánh giá'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 466,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 25\n        }, this), !canReview && !reviewsLoading && !myReview && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-card\",\n          style: {\n            color: 'var(--text-muted)'\n          },\n          children: [\"Ch\\u1EC9 ng\\u01B0\\u1EDDi \\u0111\\xE3 mua s\\u1EA3n ph\\u1EA9m m\\u1EDBi c\\xF3 th\\u1EC3 \\u0111\\xE1nh gi\\xE1. \", /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"/login\",\n            style: {\n              color: 'var(--accent)'\n            },\n            children: \"\\u0110\\u0103ng nh\\u1EADp\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 474,\n            columnNumber: 76\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 473,\n          columnNumber: 25\n        }, this), reviews.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-card\",\n          style: {\n            display: 'grid',\n            gap: 12\n          },\n          children: reviews.map(rv => /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              borderBottom: '1px solid #f0f0f0',\n              paddingBottom: 10\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                style: {\n                  fontSize: 14\n                },\n                children: rv.user_name || 'Người dùng'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 484,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(StarRating, {\n                value: rv.rating,\n                readOnly: true,\n                size: 14\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 485,\n                columnNumber: 41\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                style: {\n                  fontSize: 12,\n                  color: 'var(--text-muted)'\n                },\n                children: rv.created_at ? new Date(rv.created_at).toLocaleDateString('vi-VN') : ''\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 486,\n                columnNumber: 41\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 483,\n              columnNumber: 37\n            }, this), rv.comment ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                marginTop: 6,\n                whiteSpace: 'pre-wrap'\n              },\n              children: rv.comment\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 41\n            }, this) : null]\n          }, rv.id || `${rv.user_id}-${rv.created_at}`, true, {\n            fileName: _jsxFileName,\n            lineNumber: 482,\n            columnNumber: 33\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 25\n        }, this) : !reviewsLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"pd-card\",\n          style: {\n            color: 'var(--text-muted)'\n          },\n          children: \"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1 n\\xE0o.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 497,\n          columnNumber: 25\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 413,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 235,\n    columnNumber: 9\n  }, this);\n}\n_s(ProductDetail, \"yoqNtr96q6icoC6uTRQg2A7Wfi8=\", false, function () {\n  return [useParams, useNavigate, useCart, useWishlist, usePageTitle];\n});\n_c = ProductDetail;\nvar _c;\n$RefreshReg$(_c, \"ProductDetail\");","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","useParams","useNavigate","Link","useCart","useWishlist","formatPrice","StarRating","getProductReviews","getReviewEligibility","submitReview","Icon","usePageTitle","flyToCart","extractVariantOptions","jsxDEV","_jsxDEV","ProductDetail","_s","_product$category","id","navigate","addToCart","findWishlistItem","toggleWishlist","isBuyer","product","setProduct","loading","setLoading","mainImage","setMainImage","color","setColor","size","setSize","qty","setQty","reviews","setReviews","avgRating","setAvgRating","ratingCount","setRatingCount","canReview","setCanReview","myReview","setMyReview","reviewRating","setReviewRating","reviewComment","setReviewComment","reviewsLoading","setReviewsLoading","submitting","setSubmitting","mainImageRef","name","fetch","then","res","ok","Error","json","data","image","catch","err","console","error","cancelled","loadReviews","r1","r2","Promise","all","can_review","Number","average","count","Boolean","my_review","rating","comment","reason","debug","colors","sizes","length","prev","includes","handleSubmitReview","e","preventDefault","alert","saved","r","String","message","toLowerCase","window","confirm","location","href","wishlistEntry","handleToggleWishlist","className","children","style","textAlign","padding","fileName","_jsxFileName","lineNumber","columnNumber","maxWidth","margin","to","vouchers","specs","description","shop","seller_id","seller_name","avatar","followers","dec","Math","max","inc","min","stock","handleAddToCart","current","handleBuyNow","handleChatWithShop","handleViewShop","ref","src","alt","images","map","img","i","onClick","display","alignItems","gap","flex","type","position","variant","price","value","readOnly","showValue","v","shipping","area","fontSize","marginTop","feeText","c","s","backgroundImage","backgroundSize","backgroundPosition","fontWeight","category","spec","Fragment","label","marginBottom","onSubmit","onChange","placeholder","target","rows","width","borderRadius","border","disabled","rv","borderBottom","paddingBottom","user_name","created_at","Date","toLocaleDateString","whiteSpace","user_id","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/pages/ProductDetail.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport { useCart } from '../utils/CartContext';\r\nimport { useWishlist } from '../utils/WishlistContext';\r\nimport { formatPrice } from '../utils/formatPrice';\r\nimport '../assets/productDetail.css';\r\nimport StarRating from '../components/StarRating';\r\nimport { getProductReviews, getReviewEligibility, submitReview } from '../utils/reviewsApi';\r\nimport Icon from '../components/Icon';\r\nimport usePageTitle from '../hooks/usePageTitle';\r\nimport flyToCart from '../utils/flyToCart';\r\nimport { extractVariantOptions } from '../utils/variantUtils';\r\n\r\nexport default function ProductDetail() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const { addToCart } = useCart();\r\n    const { findWishlistItem, toggleWishlist, isBuyer } = useWishlist();\r\n\r\n    const [product, setProduct] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [mainImage, setMainImage] = useState('');\r\n    const [color, setColor] = useState('');\r\n    const [size, setSize] = useState('');\r\n    const [qty, setQty] = useState(1);\r\n    const [reviews, setReviews] = useState([]);\r\n    const [avgRating, setAvgRating] = useState(0);\r\n    const [ratingCount, setRatingCount] = useState(0);\r\n    const [canReview, setCanReview] = useState(false);\r\n    const [myReview, setMyReview] = useState(null);\r\n    const [reviewRating, setReviewRating] = useState(0);\r\n    const [reviewComment, setReviewComment] = useState('');\r\n    const [reviewsLoading, setReviewsLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const mainImageRef = useRef(null);\r\n\r\n    usePageTitle(product?.name || 'Chi tiết sản phẩm');\r\n\r\n    useEffect(() => {\r\n        fetch(`http://localhost:8000/api/products/${id}/`)\r\n            .then(res => {\r\n                if (!res.ok) throw new Error('Product not found');\r\n                return res.json();\r\n            })\r\n            .then(data => {\r\n                setProduct(data);\r\n                setMainImage(data.image || '/default-product.png');\r\n                setLoading(false);\r\n            })\r\n            .catch(err => {\r\n                console.error('Error loading product:', err);\r\n                setLoading(false);\r\n            });\r\n    }, [id]);\r\n\r\n    useEffect(() => {\r\n        let cancelled = false;\r\n        async function loadReviews() {\r\n            try {\r\n                setReviewsLoading(true);\r\n                const [r1, r2] = await Promise.all([\r\n                    getProductReviews(id),\r\n                    getReviewEligibility(id).catch(() => ({ can_review: false }))\r\n                ]);\r\n                if (cancelled) return;\r\n                setReviews(r1.reviews || []);\r\n                setAvgRating(Number(r1.average || 0));\r\n                setRatingCount(Number(r1.count || 0));\r\n                setCanReview(Boolean(r2.can_review));\r\n                if (r2.my_review) {\r\n                    setMyReview(r2.my_review);\r\n                    setReviewRating(r2.my_review.rating || 0);\r\n                    setReviewComment(r2.my_review.comment || '');\r\n                } else {\r\n                    setMyReview(null);\r\n                    setReviewRating(0);\r\n                    setReviewComment('');\r\n                }\r\n                if (r2.reason === 'unauthenticated') {\r\n                    console.debug('Not logged in -> cannot review');\r\n                }\r\n            } finally {\r\n                if (!cancelled) setReviewsLoading(false);\r\n            }\r\n        }\r\n        loadReviews();\r\n        return () => { cancelled = true; };\r\n    }, [id]);\r\n\r\n    const { colors, sizes } = useMemo(() => extractVariantOptions(product || {}), [product]);\r\n\r\n    useEffect(() => {\r\n        if (colors.length > 0) {\r\n            setColor(prev => (prev && colors.includes(prev) ? prev : colors[0]));\r\n        } else {\r\n            setColor('');\r\n        }\r\n\r\n        if (sizes.length > 0) {\r\n            setSize(prev => (prev && sizes.includes(prev) ? prev : sizes[0]));\r\n        } else {\r\n            setSize('');\r\n        }\r\n    }, [colors, sizes]);\r\n\r\n    async function handleSubmitReview(e) {\r\n        e.preventDefault();\r\n        if (!reviewRating) {\r\n            alert('Vui lòng chọn số sao');\r\n            return;\r\n        }\r\n        try {\r\n            setSubmitting(true);\r\n            const saved = await submitReview(id, { rating: reviewRating, comment: reviewComment });\r\n            // Cập nhật trạng thái của chính review\r\n            setMyReview(saved);\r\n            setCanReview(false);\r\n            // Refresh danh sách + trung bình\r\n            const r = await getProductReviews(id);\r\n            setReviews(r.reviews || []);\r\n            setAvgRating(Number(r.average || 0));\r\n            setRatingCount(Number(r.count || 0));\r\n        } catch (err) {\r\n            console.error(err);\r\n            if (String(err).includes('401') || String(err.message || '').toLowerCase().includes('auth')) {\r\n                if (window.confirm('Bạn cần đăng nhập để đánh giá. Đi đến trang đăng nhập?')) {\r\n                    // điều hướng sang login nếu app bạn có route này\r\n                    window.location.href = '/login';\r\n                }\r\n            } else {\r\n                alert('Gửi đánh giá thất bại. Vui lòng thử lại.');\r\n            }\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    const wishlistEntry = useMemo(() => {\r\n        if (!product) return null;\r\n        return findWishlistItem(product.id, color, size);\r\n    }, [product, color, size, findWishlistItem]);\r\n\r\n    const handleToggleWishlist = async () => {\r\n        if (!product) return;\r\n        if (!isBuyer) {\r\n            alert('Vui lòng đăng nhập bằng tài khoản người mua để sử dụng danh sách yêu thích.');\r\n            return;\r\n        }\r\n        try {\r\n            await toggleWishlist(product, { color, size });\r\n        } catch (err) {\r\n            alert(err.message || 'Không thể cập nhật danh sách yêu thích');\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"product-detail\">\r\n                <div style={{ textAlign: 'center', padding: '80px 20px' }}>\r\n                    <p>Đang tải sản phẩm...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!product) {\r\n        return (\r\n            <div className=\"product-detail\">\r\n                <div className=\"pd-card\" style={{ maxWidth: '600px', margin: '80px auto', textAlign: 'center' }}>\r\n                    <h2>Không tìm thấy sản phẩm</h2>\r\n                    <p><Link to=\"/\" style={{ color: 'var(--accent)' }}>Quay về trang chủ</Link></p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const vouchers = product.vouchers || [];\r\n    const specs = product.specs || [];\r\n    const description = product.description || 'Chưa có mô tả cho sản phẩm này.';\r\n\r\n    // Shop info\r\n    const shop = {\r\n        id: product.seller_id,\r\n        name: product.seller_name || 'Cửa hàng V-Market',\r\n        avatar: 'avatars/default-avatar.png',\r\n        rating: product.rating || 4.8,\r\n        followers: product.followers || '150k'\r\n    };\r\n\r\n    function dec() {\r\n        setQty(prev => Math.max(1, prev - 1));\r\n    }\r\n\r\n    function inc() {\r\n        setQty(prev => Math.min(prev + 1, product.stock || 999));\r\n    }\r\n\r\n    function handleAddToCart(e) {\r\n        if (e?.preventDefault) e.preventDefault();\r\n        if (colors.length > 0 && !color) {\r\n            alert('Vui lòng chọn màu sắc');\r\n            return;\r\n        }\r\n        if (sizes.length > 0 && !size) {\r\n            alert('Vui lòng chọn kích thước');\r\n            return;\r\n        }\r\n        addToCart(product, qty, { color, size });\r\n        flyToCart(mainImageRef.current);\r\n        alert(`Đã thêm ${qty} sản phẩm vào giỏ hàng`);\r\n    }\r\n\r\n    function handleBuyNow() {\r\n        if (colors.length > 0 && !color) {\r\n            alert('Vui lòng chọn màu sắc');\r\n            return;\r\n        }\r\n        if (sizes.length > 0 && !size) {\r\n            alert('Vui lòng chọn kích thước');\r\n            return;\r\n        }\r\n        addToCart(product, qty, { color, size });\r\n        navigate('/cart');\r\n    }\r\n\r\n    function handleChatWithShop() {\r\n        navigate(`/chat/${shop.id}?product=${id}`);\r\n    }\r\n\r\n    function handleViewShop() {\r\n        navigate(`/shop/${shop.id}`);\r\n    }\r\n\r\n    return (\r\n        <div className=\"product-detail\">\r\n            <div className=\"product-detail-inner\">\r\n                {/* Left: Media */}\r\n                <div className=\"product-detail-media\">\r\n                    <div className=\"pd-main-media\">\r\n                        <img ref={mainImageRef} src={mainImage} alt={product.name} />\r\n                    </div>\r\n\r\n                    {product.images && product.images.length > 0 && (\r\n                        <div className=\"pd-thumbs\">\r\n                            {product.images.map((img, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`pd-thumb ${mainImage === img ? 'active' : ''}`}\r\n                                    onClick={() => setMainImage(img)}\r\n                                >\r\n                                    <img src={img} alt={`${product.name} ${i + 1}`} />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right: Info */}\r\n                <div className=\"product-detail-info\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                        <h1 style={{ flex: '1 1 auto', margin: 0 }}>{product.name}</h1>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`wishlist-heart ${wishlistEntry ? 'active' : ''}`}\r\n                            onClick={handleToggleWishlist}\r\n                            aria-label={wishlistEntry ? 'Bỏ khỏi yêu thích' : 'Thêm vào yêu thích'}\r\n                            style={{ position: 'static' }}\r\n                        >\r\n                            <Icon\r\n                                name=\"heart\"\r\n                                variant={wishlistEntry ? 'solid' : 'regular'}\r\n                                size={22}\r\n                            />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"product-detail-price\">\r\n                        {formatPrice(product.price)}\r\n                    </div>\r\n\r\n                    {/* Rating summary line */}\r\n                    <div style={{ margin: '8px 0 12px 0' }}>\r\n                        <StarRating value={avgRating} count={ratingCount} readOnly showValue size={16} />\r\n                    </div>\r\n\r\n                    <div className=\"pd-card\">\r\n                        {/* Voucher */}\r\n                        {vouchers.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Voucher</div>\r\n                                <div>\r\n                                    {vouchers.map(v => (\r\n                                        <span key={v} className=\"pd-chip\">{v}</span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Vận chuyển */}\r\n                        {product.shipping && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Vận chuyển</div>\r\n                                <div>\r\n                                    <div>Giao đến: <strong>{product.shipping.area || 'Toàn quốc'}</strong></div>\r\n                                    <div style={{ fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px' }}>\r\n                                        Phí ship: {product.shipping.feeText || 'Freeship đơn từ 0đ'}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Color selection */}\r\n                        {colors.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Màu sắc</div>\r\n                                <div>\r\n                                    {colors.map(c => (\r\n                                        <button\r\n                                            key={c}\r\n                                            className={`pd-chip ${color === c ? 'active' : ''}`}\r\n                                            onClick={() => setColor(c)}\r\n                                        >\r\n                                            {c}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Size selection */}\r\n                        {sizes.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Kích thước</div>\r\n                                <div>\r\n                                    {sizes.map(s => (\r\n                                        <button\r\n                                            key={s}\r\n                                            className={`pd-chip ${size === s ? 'active' : ''}`}\r\n                                            onClick={() => setSize(s)}\r\n                                        >\r\n                                            {s}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Quantity */}\r\n                        <div className=\"pd-row\">\r\n                            <div className=\"pd-label\">Số lượng</div>\r\n                            <div>\r\n                                <div className=\"pd-qty\">\r\n                                    <button onClick={dec} aria-label=\"Giảm số lượng\">\r\n                                        <Icon name=\"minus\" size={12} />\r\n                                    </button>\r\n                                    <input type=\"number\" value={qty} readOnly />\r\n                                    <button onClick={inc} aria-label=\"Tăng số lượng\">\r\n                                        <Icon name=\"plus\" size={12} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"pd-actions\">\r\n                            <button className=\"add-cart\" onClick={handleAddToCart}>\r\n                                Thêm vào giỏ\r\n                            </button>\r\n                            <button className=\"buy-now\" onClick={handleBuyNow}>\r\n                                Mua ngay\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Shop card */}\r\n                    <div className=\"pd-card shop-card\">\r\n                        <div\r\n                            className=\"shop-avatar\"\r\n                            style={{\r\n                                backgroundImage: `url(${shop.avatar})`,\r\n                                backgroundSize: 'cover',\r\n                                backgroundPosition: 'center'\r\n                            }}\r\n                        />\r\n                        <div className=\"shop-info\">\r\n                            <h4 style={{ margin: '0 0 4px 0', fontSize: '16px', fontWeight: '700' }}>\r\n                                {shop.name}\r\n                            </h4>\r\n                            <p style={{ margin: 0, fontSize: '13px', color: 'var(--text-muted)' }}>\r\n                                Đánh giá: <strong>{shop.rating}</strong> • Người theo dõi: <strong>{shop.followers}</strong>\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"shop-actions\">\r\n                            <button onClick={handleChatWithShop}>Chat ngay</button>\r\n                            <button onClick={handleViewShop}>Xem shop</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Meta info */}\r\n                    <div className=\"pd-meta\">\r\n                        <div className=\"pd-meta-row\">\r\n                            <Icon name=\"box-open\" size={18} className=\"pd-meta-icon\" />\r\n                            <span>Danh mục: {product.category?.name || 'Chưa phân loại'}</span>\r\n                        </div>\r\n                        <div className=\"pd-meta-row\">\r\n                            <Icon name=\"chart-column\" size={18} className=\"pd-meta-icon\" />\r\n                            <span>Còn lại: {product.stock || 0} sản phẩm</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Sections below */}\r\n            <div className=\"detail-sections\">\r\n                {/* Specifications */}\r\n                {specs.length > 0 && (\r\n                    <section className=\"detail-section\">\r\n                        <h3>Chi tiết sản phẩm</h3>\r\n                        <div className=\"specs\">\r\n                            {specs.map((spec, i) => (\r\n                                <React.Fragment key={i}>\r\n                                    <div className=\"pd-label\">{spec.label || spec[0]}:</div>\r\n                                    <div>{spec.value || spec[1]}</div>\r\n                                </React.Fragment>\r\n                            ))}\r\n                        </div>\r\n                    </section>\r\n                )}\r\n\r\n                {/* Description */}\r\n                <section className=\"detail-section\">\r\n                    <h3>Mô tả sản phẩm</h3>\r\n                    <div className=\"pd-description\">\r\n                        <pre>{description}</pre>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Reviews */}\r\n                <section className=\"detail-section\">\r\n                    <h3>Đánh giá sản phẩm</h3>\r\n\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 12 }}>\r\n                        <StarRating value={avgRating} count={ratingCount} readOnly showValue size={20} />\r\n                        {reviewsLoading ? <span>Đang tải đánh giá...</span> : null}\r\n                    </div>\r\n\r\n                    {(canReview || myReview) && (\r\n                        <form onSubmit={handleSubmitReview} className=\"pd-card\" style={{ marginBottom: 16 }}>\r\n                            <div style={{ marginBottom: 10 }}>\r\n                                <div style={{ marginBottom: 6 }}>{myReview ? 'Cập nhật đánh giá của bạn' : 'Đánh giá của bạn'}</div>\r\n                                <StarRating\r\n                                    value={reviewRating}\r\n                                    readOnly={false}\r\n                                    onChange={setReviewRating}\r\n                                    size={24}\r\n                                />\r\n                            </div>\r\n                            <div style={{ marginBottom: 10 }}>\r\n                                <textarea\r\n                                    placeholder=\"Chia sẻ cảm nhận về sản phẩm...\"\r\n                                    value={reviewComment}\r\n                                    onChange={(e) => setReviewComment(e.target.value)}\r\n                                    rows={4}\r\n                                    style={{ width: '100%', padding: 10, borderRadius: 6, border: '1px solid #e5e7eb' }}\r\n                                />\r\n                            </div>\r\n                            <button className=\"add-cart\" disabled={submitting}>\r\n                                {submitting ? 'Đang gửi...' : (myReview ? 'Cập nhật đánh giá' : 'Gửi đánh giá')}\r\n                            </button>\r\n                        </form>\r\n                    )}\r\n\r\n                    {!canReview && !reviewsLoading && !myReview && (\r\n                        <div className=\"pd-card\" style={{ color: 'var(--text-muted)' }}>\r\n                            Chỉ người đã mua sản phẩm mới có thể đánh giá. <a href=\"/login\" style={{ color: 'var(--accent)' }}>Đăng nhập</a>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Reviews list */}\r\n                    {reviews.length > 0 ? (\r\n                        <div className=\"pd-card\" style={{ display: 'grid', gap: 12 }}>\r\n                            {reviews.map((rv) => (\r\n                                <div key={rv.id || `${rv.user_id}-${rv.created_at}`} style={{ borderBottom: '1px solid #f0f0f0', paddingBottom: 10 }}>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                                        <strong style={{ fontSize: 14 }}>{rv.user_name || 'Người dùng'}</strong>\r\n                                        <StarRating value={rv.rating} readOnly size={14} />\r\n                                        <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>\r\n                                            {rv.created_at ? new Date(rv.created_at).toLocaleDateString('vi-VN') : ''}\r\n                                        </span>\r\n                                    </div>\r\n                                    {rv.comment ? (\r\n                                        <div style={{ marginTop: 6, whiteSpace: 'pre-wrap' }}>{rv.comment}</div>\r\n                                    ) : null}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    ) : !reviewsLoading ? (\r\n                        <div className=\"pd-card\" style={{ color: 'var(--text-muted)' }}>\r\n                            Chưa có đánh giá nào.\r\n                        </div>\r\n                    ) : null}\r\n                </section>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}