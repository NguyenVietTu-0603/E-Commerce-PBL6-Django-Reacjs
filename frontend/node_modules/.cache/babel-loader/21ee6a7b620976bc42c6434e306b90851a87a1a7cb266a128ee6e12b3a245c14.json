{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import authService from\"../utils/authService\";import'../assets/authPages.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function AuthModal(_ref){let{open=false,initialMode=\"login\",// 'login' | 'register'\nonClose=()=>{},onLoginSuccess=()=>{},onRegisterSuccess=()=>{}}=_ref;const[mode,setMode]=useState(initialMode);const[loading,setLoading]=useState(false);const[error,setError]=useState(null);// form fields\nconst[username,setUsername]=useState(\"\");const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");const[userType,setUserType]=useState(\"buyer\");useEffect(()=>{setMode(initialMode);setError(null);setLoading(false);// reset fields when opening\nif(open){setUsername(\"\");setEmail(\"\");setPassword(\"\");setUserType(\"buyer\");}},[initialMode,open]);if(!open)return null;async function handleSubmit(e){e===null||e===void 0?void 0:e.preventDefault();setError(null);setLoading(true);try{if(mode===\"login\"){var _data$user;const data=await authService.login(username||email,password);// authService.login returns parsed API response or fallback object\nconst user=(_data$user=data.user)!==null&&_data$user!==void 0?_data$user:data;// persist user if provided\ntry{if(user)localStorage.setItem(\"user\",JSON.stringify(user));}catch(_unused){}if(onLoginSuccess)onLoginSuccess(user);}else{var _data$user2;const payload={username,email,password,user_type:userType};const data=await authService.register(payload);const user=(_data$user2=data.user)!==null&&_data$user2!==void 0?_data$user2:data;try{if(user)localStorage.setItem(\"user\",JSON.stringify(user));}catch(_unused2){}if(onRegisterSuccess)onRegisterSuccess(user);}setLoading(false);onClose();}catch(err){setLoading(false);// normalize error message\nif(typeof err===\"string\")setError(err);else if(err&&err.detail)setError(err.detail);else if(err&&err.message)setError(err.message);else setError(\"Có lỗi xảy ra. Vui lòng thử lại.\");}}return/*#__PURE__*/_jsx(\"div\",{className:\"auth-modal-overlay\",role:\"dialog\",\"aria-modal\":\"true\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"auth-modal\",children:[/*#__PURE__*/_jsxs(\"header\",{className:\"auth-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:mode===\"login\"?\"Đăng nhập\":\"Đăng ký\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"close-btn\",onClick:onClose,\"aria-label\":\"Close\",children:\"\\u2715\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-tabs\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"tab \".concat(mode===\"login\"?\"active\":\"\"),onClick:()=>setMode(\"login\"),children:\"\\u0110\\u0103ng nh\\u1EADp\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"tab \".concat(mode===\"register\"?\"active\":\"\"),onClick:()=>setMode(\"register\"),children:\"\\u0110\\u0103ng k\\xFD\"})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"auth-form\",onSubmit:handleSubmit,children:[mode===\"register\"&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"T\\xEAn \\u0111\\u0103ng nh\\u1EADp\",/*#__PURE__*/_jsx(\"input\",{value:username,onChange:e=>setUsername(e.target.value)})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Email\",/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:email,onChange:e=>setEmail(e.target.value)})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Lo\\u1EA1i t\\xE0i kho\\u1EA3n\",/*#__PURE__*/_jsxs(\"select\",{value:userType,onChange:e=>setUserType(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"buyer\",children:\"Buyer\"}),/*#__PURE__*/_jsx(\"option\",{value:\"seller\",children:\"Seller\"})]})]})]}),mode===\"login\"&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"label\",{children:[\"Email ho\\u1EB7c username\",/*#__PURE__*/_jsx(\"input\",{value:username,onChange:e=>setUsername(e.target.value)})]})}),/*#__PURE__*/_jsxs(\"label\",{children:[\"M\\u1EADt kh\\u1EA9u\",/*#__PURE__*/_jsx(\"input\",{type:\"password\",value:password,onChange:e=>setPassword(e.target.value)})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"auth-error\",role:\"alert\",children:String(error)}),/*#__PURE__*/_jsxs(\"div\",{className:\"auth-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,children:loading?\"Đang xử lý...\":mode===\"login\"?\"Đăng nhập\":\"Đăng ký\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"switch-btn\",onClick:()=>setMode(mode===\"login\"?\"register\":\"login\"),children:mode===\"login\"?\"Chưa có tài khoản? Đăng ký\":\"Đã có tài khoản? Đăng nhập\"})]})]})]})});}","map":{"version":3,"names":["React","useEffect","useState","authService","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AuthModal","_ref","open","initialMode","onClose","onLoginSuccess","onRegisterSuccess","mode","setMode","loading","setLoading","error","setError","username","setUsername","email","setEmail","password","setPassword","userType","setUserType","handleSubmit","e","preventDefault","_data$user","data","login","user","localStorage","setItem","JSON","stringify","_unused","_data$user2","payload","user_type","register","_unused2","err","detail","message","className","role","children","type","onClick","concat","onSubmit","value","onChange","target","String","disabled"],"sources":["C:/VIET/PBL6/main/frontend/src/components/AuthModal.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport authService from \"../utils/authService\";\r\nimport '../assets/authPages.css'\r\n\r\nexport default function AuthModal({\r\n  open = false,\r\n  initialMode = \"login\", // 'login' | 'register'\r\n  onClose = () => {},\r\n  onLoginSuccess = () => {},\r\n  onRegisterSuccess = () => {},\r\n}) {\r\n  const [mode, setMode] = useState(initialMode);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // form fields\r\n  const [username, setUsername] = useState(\"\");\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [userType, setUserType] = useState(\"buyer\");\r\n\r\n  useEffect(() => {\r\n    setMode(initialMode);\r\n    setError(null);\r\n    setLoading(false);\r\n    // reset fields when opening\r\n    if (open) {\r\n      setUsername(\"\");\r\n      setEmail(\"\");\r\n      setPassword(\"\");\r\n      setUserType(\"buyer\");\r\n    }\r\n  }, [initialMode, open]);\r\n\r\n  if (!open) return null;\r\n\r\n  async function handleSubmit(e) {\r\n    e?.preventDefault();\r\n    setError(null);\r\n    setLoading(true);\r\n\r\n    try {\r\n      if (mode === \"login\") {\r\n        const data = await authService.login(username || email, password);\r\n        // authService.login returns parsed API response or fallback object\r\n        const user = data.user ?? data;\r\n        // persist user if provided\r\n        try { if (user) localStorage.setItem(\"user\", JSON.stringify(user)); } catch {}\r\n        if (onLoginSuccess) onLoginSuccess(user);\r\n      } else {\r\n        const payload = { username, email, password, user_type: userType };\r\n        const data = await authService.register(payload);\r\n        const user = data.user ?? data;\r\n        try { if (user) localStorage.setItem(\"user\", JSON.stringify(user)); } catch {}\r\n        if (onRegisterSuccess) onRegisterSuccess(user);\r\n      }\r\n      setLoading(false);\r\n      onClose();\r\n    } catch (err) {\r\n      setLoading(false);\r\n      // normalize error message\r\n      if (typeof err === \"string\") setError(err);\r\n      else if (err && err.detail) setError(err.detail);\r\n      else if (err && err.message) setError(err.message);\r\n      else setError(\"Có lỗi xảy ra. Vui lòng thử lại.\");\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"auth-modal-overlay\" role=\"dialog\" aria-modal=\"true\">\r\n      <div className=\"auth-modal\">\r\n        <header className=\"auth-header\">\r\n          <h3>{mode === \"login\" ? \"Đăng nhập\" : \"Đăng ký\"}</h3>\r\n          <button type=\"button\" className=\"close-btn\" onClick={onClose} aria-label=\"Close\">✕</button>\r\n        </header>\r\n\r\n        <div className=\"auth-tabs\">\r\n          <button\r\n            type=\"button\"\r\n            className={`tab ${mode === \"login\" ? \"active\" : \"\"}`}\r\n            onClick={() => setMode(\"login\")}\r\n          >\r\n            Đăng nhập\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            className={`tab ${mode === \"register\" ? \"active\" : \"\"}`}\r\n            onClick={() => setMode(\"register\")}\r\n          >\r\n            Đăng ký\r\n          </button>\r\n        </div>\r\n\r\n        <form className=\"auth-form\" onSubmit={handleSubmit}>\r\n          {mode === \"register\" && (\r\n            <>\r\n              <label>\r\n                Tên đăng nhập\r\n                <input value={username} onChange={(e) => setUsername(e.target.value)} />\r\n              </label>\r\n              <label>\r\n                Email\r\n                <input type=\"email\" value={email} onChange={(e) => setEmail(e.target.value)} />\r\n              </label>\r\n              <label>\r\n                Loại tài khoản\r\n                <select value={userType} onChange={(e) => setUserType(e.target.value)}>\r\n                  <option value=\"buyer\">Buyer</option>\r\n                  <option value=\"seller\">Seller</option>\r\n                </select>\r\n              </label>\r\n            </>\r\n          )}\r\n\r\n          {mode === \"login\" && (\r\n            <>\r\n              <label>\r\n                Email hoặc username\r\n                <input value={username} onChange={(e) => setUsername(e.target.value)} />\r\n              </label>\r\n            </>\r\n          )}\r\n\r\n          <label>\r\n            Mật khẩu\r\n            <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} />\r\n          </label>\r\n\r\n          {error && <div className=\"auth-error\" role=\"alert\">{String(error)}</div>}\r\n\r\n          <div className=\"auth-actions\">\r\n            <button type=\"submit\" disabled={loading}>\r\n              {loading ? \"Đang xử lý...\" : mode === \"login\" ? \"Đăng nhập\" : \"Đăng ký\"}\r\n            </button>\r\n\r\n            <button\r\n              type=\"button\"\r\n              className=\"switch-btn\"\r\n              onClick={() => setMode(mode === \"login\" ? \"register\" : \"login\")}\r\n            >\r\n              {mode === \"login\" ? \"Chưa có tài khoản? Đăng ký\" : \"Đã có tài khoản? Đăng nhập\"}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}