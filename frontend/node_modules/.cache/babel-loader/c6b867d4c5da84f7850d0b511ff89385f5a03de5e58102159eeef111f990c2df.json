{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";const API=process.env.REACT_APP_API_URL||'';function getToken(){return localStorage.getItem('access_token')||null;}function getAuthHeader(){const token=getToken();return token?{Authorization:\"Bearer \".concat(token)}:{};}async function parseJson(res){const text=await res.text();try{return JSON.parse(text);}catch(_unused){return text;}}export async function login(username,password){var _data$access,_data$tokens,_data$refresh,_data$tokens2,_ref,_data$user;const res=await fetch(\"\".concat(API,\"/api/users/token/\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username,password})});const data=await parseJson(res);if(!res.ok)throw data;const access=(_data$access=data.access)!==null&&_data$access!==void 0?_data$access:(_data$tokens=data.tokens)===null||_data$tokens===void 0?void 0:_data$tokens.access;const refresh=(_data$refresh=data.refresh)!==null&&_data$refresh!==void 0?_data$refresh:(_data$tokens2=data.tokens)===null||_data$tokens2===void 0?void 0:_data$tokens2.refresh;const user=(_ref=(_data$user=data.user)!==null&&_data$user!==void 0?_data$user:data.user_info)!==null&&_ref!==void 0?_ref:null;if(access)localStorage.setItem('access_token',access);if(refresh)localStorage.setItem('refresh_token',refresh);if(user)localStorage.setItem('user',JSON.stringify(user));return{access,refresh,user};}export async function register(payload){var _data$access2,_data$tokens3,_data$refresh2,_data$tokens4,_data$user2;const res=await fetch(\"\".concat(API,\"/api/auth/register/\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});const data=await parseJson(res);if(!res.ok)throw data;const access=(_data$access2=data.access)!==null&&_data$access2!==void 0?_data$access2:(_data$tokens3=data.tokens)===null||_data$tokens3===void 0?void 0:_data$tokens3.access;const refresh=(_data$refresh2=data.refresh)!==null&&_data$refresh2!==void 0?_data$refresh2:(_data$tokens4=data.tokens)===null||_data$tokens4===void 0?void 0:_data$tokens4.refresh;const user=(_data$user2=data.user)!==null&&_data$user2!==void 0?_data$user2:null;if(access)localStorage.setItem('access_token',access);if(refresh)localStorage.setItem('refresh_token',refresh);if(user)localStorage.setItem('user',JSON.stringify(user));return data;}export async function logout(){try{await fetch(\"\".concat(API,\"/api/auth/logout/\"),{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},getAuthHeader())});}catch(e){/* ignore */}// Xóa sạch mọi token + user\nconst TOKEN_KEYS=['access','access_token','accessToken','token','jwt','authToken','refresh','refresh_token'];TOKEN_KEYS.forEach(k=>localStorage.removeItem(k));localStorage.removeItem('user');// Xóa cookie session nếu có\ndocument.cookie.split(\";\").forEach(c=>{document.cookie=c.replace(/^ +/,\"\").replace(/=.*/,\"=;expires=\"+new Date().toUTCString()+\";path=/\");});}export async function getCurrentUser(){var _data$user3;const res=await fetch(\"\".concat(API,\"/api/users/me/\"),{headers:_objectSpread({'Content-Type':'application/json'},getAuthHeader())});if(res.status===401||res.status===403)throw new Error('Unauthorized');const data=await parseJson(res);if(!res.ok)throw data;return(_data$user3=data.user)!==null&&_data$user3!==void 0?_data$user3:data;}export default{login,register,logout,getCurrentUser};","map":{"version":3,"names":["API","process","env","REACT_APP_API_URL","getToken","localStorage","getItem","getAuthHeader","token","Authorization","concat","parseJson","res","text","JSON","parse","_unused","login","username","password","_data$access","_data$tokens","_data$refresh","_data$tokens2","_ref","_data$user","fetch","method","headers","body","stringify","data","ok","access","tokens","refresh","user","user_info","setItem","register","payload","_data$access2","_data$tokens3","_data$refresh2","_data$tokens4","_data$user2","logout","_objectSpread","e","TOKEN_KEYS","forEach","k","removeItem","document","cookie","split","c","replace","Date","toUTCString","getCurrentUser","_data$user3","status","Error"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API = process.env.REACT_APP_API_URL || '';\r\n\r\nfunction getToken() {\r\n  return localStorage.getItem('access_token') || null;\r\n}\r\n\r\nfunction getAuthHeader() {\r\n  const token = getToken();\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseJson(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API}/api/users/token/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  const user = data.user ?? data.user_info ?? null;\r\n\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n\r\n  return { access, refresh, user };\r\n}\r\n\r\nexport async function register(payload) {\r\n  const res = await fetch(`${API}/api/auth/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  const user = data.user ?? null;\r\n\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n\r\n  return data;\r\n}\r\n\r\nexport async function logout() {\r\n  try {\r\n    await fetch(`${API}/api/auth/logout/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n    });\r\n  } catch (e) { /* ignore */ }\r\n\r\n  // Xóa sạch mọi token + user\r\n  const TOKEN_KEYS = ['access', 'access_token', 'accessToken', 'token', 'jwt', 'authToken', 'refresh', 'refresh_token'];\r\n  TOKEN_KEYS.forEach(k => localStorage.removeItem(k));\r\n  localStorage.removeItem('user');\r\n\r\n  // Xóa cookie session nếu có\r\n  document.cookie.split(\";\").forEach(c => {\r\n    document.cookie = c.replace(/^ +/, \"\").replace(/=.*/, \"=;expires=\" + new Date().toUTCString() + \";path=/\");\r\n  });\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const res = await fetch(`${API}/api/users/me/`, {\r\n    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n  });\r\n  if (res.status === 401 || res.status === 403) throw new Error('Unauthorized');\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  return data.user ?? data;\r\n}\r\n\r\nexport default { login, register, logout, getCurrentUser };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}