{"ast":null,"code":"import React,{useEffect,useMemo,useState}from'react';import{useLocation}from'react-router-dom';import ProductGrid from'../components/ProductGrid';import Loading from'../components/Loading';import'../assets/SearchResults.css';import{jsxs as _jsxs,jsx as _jsx,Fragment as _Fragment}from\"react/jsx-runtime\";function useQuery(){const{search}=useLocation();return useMemo(()=>new URLSearchParams(search),[search]);}export default function SearchResults(){const qs=useQuery();const mode=qs.get('mode')||'text';const q=(qs.get('q')||'').trim();const[results,setResults]=useState([]);const[loading,setLoading]=useState(true);const[err,setErr]=useState(null);useEffect(()=>{let cancelled=false;async function run(){setLoading(true);setErr(null);try{if(mode==='image'){const cached=sessionStorage.getItem('imageSearchResults');const arr=cached?JSON.parse(cached):[];if(!cancelled)setResults(Array.isArray(arr)?arr:[]);}else{if(!q){setResults([]);return;}const res=await fetch(\"http://localhost:8000/api/products/?search=\".concat(encodeURIComponent(q)));const data=await res.json();if(!res.ok)throw new Error((data===null||data===void 0?void 0:data.error)||\"HTTP \".concat(res.status));const items=Array.isArray(data)?data:data.results||[];if(!cancelled)setResults(items);}}catch(e){if(!cancelled)setErr(String(e.message||e));}finally{if(!cancelled)setLoading(false);}}run();return()=>{cancelled=true;};},[mode,q]);const resultsCount=(results===null||results===void 0?void 0:results.length)||0;return/*#__PURE__*/_jsx(\"div\",{className:\"search-results-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-results-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"search-header\",children:[/*#__PURE__*/_jsxs(\"h1\",{children:[\"K\\u1EBFt qu\\u1EA3 t\\xECm ki\\u1EBFm \",mode==='image'?'(·∫¢nh)':'']}),mode!=='image'&&/*#__PURE__*/_jsxs(\"div\",{className:\"search-query\",children:[\"T\\u1EEB kh\\xF3a: \",/*#__PURE__*/_jsx(\"strong\",{children:q||'(tr·ªëng)'})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"results-count\",children:[resultsCount,\" s\\u1EA3n ph\\u1EA9m\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"products-section\",children:[err&&/*#__PURE__*/_jsx(\"div\",{className:\"search-error\",children:err}),loading?/*#__PURE__*/_jsx(Loading,{message:\"\\u0110ang t\\u1EA3i k\\u1EBFt qu\\u1EA3...\"}):resultsCount===0?/*#__PURE__*/_jsxs(\"div\",{className:\"no-results\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"no-results-icon\",children:\"\\uD83D\\uDD0E\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Kh\\xF4ng t\\xECm th\\u1EA5y k\\u1EBFt qu\\u1EA3\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Th\\u1EED t\\u1EEB kh\\xF3a kh\\xE1c ho\\u1EB7c d\\xF9ng t\\xEDnh n\\u0103ng \\u201CT\\xECm b\\u1EB1ng \\u1EA3nh\\u201D \\u1EDF thanh t\\xECm ki\\u1EBFm.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"suggestions\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"G\\u1EE3i \\xFD nhanh\"}),/*#__PURE__*/_jsx(\"div\",{className:\"suggestion-tags\",children:['tshirt','jeans','sneakers','watch','bag'].map(s=>/*#__PURE__*/_jsx(\"a\",{className:\"suggestion-tag\",href:\"/search?q=\".concat(encodeURIComponent(s)),children:s},s))})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"results-header\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"results-info\",children:[\"Hi\\u1EC3n th\\u1ECB \",resultsCount,\" s\\u1EA3n ph\\u1EA9m\",mode==='image'&&/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:8,color:'var(--text-light)'},children:\"(k\\u1EBFt qu\\u1EA3 t\\u1EEB \\u1EA3nh)\"})]})}),/*#__PURE__*/_jsx(ProductGrid,{products:results})]})]})]})});}","map":{"version":3,"names":["React","useEffect","useMemo","useState","useLocation","ProductGrid","Loading","jsxs","_jsxs","jsx","_jsx","Fragment","_Fragment","useQuery","search","URLSearchParams","SearchResults","qs","mode","get","q","trim","results","setResults","loading","setLoading","err","setErr","cancelled","run","cached","sessionStorage","getItem","arr","JSON","parse","Array","isArray","res","fetch","concat","encodeURIComponent","data","json","ok","Error","error","status","items","e","String","message","resultsCount","length","className","children","map","s","href","style","marginLeft","color","products"],"sources":["C:/VIET/PBL6/main/frontend/src/pages/SearchResults.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport ProductGrid from '../components/ProductGrid';\r\nimport Loading from '../components/Loading';\r\nimport '../assets/SearchResults.css';\r\n\r\nfunction useQuery() {\r\n  const { search } = useLocation();\r\n  return useMemo(() => new URLSearchParams(search), [search]);\r\n}\r\n\r\nexport default function SearchResults() {\r\n  const qs = useQuery();\r\n  const mode = qs.get('mode') || 'text';\r\n  const q = (qs.get('q') || '').trim();\r\n\r\n  const [results, setResults] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState(null);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    async function run() {\r\n      setLoading(true); setErr(null);\r\n      try {\r\n        if (mode === 'image') {\r\n          const cached = sessionStorage.getItem('imageSearchResults');\r\n          const arr = cached ? JSON.parse(cached) : [];\r\n          if (!cancelled) setResults(Array.isArray(arr) ? arr : []);\r\n        } else {\r\n          if (!q) { setResults([]); return; }\r\n          const res = await fetch(`http://localhost:8000/api/products/?search=${encodeURIComponent(q)}`);\r\n          const data = await res.json();\r\n          if (!res.ok) throw new Error(data?.error || `HTTP ${res.status}`);\r\n          const items = Array.isArray(data) ? data : (data.results || []);\r\n          if (!cancelled) setResults(items);\r\n        }\r\n      } catch (e) {\r\n        if (!cancelled) setErr(String(e.message || e));\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    }\r\n    run();\r\n    return () => { cancelled = true; };\r\n  }, [mode, q]);\r\n\r\n  const resultsCount = results?.length || 0;\r\n\r\n  return (\r\n    <div className=\"search-results-page\">\r\n      <div className=\"search-results-container\">\r\n        <div className=\"search-header\">\r\n          <h1>K·∫øt qu·∫£ t√¨m ki·∫øm {mode === 'image' ? '(·∫¢nh)' : ''}</h1>\r\n          {mode !== 'image' && (\r\n            <div className=\"search-query\">T·ª´ kh√≥a: <strong>{q || '(tr·ªëng)'}</strong></div>\r\n          )}\r\n          <p className=\"results-count\">{resultsCount} s·∫£n ph·∫©m</p>\r\n        </div>\r\n\r\n        <div className=\"products-section\">\r\n          {err && <div className=\"search-error\">{err}</div>}\r\n\r\n          {loading ? (\r\n            <Loading message=\"ƒêang t·∫£i k·∫øt qu·∫£...\" />\r\n          ) : resultsCount === 0 ? (\r\n            <div className=\"no-results\">\r\n              <div className=\"no-results-icon\">üîé</div>\r\n              <h3>Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£</h3>\r\n              <p>Th·ª≠ t·ª´ kh√≥a kh√°c ho·∫∑c d√πng t√≠nh nƒÉng ‚ÄúT√¨m b·∫±ng ·∫£nh‚Äù ·ªü thanh t√¨m ki·∫øm.</p>\r\n              <div className=\"suggestions\">\r\n                <h4>G·ª£i √Ω nhanh</h4>\r\n                <div className=\"suggestion-tags\">\r\n                  {['tshirt', 'jeans', 'sneakers', 'watch', 'bag'].map((s) => (\r\n                    <a key={s} className=\"suggestion-tag\" href={`/search?q=${encodeURIComponent(s)}`}>{s}</a>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              <div className=\"results-header\">\r\n                <div className=\"results-info\">\r\n                  Hi·ªÉn th·ªã {resultsCount} s·∫£n ph·∫©m\r\n                  {mode === 'image' && <span style={{ marginLeft: 8, color: 'var(--text-light)' }}>(k·∫øt qu·∫£ t·ª´ ·∫£nh)</span>}\r\n                </div>\r\n              </div>\r\n              <ProductGrid products={results} />\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}