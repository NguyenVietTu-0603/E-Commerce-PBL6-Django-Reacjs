{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useMemo}from'react';import{useParams,useNavigate}from'react-router-dom';import ProductGrid from'../components/ProductGrid';import ImageSearchUpload from'../components/ImageSearchUpload';import Loading from'../components/Loading';import'../assets/CategoryPage.css';import Icon from'../components/Icon';import usePageTitle from'../hooks/usePageTitle';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function CategoryPage(){var _ref,_ref2,_params$slug;const params=useParams();const rawCategoryParam=(_ref=(_ref2=(_params$slug=params.slug)!==null&&_params$slug!==void 0?_params$slug:params.categoryName)!==null&&_ref2!==void 0?_ref2:params.category)!==null&&_ref!==void 0?_ref:'';const slugFromUrl=rawCategoryParam?decodeURIComponent(rawCategoryParam):'';const navigate=useNavigate();// Data\nconst[categories,setCategories]=useState([]);const[products,setProducts]=useState([]);// UI/Filter state\nconst[query,setQuery]=useState('');const[priceRange,setPriceRange]=useState({min:'',max:''});const[sortBy,setSortBy]=useState('relevance');const[currentPage,setCurrentPage]=useState(1);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[showFilters,setShowFilters]=useState(false);const[imageResults,setImageResults]=useState(null);// danh sách trả về từ search ảnh\nuseEffect(()=>{let cancelled=false;async function load(){setLoading(true);setError(null);try{var _cRes$results,_pRes$results;const[cRes,pRes]=await Promise.all([fetch('http://localhost:8000/api/categories/').then(r=>r.json()),fetch('http://localhost:8000/api/products/').then(r=>r.json())]);if(cancelled)return;const cats=Array.isArray(cRes)?cRes:(_cRes$results=cRes.results)!==null&&_cRes$results!==void 0?_cRes$results:[];const prods=Array.isArray(pRes)?pRes:(_pRes$results=pRes.results)!==null&&_pRes$results!==void 0?_pRes$results:[];setCategories(cats);setProducts(prods);}catch(err){if(cancelled)return;console.error('CategoryPage load error',err);setError('Không thể tải dữ liệu. Vui lòng thử lại sau.');}finally{if(!cancelled)setLoading(false);}}load();return()=>{cancelled=true;};},[]);// Determine active category\nconst activeCategoryObj=useMemo(()=>{var _categories$find;if(!slugFromUrl)return null;return(_categories$find=categories.find(c=>{var _c$slug,_c$name,_c$id;const slug=String((_c$slug=c===null||c===void 0?void 0:c.slug)!==null&&_c$slug!==void 0?_c$slug:'').toLowerCase();const name=String((_c$name=c===null||c===void 0?void 0:c.name)!==null&&_c$name!==void 0?_c$name:'').toLowerCase();const id=String((_c$id=c===null||c===void 0?void 0:c.id)!==null&&_c$id!==void 0?_c$id:'').toLowerCase();const param=String(rawCategoryParam!==null&&rawCategoryParam!==void 0?rawCategoryParam:'').toLowerCase();return slug===param||name===param||id===param;}))!==null&&_categories$find!==void 0?_categories$find:null;},[categories,rawCategoryParam,slugFromUrl]);const pageTitle=(activeCategoryObj===null||activeCategoryObj===void 0?void 0:activeCategoryObj.name)||slugFromUrl||'Danh mục sản phẩm';usePageTitle(pageTitle);// Product matching\nfunction productMatchesCategory(prod,identifier){var _ref3,_pc$id,_ref4,_pc$name,_pc$slug;if(!identifier)return true;const idNorm=String(identifier).toLowerCase();const pc=prod.category;if(pc==null)return false;if(typeof pc==='string'||typeof pc==='number'){const v=String(pc).toLowerCase();return v===idNorm||v.includes(idNorm)||idNorm.includes(v);}const pid=String((_ref3=(_pc$id=pc.id)!==null&&_pc$id!==void 0?_pc$id:pc.pk)!==null&&_ref3!==void 0?_ref3:'').toLowerCase();const pname=String((_ref4=(_pc$name=pc.name)!==null&&_pc$name!==void 0?_pc$name:pc.title)!==null&&_ref4!==void 0?_ref4:'').toLowerCase();const pslug=String((_pc$slug=pc.slug)!==null&&_pc$slug!==void 0?_pc$slug:'').toLowerCase();return pid===idNorm||pname===idNorm||pslug===idNorm||pname.includes(idNorm)||pslug.includes(idNorm);}// Filtered products\nconst filteredProducts=useMemo(()=>{var _ref5,_activeCategoryObj$sl;const activeIdentifier=activeCategoryObj?(_ref5=(_activeCategoryObj$sl=activeCategoryObj.slug)!==null&&_activeCategoryObj$sl!==void 0?_activeCategoryObj$sl:activeCategoryObj.name)!==null&&_ref5!==void 0?_ref5:String(activeCategoryObj.id):slugFromUrl||'';const q=(query||'').trim().toLowerCase();const list=(products||[]).filter(product=>{var _product$price;if(activeIdentifier&&!productMatchesCategory(product,activeIdentifier))return false;if(q){var _product$name,_product$description;const name=String((_product$name=product.name)!==null&&_product$name!==void 0?_product$name:'').toLowerCase();const desc=String((_product$description=product.description)!==null&&_product$description!==void 0?_product$description:'').toLowerCase();if(!name.includes(q)&&!desc.includes(q))return false;}const price=Number((_product$price=product.price)!==null&&_product$price!==void 0?_product$price:0);if(priceRange.min&&price<Number(priceRange.min))return false;if(priceRange.max&&price>Number(priceRange.max))return false;return true;});switch(sortBy){case'price-low':list.sort((a,b)=>(Number(a.price)||0)-(Number(b.price)||0));break;case'price-high':list.sort((a,b)=>(Number(b.price)||0)-(Number(a.price)||0));break;case'name':list.sort((a,b)=>String(a.name).localeCompare(String(b.name)));break;case'newest':list.sort((a,b)=>(b.id||0)-(a.id||0));break;default:break;}return list;},[products,activeCategoryObj,slugFromUrl,query,priceRange,sortBy]);// Header count dùng effectiveFiltered thay vì filteredProducts\nconst effectiveFiltered=useMemo(()=>{if(imageResults)return imageResults;return filteredProducts;},[imageResults,filteredProducts]);const ITEMS_PER_PAGE=24;const totalPages=Math.max(1,Math.ceil(effectiveFiltered.length/ITEMS_PER_PAGE));useEffect(()=>{if(currentPage>totalPages)setCurrentPage(totalPages);},[currentPage,totalPages]);const paginatedProducts=useMemo(()=>{const start=(currentPage-1)*ITEMS_PER_PAGE;return effectiveFiltered.slice(start,start+ITEMS_PER_PAGE);},[effectiveFiltered,currentPage]);// Handlers\nconst handleCategoryChange=catSlugOrName=>{var _found$slug;if(!catSlugOrName){navigate('/products');return;}const found=categories.find(c=>String(c.slug)===String(catSlugOrName)||String(c.name)===String(catSlugOrName)||String(c.id)===String(catSlugOrName));const toSlug=found?(_found$slug=found.slug)!==null&&_found$slug!==void 0?_found$slug:found.name:catSlugOrName;navigate(\"/category/\".concat(encodeURIComponent(toSlug)));setShowFilters(false);};const handleClearFilters=()=>{setQuery('');setPriceRange({min:'',max:''});setSortBy('relevance');setCurrentPage(1);setImageResults(null);// thoát chế độ tìm bằng ảnh\n};// replace handleImageFileChange usage bằng ImageSearchUpload\nif(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"category-page\",children:/*#__PURE__*/_jsx(Loading,{message:\"\\u0110ang t\\u1EA3i s\\u1EA3n ph\\u1EA9m...\"})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"category-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"error-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"error-icon\",children:/*#__PURE__*/_jsx(Icon,{name:\"triangle-exclamation\",size:28})}),/*#__PURE__*/_jsx(\"h2\",{children:\"C\\xF3 l\\u1ED7i x\\u1EA3y ra\"}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),className:\"btn btn-primary\",children:\"Th\\u1EED l\\u1EA1i\"})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"category-page\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"category-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"category-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"breadcrumb\",children:[/*#__PURE__*/_jsx(\"a\",{href:\"/\",children:\"Trang ch\\u1EE7\"}),/*#__PURE__*/_jsx(\"span\",{className:\"breadcrumb-separator\",children:\"/\"}),/*#__PURE__*/_jsx(\"span\",{className:\"breadcrumb-current\",children:(activeCategoryObj===null||activeCategoryObj===void 0?void 0:activeCategoryObj.name)||slugFromUrl||'Tất cả sản phẩm'})]}),/*#__PURE__*/_jsx(\"h1\",{className:\"category-title\",children:(activeCategoryObj===null||activeCategoryObj===void 0?void 0:activeCategoryObj.name)||slugFromUrl||'Tất cả sản phẩm'}),/*#__PURE__*/_jsxs(\"p\",{className:\"category-subtitle\",children:[effectiveFiltered.length,\" s\\u1EA3n ph\\u1EA9m\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"category-content\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"filters-sidebar \".concat(showFilters?'mobile-open':''),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"filters-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"B\\u1ED9 l\\u1ECDc\"}),/*#__PURE__*/_jsx(\"button\",{className:\"filters-close\",onClick:()=>setShowFilters(false),\"aria-label\":\"\\u0110\\xF3ng b\\u1ED9 l\\u1ECDc\",children:/*#__PURE__*/_jsx(Icon,{name:\"xmark\",size:14})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-section\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-label\",children:\"T\\xECm ki\\u1EBFm\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"filter-input\",placeholder:\"T\\xECm s\\u1EA3n ph\\u1EA9m...\",value:query,onChange:e=>setQuery(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-section\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-label\",children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"category-list\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"category-item \".concat(!slugFromUrl?'active':''),onClick:()=>handleCategoryChange(''),children:\"T\\u1EA5t c\\u1EA3\"}),categories.map(cat=>/*#__PURE__*/_jsx(\"button\",{className:\"category-item \".concat((activeCategoryObj===null||activeCategoryObj===void 0?void 0:activeCategoryObj.id)===cat.id?'active':''),onClick:()=>handleCategoryChange(cat.slug||cat.name),children:cat.name},cat.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-section\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-label\",children:\"Kho\\u1EA3ng gi\\xE1\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"price-range-inputs\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"filter-input\",placeholder:\"T\\u1EEB\",value:priceRange.min,onChange:e=>setPriceRange(prev=>_objectSpread(_objectSpread({},prev),{},{min:e.target.value}))}),/*#__PURE__*/_jsx(\"span\",{className:\"price-separator\",children:\"-\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",className:\"filter-input\",placeholder:\"\\u0110\\u1EBFn\",value:priceRange.max,onChange:e=>setPriceRange(prev=>_objectSpread(_objectSpread({},prev),{},{max:e.target.value}))})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"filter-section\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"filter-label\",children:\"S\\u1EAFp x\\u1EBFp\"}),/*#__PURE__*/_jsxs(\"select\",{className:\"filter-select\",value:sortBy,onChange:e=>setSortBy(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"relevance\",children:\"Li\\xEAn quan\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price-low\",children:\"Gi\\xE1: Th\\u1EA5p \\u0111\\u1EBFn cao\"}),/*#__PURE__*/_jsx(\"option\",{value:\"price-high\",children:\"Gi\\xE1: Cao \\u0111\\u1EBFn th\\u1EA5p\"}),/*#__PURE__*/_jsx(\"option\",{value:\"name\",children:\"T\\xEAn: A-Z\"}),/*#__PURE__*/_jsx(\"option\",{value:\"newest\",children:\"M\\u1EDBi nh\\u1EA5t\"})]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-clear-filters\",onClick:handleClearFilters,children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"products-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"products-toolbar\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"btn-toggle-filters\",onClick:()=>setShowFilters(!showFilters),children:[/*#__PURE__*/_jsx(Icon,{name:\"filter\",size:14}),/*#__PURE__*/_jsx(\"span\",{children:\"B\\u1ED9 l\\u1ECDc\"})]}),/*#__PURE__*/_jsx(ImageSearchUpload,{k:48,onStart:()=>setLoading(true),onFinish:()=>setLoading(false),onResults:mapped=>{setImageResults(mapped);setCurrentPage(1);setShowFilters(false);},onError:msg=>setError(msg)}),imageResults&&/*#__PURE__*/_jsx(\"button\",{className:\"btn\",style:{marginLeft:8},onClick:()=>setImageResults(null),children:\"H\\u1EE7y k\\u1EBFt qu\\u1EA3 \\u1EA3nh\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"results-info\",children:[\"Hi\\u1EC3n th\\u1ECB \",paginatedProducts.length,\" / \",effectiveFiltered.length,\" s\\u1EA3n ph\\u1EA9m\",imageResults&&/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:8,color:'#888'},children:\"(k\\u1EBFt qu\\u1EA3 t\\u1EEB \\u1EA3nh)\"})]})]}),effectiveFiltered.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"empty-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"empty-icon\",children:/*#__PURE__*/_jsx(Icon,{name:\"box-open\",size:32})}),/*#__PURE__*/_jsx(\"h2\",{children:\"Kh\\xF4ng t\\xECm th\\u1EA5y s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Vui l\\xF2ng th\\u1EED \\u0111i\\u1EC1u ch\\u1EC9nh b\\u1ED9 l\\u1ECDc ho\\u1EB7c t\\xECm ki\\u1EBFm kh\\xE1c\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:handleClearFilters,children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ProductGrid,{products:paginatedProducts}),totalPages>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"pagination\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"pagination-btn\",onClick:()=>setCurrentPage(p=>Math.max(1,p-1)),disabled:currentPage===1,children:[/*#__PURE__*/_jsx(Icon,{name:\"angle-left\",size:12}),/*#__PURE__*/_jsx(\"span\",{children:\"Tr\\u01B0\\u1EDBc\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"pagination-pages\",children:Array.from({length:totalPages},(_,i)=>i+1).map(page=>/*#__PURE__*/_jsx(\"button\",{className:\"pagination-page \".concat(currentPage===page?'active':''),onClick:()=>setCurrentPage(page),children:page},page))}),/*#__PURE__*/_jsxs(\"button\",{className:\"pagination-btn\",onClick:()=>setCurrentPage(p=>Math.min(totalPages,p+1)),disabled:currentPage===totalPages,children:[/*#__PURE__*/_jsx(\"span\",{children:\"Sau\"}),/*#__PURE__*/_jsx(Icon,{name:\"angle-right\",size:12})]})]})]})]})]})]}),showFilters&&/*#__PURE__*/_jsx(\"div\",{className:\"filters-overlay-backdrop\",onClick:()=>setShowFilters(false)})]});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useParams","useNavigate","ProductGrid","ImageSearchUpload","Loading","Icon","usePageTitle","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","CategoryPage","_ref","_ref2","_params$slug","params","rawCategoryParam","slug","categoryName","category","slugFromUrl","decodeURIComponent","navigate","categories","setCategories","products","setProducts","query","setQuery","priceRange","setPriceRange","min","max","sortBy","setSortBy","currentPage","setCurrentPage","loading","setLoading","error","setError","showFilters","setShowFilters","imageResults","setImageResults","cancelled","load","_cRes$results","_pRes$results","cRes","pRes","Promise","all","fetch","then","r","json","cats","Array","isArray","results","prods","err","console","activeCategoryObj","_categories$find","find","c","_c$slug","_c$name","_c$id","String","toLowerCase","name","id","param","pageTitle","productMatchesCategory","prod","identifier","_ref3","_pc$id","_ref4","_pc$name","_pc$slug","idNorm","pc","v","includes","pid","pk","pname","title","pslug","filteredProducts","_ref5","_activeCategoryObj$sl","activeIdentifier","q","trim","list","filter","product","_product$price","_product$name","_product$description","desc","description","price","Number","sort","a","b","localeCompare","effectiveFiltered","ITEMS_PER_PAGE","totalPages","Math","ceil","length","paginatedProducts","start","slice","handleCategoryChange","catSlugOrName","_found$slug","found","toSlug","concat","encodeURIComponent","handleClearFilters","className","children","message","size","onClick","window","location","reload","href","type","placeholder","value","onChange","e","target","map","cat","prev","_objectSpread","k","onStart","onFinish","onResults","mapped","onError","msg","style","marginLeft","color","p","disabled","from","_","i","page"],"sources":["C:/VIET/PBL6/main/frontend/src/pages/CategoryPage.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport ProductGrid from '../components/ProductGrid';\r\nimport ImageSearchUpload from '../components/ImageSearchUpload';\r\nimport Loading from '../components/Loading';\r\nimport '../assets/CategoryPage.css';\r\nimport Icon from '../components/Icon';\r\nimport usePageTitle from '../hooks/usePageTitle';\r\n\r\nexport default function CategoryPage() {\r\n  const params = useParams();\r\n  const rawCategoryParam = params.slug ?? params.categoryName ?? params.category ?? '';\r\n  const slugFromUrl = rawCategoryParam ? decodeURIComponent(rawCategoryParam) : '';\r\n  const navigate = useNavigate();\r\n\r\n  // Data\r\n  const [categories, setCategories] = useState([]);\r\n  const [products, setProducts] = useState([]);\r\n\r\n  // UI/Filter state\r\n  const [query, setQuery] = useState('');\r\n  const [priceRange, setPriceRange] = useState({ min: '', max: '' });\r\n  const [sortBy, setSortBy] = useState('relevance');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  const [imageResults, setImageResults] = useState(null); // danh sách trả về từ search ảnh\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    async function load() {\r\n      setLoading(true);\r\n      setError(null);\r\n      try {\r\n        const [cRes, pRes] = await Promise.all([\r\n          fetch('http://localhost:8000/api/categories/').then(r => r.json()),\r\n          fetch('http://localhost:8000/api/products/').then(r => r.json())\r\n        ]);\r\n        if (cancelled) return;\r\n        \r\n        const cats = Array.isArray(cRes) ? cRes : (cRes.results ?? []);\r\n        const prods = Array.isArray(pRes) ? pRes : (pRes.results ?? []);\r\n        \r\n        setCategories(cats);\r\n        setProducts(prods);\r\n      } catch (err) {\r\n        if (cancelled) return;\r\n        console.error('CategoryPage load error', err);\r\n        setError('Không thể tải dữ liệu. Vui lòng thử lại sau.');\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    }\r\n    load();\r\n    return () => { cancelled = true; };\r\n  }, []);\r\n\r\n  // Determine active category\r\n  const activeCategoryObj = useMemo(() => {\r\n    if (!slugFromUrl) return null;\r\n    return categories.find(c => {\r\n      const slug = String(c?.slug ?? '').toLowerCase();\r\n      const name = String(c?.name ?? '').toLowerCase();\r\n      const id = String(c?.id ?? '').toLowerCase();\r\n      const param = String(rawCategoryParam ?? '').toLowerCase();\r\n      return slug === param || name === param || id === param;\r\n    }) ?? null;\r\n  }, [categories, rawCategoryParam, slugFromUrl]);\r\n\r\n  const pageTitle = activeCategoryObj?.name || slugFromUrl || 'Danh mục sản phẩm';\r\n  usePageTitle(pageTitle);\r\n\r\n  // Product matching\r\n  function productMatchesCategory(prod, identifier) {\r\n    if (!identifier) return true;\r\n    const idNorm = String(identifier).toLowerCase();\r\n    const pc = prod.category;\r\n    if (pc == null) return false;\r\n\r\n    if (typeof pc === 'string' || typeof pc === 'number') {\r\n      const v = String(pc).toLowerCase();\r\n      return v === idNorm || v.includes(idNorm) || idNorm.includes(v);\r\n    }\r\n\r\n    const pid = String(pc.id ?? pc.pk ?? '').toLowerCase();\r\n    const pname = String(pc.name ?? pc.title ?? '').toLowerCase();\r\n    const pslug = String(pc.slug ?? '').toLowerCase();\r\n\r\n    return pid === idNorm || pname === idNorm || pslug === idNorm || \r\n           pname.includes(idNorm) || pslug.includes(idNorm);\r\n  }\r\n\r\n  // Filtered products\r\n  const filteredProducts = useMemo(() => {\r\n    const activeIdentifier = activeCategoryObj \r\n      ? (activeCategoryObj.slug ?? activeCategoryObj.name ?? String(activeCategoryObj.id))\r\n      : (slugFromUrl || '');\r\n    const q = (query || '').trim().toLowerCase();\r\n\r\n    const list = (products || []).filter(product => {\r\n      if (activeIdentifier && !productMatchesCategory(product, activeIdentifier)) return false;\r\n      \r\n      if (q) {\r\n        const name = String(product.name ?? '').toLowerCase();\r\n        const desc = String(product.description ?? '').toLowerCase();\r\n        if (!name.includes(q) && !desc.includes(q)) return false;\r\n      }\r\n      \r\n      const price = Number(product.price ?? 0);\r\n      if (priceRange.min && price < Number(priceRange.min)) return false;\r\n      if (priceRange.max && price > Number(priceRange.max)) return false;\r\n      \r\n      return true;\r\n    });\r\n\r\n    switch (sortBy) {\r\n      case 'price-low':\r\n        list.sort((a, b) => (Number(a.price) || 0) - (Number(b.price) || 0));\r\n        break;\r\n      case 'price-high':\r\n        list.sort((a, b) => (Number(b.price) || 0) - (Number(a.price) || 0));\r\n        break;\r\n      case 'name':\r\n        list.sort((a, b) => String(a.name).localeCompare(String(b.name)));\r\n        break;\r\n      case 'newest':\r\n        list.sort((a, b) => (b.id || 0) - (a.id || 0));\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n\r\n    return list;\r\n  }, [products, activeCategoryObj, slugFromUrl, query, priceRange, sortBy]);\r\n\r\n  // Header count dùng effectiveFiltered thay vì filteredProducts\r\n  const effectiveFiltered = useMemo(() => {\r\n    if (imageResults) return imageResults;\r\n    return filteredProducts;\r\n  }, [imageResults, filteredProducts]);\r\n\r\n  const ITEMS_PER_PAGE = 24;\r\n  const totalPages = Math.max(1, Math.ceil(effectiveFiltered.length / ITEMS_PER_PAGE));\r\n  \r\n  useEffect(() => {\r\n    if (currentPage > totalPages) setCurrentPage(totalPages);\r\n  }, [currentPage, totalPages]);\r\n\r\n  const paginatedProducts = useMemo(() => {\r\n    const start = (currentPage - 1) * ITEMS_PER_PAGE;\r\n    return effectiveFiltered.slice(start, start + ITEMS_PER_PAGE);\r\n  }, [effectiveFiltered, currentPage]);\r\n\r\n  // Handlers\r\n  const handleCategoryChange = (catSlugOrName) => {\r\n    if (!catSlugOrName) {\r\n      navigate('/products');\r\n      return;\r\n    }\r\n    const found = categories.find(c => \r\n      String(c.slug) === String(catSlugOrName) || \r\n      String(c.name) === String(catSlugOrName) || \r\n      String(c.id) === String(catSlugOrName)\r\n    );\r\n    const toSlug = found ? (found.slug ?? found.name) : catSlugOrName;\r\n    navigate(`/category/${encodeURIComponent(toSlug)}`);\r\n    setShowFilters(false);\r\n  };\r\n\r\n  const handleClearFilters = () => {\r\n    setQuery('');\r\n    setPriceRange({ min: '', max: '' });\r\n    setSortBy('relevance');\r\n    setCurrentPage(1);\r\n    setImageResults(null); // thoát chế độ tìm bằng ảnh\r\n  };\r\n\r\n  // replace handleImageFileChange usage bằng ImageSearchUpload\r\n  if (loading) {\r\n    return (\r\n      <div className=\"category-page\">\r\n        <Loading message=\"Đang tải sản phẩm...\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"category-page\">\r\n        <div className=\"error-container\">\r\n          <div className=\"error-icon\">\r\n            <Icon name=\"triangle-exclamation\" size={28} />\r\n          </div>\r\n          <h2>Có lỗi xảy ra</h2>\r\n          <p>{error}</p>\r\n          <button onClick={() => window.location.reload()} className=\"btn btn-primary\">\r\n            Thử lại\r\n          </button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"category-page\">\r\n      <div className=\"category-container\">\r\n        {/* Header */}\r\n        <div className=\"category-header\">\r\n          <div className=\"breadcrumb\">\r\n            <a href=\"/\">Trang chủ</a>\r\n            <span className=\"breadcrumb-separator\">/</span>\r\n            <span className=\"breadcrumb-current\">\r\n              {activeCategoryObj?.name || slugFromUrl || 'Tất cả sản phẩm'}\r\n            </span>\r\n          </div>\r\n          \r\n          <h1 className=\"category-title\">\r\n            {activeCategoryObj?.name || slugFromUrl || 'Tất cả sản phẩm'}\r\n          </h1>\r\n          \r\n          <p className=\"category-subtitle\">\r\n            {effectiveFiltered.length} sản phẩm\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"category-content\">\r\n          {/* Sidebar Filters */}\r\n          <aside className={`filters-sidebar ${showFilters ? 'mobile-open' : ''}`}>\r\n            <div className=\"filters-header\">\r\n              <h3>Bộ lọc</h3>\r\n              <button \r\n                className=\"filters-close\" \r\n                onClick={() => setShowFilters(false)}\r\n                aria-label=\"Đóng bộ lọc\"\r\n              >\r\n                <Icon name=\"xmark\" size={14} />\r\n              </button>\r\n            </div>\r\n\r\n            {/* Search */}\r\n            <div className=\"filter-section\">\r\n              <label className=\"filter-label\">Tìm kiếm</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"filter-input\"\r\n                placeholder=\"Tìm sản phẩm...\"\r\n                value={query}\r\n                onChange={(e) => setQuery(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            {/* Categories */}\r\n            <div className=\"filter-section\">\r\n              <label className=\"filter-label\">Danh mục</label>\r\n              <div className=\"category-list\">\r\n                <button\r\n                  className={`category-item ${!slugFromUrl ? 'active' : ''}`}\r\n                  onClick={() => handleCategoryChange('')}\r\n                >\r\n                  Tất cả\r\n                </button>\r\n                {categories.map((cat) => (\r\n                  <button\r\n                    key={cat.id}\r\n                    className={`category-item ${\r\n                      activeCategoryObj?.id === cat.id ? 'active' : ''\r\n                    }`}\r\n                    onClick={() => handleCategoryChange(cat.slug || cat.name)}\r\n                  >\r\n                    {cat.name}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Price Range */}\r\n            <div className=\"filter-section\">\r\n              <label className=\"filter-label\">Khoảng giá</label>\r\n              <div className=\"price-range-inputs\">\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"filter-input\"\r\n                  placeholder=\"Từ\"\r\n                  value={priceRange.min}\r\n                  onChange={(e) => setPriceRange(prev => ({ ...prev, min: e.target.value }))}\r\n                />\r\n                <span className=\"price-separator\">-</span>\r\n                <input\r\n                  type=\"number\"\r\n                  className=\"filter-input\"\r\n                  placeholder=\"Đến\"\r\n                  value={priceRange.max}\r\n                  onChange={(e) => setPriceRange(prev => ({ ...prev, max: e.target.value }))}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* Sort */}\r\n            <div className=\"filter-section\">\r\n              <label className=\"filter-label\">Sắp xếp</label>\r\n              <select\r\n                className=\"filter-select\"\r\n                value={sortBy}\r\n                onChange={(e) => setSortBy(e.target.value)}\r\n              >\r\n                <option value=\"relevance\">Liên quan</option>\r\n                <option value=\"price-low\">Giá: Thấp đến cao</option>\r\n                <option value=\"price-high\">Giá: Cao đến thấp</option>\r\n                <option value=\"name\">Tên: A-Z</option>\r\n                <option value=\"newest\">Mới nhất</option>\r\n              </select>\r\n            </div>\r\n\r\n            {/* Clear Filters */}\r\n            <button className=\"btn-clear-filters\" onClick={handleClearFilters}>\r\n              Xóa bộ lọc\r\n            </button>\r\n          </aside>\r\n\r\n          {/* Products Section */}\r\n          <div className=\"products-section\">\r\n            {/* Toolbar */}\r\n            <div className=\"products-toolbar\">\r\n              <button\r\n                className=\"btn-toggle-filters\"\r\n                onClick={() => setShowFilters(!showFilters)}\r\n              >\r\n                <Icon name=\"filter\" size={14} />\r\n                <span>Bộ lọc</span>\r\n              </button>\r\n\r\n              <ImageSearchUpload\r\n                k={48}\r\n                onStart={() => setLoading(true)}\r\n                onFinish={() => setLoading(false)}\r\n                onResults={(mapped) => {\r\n                  setImageResults(mapped);\r\n                  setCurrentPage(1);\r\n                  setShowFilters(false);\r\n                }}\r\n                onError={(msg) => setError(msg)}\r\n              />\r\n\r\n              {imageResults && (\r\n                <button className=\"btn\" style={{ marginLeft: 8 }} onClick={() => setImageResults(null)}>\r\n                  Hủy kết quả ảnh\r\n                </button>\r\n              )}\r\n\r\n              <div className=\"results-info\">\r\n                Hiển thị {paginatedProducts.length} / {effectiveFiltered.length} sản phẩm\r\n                {imageResults && <span style={{ marginLeft: 8, color: '#888' }}>(kết quả từ ảnh)</span>}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Products Grid */}\r\n            {effectiveFiltered.length === 0 ? (\r\n              <div className=\"empty-state\">\r\n                <div className=\"empty-icon\">\r\n                  <Icon name=\"box-open\" size={32} />\r\n                </div>\r\n                <h2>Không tìm thấy sản phẩm</h2>\r\n                <p>Vui lòng thử điều chỉnh bộ lọc hoặc tìm kiếm khác</p>\r\n                <button className=\"btn btn-primary\" onClick={handleClearFilters}>\r\n                  Xóa bộ lọc\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <>\r\n                <ProductGrid products={paginatedProducts} />\r\n\r\n                {/* Pagination */}\r\n                {totalPages > 1 && (\r\n                  <div className=\"pagination\">\r\n                    <button\r\n                      className=\"pagination-btn\"\r\n                      onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                      disabled={currentPage === 1}\r\n                    >\r\n                      <Icon name=\"angle-left\" size={12} />\r\n                      <span>Trước</span>\r\n                    </button>\r\n                    \r\n                    <div className=\"pagination-pages\">\r\n                      {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (\r\n                        <button\r\n                          key={page}\r\n                          className={`pagination-page ${currentPage === page ? 'active' : ''}`}\r\n                          onClick={() => setCurrentPage(page)}\r\n                        >\r\n                          {page}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n\r\n                    <button\r\n                      className=\"pagination-btn\"\r\n                      onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                      disabled={currentPage === totalPages}\r\n                    >\r\n                      <span>Sau</span>\r\n                      <Icon name=\"angle-right\" size={12} />\r\n                    </button>\r\n                  </div>\r\n                )}\r\n              </>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Mobile Overlay */}\r\n      {showFilters && (\r\n        <div \r\n          className=\"filters-overlay-backdrop\"\r\n          onClick={() => setShowFilters(false)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"+GAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,OAAO,KAAQ,OAAO,CAC3D,OAASC,SAAS,CAAEC,WAAW,KAAQ,kBAAkB,CACzD,MAAO,CAAAC,WAAW,KAAM,2BAA2B,CACnD,MAAO,CAAAC,iBAAiB,KAAM,iCAAiC,CAC/D,MAAO,CAAAC,OAAO,KAAM,uBAAuB,CAC3C,MAAO,4BAA4B,CACnC,MAAO,CAAAC,IAAI,KAAM,oBAAoB,CACrC,MAAO,CAAAC,YAAY,KAAM,uBAAuB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEjD,cAAe,SAAS,CAAAC,YAAYA,CAAA,CAAG,KAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CACrC,KAAM,CAAAC,MAAM,CAAGjB,SAAS,CAAC,CAAC,CAC1B,KAAM,CAAAkB,gBAAgB,EAAAJ,IAAA,EAAAC,KAAA,EAAAC,YAAA,CAAGC,MAAM,CAACE,IAAI,UAAAH,YAAA,UAAAA,YAAA,CAAIC,MAAM,CAACG,YAAY,UAAAL,KAAA,UAAAA,KAAA,CAAIE,MAAM,CAACI,QAAQ,UAAAP,IAAA,UAAAA,IAAA,CAAI,EAAE,CACpF,KAAM,CAAAQ,WAAW,CAAGJ,gBAAgB,CAAGK,kBAAkB,CAACL,gBAAgB,CAAC,CAAG,EAAE,CAChF,KAAM,CAAAM,QAAQ,CAAGvB,WAAW,CAAC,CAAC,CAE9B;AACA,KAAM,CAACwB,UAAU,CAAEC,aAAa,CAAC,CAAG7B,QAAQ,CAAC,EAAE,CAAC,CAChD,KAAM,CAAC8B,QAAQ,CAAEC,WAAW,CAAC,CAAG/B,QAAQ,CAAC,EAAE,CAAC,CAE5C;AACA,KAAM,CAACgC,KAAK,CAAEC,QAAQ,CAAC,CAAGjC,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACkC,UAAU,CAAEC,aAAa,CAAC,CAAGnC,QAAQ,CAAC,CAAEoC,GAAG,CAAE,EAAE,CAAEC,GAAG,CAAE,EAAG,CAAC,CAAC,CAClE,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGvC,QAAQ,CAAC,WAAW,CAAC,CACjD,KAAM,CAACwC,WAAW,CAAEC,cAAc,CAAC,CAAGzC,QAAQ,CAAC,CAAC,CAAC,CACjD,KAAM,CAAC0C,OAAO,CAAEC,UAAU,CAAC,CAAG3C,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAAC4C,KAAK,CAAEC,QAAQ,CAAC,CAAG7C,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAAC8C,WAAW,CAAEC,cAAc,CAAC,CAAG/C,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAACgD,YAAY,CAAEC,eAAe,CAAC,CAAGjD,QAAQ,CAAC,IAAI,CAAC,CAAE;AAExDC,SAAS,CAAC,IAAM,CACd,GAAI,CAAAiD,SAAS,CAAG,KAAK,CACrB,cAAe,CAAAC,IAAIA,CAAA,CAAG,CACpBR,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,IAAI,CAAC,CACd,GAAI,KAAAO,aAAA,CAAAC,aAAA,CACF,KAAM,CAACC,IAAI,CAAEC,IAAI,CAAC,CAAG,KAAM,CAAAC,OAAO,CAACC,GAAG,CAAC,CACrCC,KAAK,CAAC,uCAAuC,CAAC,CAACC,IAAI,CAACC,CAAC,EAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CAClEH,KAAK,CAAC,qCAAqC,CAAC,CAACC,IAAI,CAACC,CAAC,EAAIA,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC,CACjE,CAAC,CACF,GAAIX,SAAS,CAAE,OAEf,KAAM,CAAAY,IAAI,CAAGC,KAAK,CAACC,OAAO,CAACV,IAAI,CAAC,CAAGA,IAAI,EAAAF,aAAA,CAAIE,IAAI,CAACW,OAAO,UAAAb,aAAA,UAAAA,aAAA,CAAI,EAAG,CAC9D,KAAM,CAAAc,KAAK,CAAGH,KAAK,CAACC,OAAO,CAACT,IAAI,CAAC,CAAGA,IAAI,EAAAF,aAAA,CAAIE,IAAI,CAACU,OAAO,UAAAZ,aAAA,UAAAA,aAAA,CAAI,EAAG,CAE/DxB,aAAa,CAACiC,IAAI,CAAC,CACnB/B,WAAW,CAACmC,KAAK,CAAC,CACpB,CAAE,MAAOC,GAAG,CAAE,CACZ,GAAIjB,SAAS,CAAE,OACfkB,OAAO,CAACxB,KAAK,CAAC,yBAAyB,CAAEuB,GAAG,CAAC,CAC7CtB,QAAQ,CAAC,8CAA8C,CAAC,CAC1D,CAAC,OAAS,CACR,GAAI,CAACK,SAAS,CAAEP,UAAU,CAAC,KAAK,CAAC,CACnC,CACF,CACAQ,IAAI,CAAC,CAAC,CACN,MAAO,IAAM,CAAED,SAAS,CAAG,IAAI,CAAE,CAAC,CACpC,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAmB,iBAAiB,CAAGnE,OAAO,CAAC,IAAM,KAAAoE,gBAAA,CACtC,GAAI,CAAC7C,WAAW,CAAE,MAAO,KAAI,CAC7B,OAAA6C,gBAAA,CAAO1C,UAAU,CAAC2C,IAAI,CAACC,CAAC,EAAI,KAAAC,OAAA,CAAAC,OAAA,CAAAC,KAAA,CAC1B,KAAM,CAAArD,IAAI,CAAGsD,MAAM,EAAAH,OAAA,CAACD,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAElD,IAAI,UAAAmD,OAAA,UAAAA,OAAA,CAAI,EAAE,CAAC,CAACI,WAAW,CAAC,CAAC,CAChD,KAAM,CAAAC,IAAI,CAAGF,MAAM,EAAAF,OAAA,CAACF,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEM,IAAI,UAAAJ,OAAA,UAAAA,OAAA,CAAI,EAAE,CAAC,CAACG,WAAW,CAAC,CAAC,CAChD,KAAM,CAAAE,EAAE,CAAGH,MAAM,EAAAD,KAAA,CAACH,CAAC,SAADA,CAAC,iBAADA,CAAC,CAAEO,EAAE,UAAAJ,KAAA,UAAAA,KAAA,CAAI,EAAE,CAAC,CAACE,WAAW,CAAC,CAAC,CAC5C,KAAM,CAAAG,KAAK,CAAGJ,MAAM,CAACvD,gBAAgB,SAAhBA,gBAAgB,UAAhBA,gBAAgB,CAAI,EAAE,CAAC,CAACwD,WAAW,CAAC,CAAC,CAC1D,MAAO,CAAAvD,IAAI,GAAK0D,KAAK,EAAIF,IAAI,GAAKE,KAAK,EAAID,EAAE,GAAKC,KAAK,CACzD,CAAC,CAAC,UAAAV,gBAAA,UAAAA,gBAAA,CAAI,IAAI,CACZ,CAAC,CAAE,CAAC1C,UAAU,CAAEP,gBAAgB,CAAEI,WAAW,CAAC,CAAC,CAE/C,KAAM,CAAAwD,SAAS,CAAG,CAAAZ,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAES,IAAI,GAAIrD,WAAW,EAAI,mBAAmB,CAC/EhB,YAAY,CAACwE,SAAS,CAAC,CAEvB;AACA,QAAS,CAAAC,sBAAsBA,CAACC,IAAI,CAAEC,UAAU,CAAE,KAAAC,KAAA,CAAAC,MAAA,CAAAC,KAAA,CAAAC,QAAA,CAAAC,QAAA,CAChD,GAAI,CAACL,UAAU,CAAE,MAAO,KAAI,CAC5B,KAAM,CAAAM,MAAM,CAAGd,MAAM,CAACQ,UAAU,CAAC,CAACP,WAAW,CAAC,CAAC,CAC/C,KAAM,CAAAc,EAAE,CAAGR,IAAI,CAAC3D,QAAQ,CACxB,GAAImE,EAAE,EAAI,IAAI,CAAE,MAAO,MAAK,CAE5B,GAAI,MAAO,CAAAA,EAAE,GAAK,QAAQ,EAAI,MAAO,CAAAA,EAAE,GAAK,QAAQ,CAAE,CACpD,KAAM,CAAAC,CAAC,CAAGhB,MAAM,CAACe,EAAE,CAAC,CAACd,WAAW,CAAC,CAAC,CAClC,MAAO,CAAAe,CAAC,GAAKF,MAAM,EAAIE,CAAC,CAACC,QAAQ,CAACH,MAAM,CAAC,EAAIA,MAAM,CAACG,QAAQ,CAACD,CAAC,CAAC,CACjE,CAEA,KAAM,CAAAE,GAAG,CAAGlB,MAAM,EAAAS,KAAA,EAAAC,MAAA,CAACK,EAAE,CAACZ,EAAE,UAAAO,MAAA,UAAAA,MAAA,CAAIK,EAAE,CAACI,EAAE,UAAAV,KAAA,UAAAA,KAAA,CAAI,EAAE,CAAC,CAACR,WAAW,CAAC,CAAC,CACtD,KAAM,CAAAmB,KAAK,CAAGpB,MAAM,EAAAW,KAAA,EAAAC,QAAA,CAACG,EAAE,CAACb,IAAI,UAAAU,QAAA,UAAAA,QAAA,CAAIG,EAAE,CAACM,KAAK,UAAAV,KAAA,UAAAA,KAAA,CAAI,EAAE,CAAC,CAACV,WAAW,CAAC,CAAC,CAC7D,KAAM,CAAAqB,KAAK,CAAGtB,MAAM,EAAAa,QAAA,CAACE,EAAE,CAACrE,IAAI,UAAAmE,QAAA,UAAAA,QAAA,CAAI,EAAE,CAAC,CAACZ,WAAW,CAAC,CAAC,CAEjD,MAAO,CAAAiB,GAAG,GAAKJ,MAAM,EAAIM,KAAK,GAAKN,MAAM,EAAIQ,KAAK,GAAKR,MAAM,EACtDM,KAAK,CAACH,QAAQ,CAACH,MAAM,CAAC,EAAIQ,KAAK,CAACL,QAAQ,CAACH,MAAM,CAAC,CACzD,CAEA;AACA,KAAM,CAAAS,gBAAgB,CAAGjG,OAAO,CAAC,IAAM,KAAAkG,KAAA,CAAAC,qBAAA,CACrC,KAAM,CAAAC,gBAAgB,CAAGjC,iBAAiB,EAAA+B,KAAA,EAAAC,qBAAA,CACrChC,iBAAiB,CAAC/C,IAAI,UAAA+E,qBAAA,UAAAA,qBAAA,CAAIhC,iBAAiB,CAACS,IAAI,UAAAsB,KAAA,UAAAA,KAAA,CAAIxB,MAAM,CAACP,iBAAiB,CAACU,EAAE,CAAC,CAChFtD,WAAW,EAAI,EAAG,CACvB,KAAM,CAAA8E,CAAC,CAAG,CAACvE,KAAK,EAAI,EAAE,EAAEwE,IAAI,CAAC,CAAC,CAAC3B,WAAW,CAAC,CAAC,CAE5C,KAAM,CAAA4B,IAAI,CAAG,CAAC3E,QAAQ,EAAI,EAAE,EAAE4E,MAAM,CAACC,OAAO,EAAI,KAAAC,cAAA,CAC9C,GAAIN,gBAAgB,EAAI,CAACpB,sBAAsB,CAACyB,OAAO,CAAEL,gBAAgB,CAAC,CAAE,MAAO,MAAK,CAExF,GAAIC,CAAC,CAAE,KAAAM,aAAA,CAAAC,oBAAA,CACL,KAAM,CAAAhC,IAAI,CAAGF,MAAM,EAAAiC,aAAA,CAACF,OAAO,CAAC7B,IAAI,UAAA+B,aAAA,UAAAA,aAAA,CAAI,EAAE,CAAC,CAAChC,WAAW,CAAC,CAAC,CACrD,KAAM,CAAAkC,IAAI,CAAGnC,MAAM,EAAAkC,oBAAA,CAACH,OAAO,CAACK,WAAW,UAAAF,oBAAA,UAAAA,oBAAA,CAAI,EAAE,CAAC,CAACjC,WAAW,CAAC,CAAC,CAC5D,GAAI,CAACC,IAAI,CAACe,QAAQ,CAACU,CAAC,CAAC,EAAI,CAACQ,IAAI,CAAClB,QAAQ,CAACU,CAAC,CAAC,CAAE,MAAO,MAAK,CAC1D,CAEA,KAAM,CAAAU,KAAK,CAAGC,MAAM,EAAAN,cAAA,CAACD,OAAO,CAACM,KAAK,UAAAL,cAAA,UAAAA,cAAA,CAAI,CAAC,CAAC,CACxC,GAAI1E,UAAU,CAACE,GAAG,EAAI6E,KAAK,CAAGC,MAAM,CAAChF,UAAU,CAACE,GAAG,CAAC,CAAE,MAAO,MAAK,CAClE,GAAIF,UAAU,CAACG,GAAG,EAAI4E,KAAK,CAAGC,MAAM,CAAChF,UAAU,CAACG,GAAG,CAAC,CAAE,MAAO,MAAK,CAElE,MAAO,KAAI,CACb,CAAC,CAAC,CAEF,OAAQC,MAAM,EACZ,IAAK,WAAW,CACdmE,IAAI,CAACU,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CAACH,MAAM,CAACE,CAAC,CAACH,KAAK,CAAC,EAAI,CAAC,GAAKC,MAAM,CAACG,CAAC,CAACJ,KAAK,CAAC,EAAI,CAAC,CAAC,CAAC,CACpE,MACF,IAAK,YAAY,CACfR,IAAI,CAACU,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CAACH,MAAM,CAACG,CAAC,CAACJ,KAAK,CAAC,EAAI,CAAC,GAAKC,MAAM,CAACE,CAAC,CAACH,KAAK,CAAC,EAAI,CAAC,CAAC,CAAC,CACpE,MACF,IAAK,MAAM,CACTR,IAAI,CAACU,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAKzC,MAAM,CAACwC,CAAC,CAACtC,IAAI,CAAC,CAACwC,aAAa,CAAC1C,MAAM,CAACyC,CAAC,CAACvC,IAAI,CAAC,CAAC,CAAC,CACjE,MACF,IAAK,QAAQ,CACX2B,IAAI,CAACU,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CAACA,CAAC,CAACtC,EAAE,EAAI,CAAC,GAAKqC,CAAC,CAACrC,EAAE,EAAI,CAAC,CAAC,CAAC,CAC9C,MACF,QACE,MACJ,CAEA,MAAO,CAAA0B,IAAI,CACb,CAAC,CAAE,CAAC3E,QAAQ,CAAEuC,iBAAiB,CAAE5C,WAAW,CAAEO,KAAK,CAAEE,UAAU,CAAEI,MAAM,CAAC,CAAC,CAEzE;AACA,KAAM,CAAAiF,iBAAiB,CAAGrH,OAAO,CAAC,IAAM,CACtC,GAAI8C,YAAY,CAAE,MAAO,CAAAA,YAAY,CACrC,MAAO,CAAAmD,gBAAgB,CACzB,CAAC,CAAE,CAACnD,YAAY,CAAEmD,gBAAgB,CAAC,CAAC,CAEpC,KAAM,CAAAqB,cAAc,CAAG,EAAE,CACzB,KAAM,CAAAC,UAAU,CAAGC,IAAI,CAACrF,GAAG,CAAC,CAAC,CAAEqF,IAAI,CAACC,IAAI,CAACJ,iBAAiB,CAACK,MAAM,CAAGJ,cAAc,CAAC,CAAC,CAEpFvH,SAAS,CAAC,IAAM,CACd,GAAIuC,WAAW,CAAGiF,UAAU,CAAEhF,cAAc,CAACgF,UAAU,CAAC,CAC1D,CAAC,CAAE,CAACjF,WAAW,CAAEiF,UAAU,CAAC,CAAC,CAE7B,KAAM,CAAAI,iBAAiB,CAAG3H,OAAO,CAAC,IAAM,CACtC,KAAM,CAAA4H,KAAK,CAAG,CAACtF,WAAW,CAAG,CAAC,EAAIgF,cAAc,CAChD,MAAO,CAAAD,iBAAiB,CAACQ,KAAK,CAACD,KAAK,CAAEA,KAAK,CAAGN,cAAc,CAAC,CAC/D,CAAC,CAAE,CAACD,iBAAiB,CAAE/E,WAAW,CAAC,CAAC,CAEpC;AACA,KAAM,CAAAwF,oBAAoB,CAAIC,aAAa,EAAK,KAAAC,WAAA,CAC9C,GAAI,CAACD,aAAa,CAAE,CAClBtG,QAAQ,CAAC,WAAW,CAAC,CACrB,OACF,CACA,KAAM,CAAAwG,KAAK,CAAGvG,UAAU,CAAC2C,IAAI,CAACC,CAAC,EAC7BI,MAAM,CAACJ,CAAC,CAAClD,IAAI,CAAC,GAAKsD,MAAM,CAACqD,aAAa,CAAC,EACxCrD,MAAM,CAACJ,CAAC,CAACM,IAAI,CAAC,GAAKF,MAAM,CAACqD,aAAa,CAAC,EACxCrD,MAAM,CAACJ,CAAC,CAACO,EAAE,CAAC,GAAKH,MAAM,CAACqD,aAAa,CACvC,CAAC,CACD,KAAM,CAAAG,MAAM,CAAGD,KAAK,EAAAD,WAAA,CAAIC,KAAK,CAAC7G,IAAI,UAAA4G,WAAA,UAAAA,WAAA,CAAIC,KAAK,CAACrD,IAAI,CAAImD,aAAa,CACjEtG,QAAQ,cAAA0G,MAAA,CAAcC,kBAAkB,CAACF,MAAM,CAAC,CAAE,CAAC,CACnDrF,cAAc,CAAC,KAAK,CAAC,CACvB,CAAC,CAED,KAAM,CAAAwF,kBAAkB,CAAGA,CAAA,GAAM,CAC/BtG,QAAQ,CAAC,EAAE,CAAC,CACZE,aAAa,CAAC,CAAEC,GAAG,CAAE,EAAE,CAAEC,GAAG,CAAE,EAAG,CAAC,CAAC,CACnCE,SAAS,CAAC,WAAW,CAAC,CACtBE,cAAc,CAAC,CAAC,CAAC,CACjBQ,eAAe,CAAC,IAAI,CAAC,CAAE;AACzB,CAAC,CAED;AACA,GAAIP,OAAO,CAAE,CACX,mBACE/B,IAAA,QAAK6H,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B9H,IAAA,CAACJ,OAAO,EAACmI,OAAO,CAAC,0CAAsB,CAAE,CAAC,CACvC,CAAC,CAEV,CAEA,GAAI9F,KAAK,CAAE,CACT,mBACEjC,IAAA,QAAK6H,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B5H,KAAA,QAAK2H,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9B9H,IAAA,QAAK6H,SAAS,CAAC,YAAY,CAAAC,QAAA,cACzB9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,sBAAsB,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,CAC3C,CAAC,cACNhI,IAAA,OAAA8H,QAAA,CAAI,4BAAa,CAAI,CAAC,cACtB9H,IAAA,MAAA8H,QAAA,CAAI7F,KAAK,CAAI,CAAC,cACdjC,IAAA,WAAQiI,OAAO,CAAEA,CAAA,GAAMC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAE,CAACP,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAC,mBAE7E,CAAQ,CAAC,EACN,CAAC,CACH,CAAC,CAEV,CAEA,mBACE5H,KAAA,QAAK2H,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5B5H,KAAA,QAAK2H,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eAEjC5H,KAAA,QAAK2H,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9B5H,KAAA,QAAK2H,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB9H,IAAA,MAAGqI,IAAI,CAAC,GAAG,CAAAP,QAAA,CAAC,gBAAS,CAAG,CAAC,cACzB9H,IAAA,SAAM6H,SAAS,CAAC,sBAAsB,CAAAC,QAAA,CAAC,GAAC,CAAM,CAAC,cAC/C9H,IAAA,SAAM6H,SAAS,CAAC,oBAAoB,CAAAC,QAAA,CACjC,CAAApE,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAES,IAAI,GAAIrD,WAAW,EAAI,iBAAiB,CACxD,CAAC,EACJ,CAAC,cAENd,IAAA,OAAI6H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,CAC3B,CAAApE,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAES,IAAI,GAAIrD,WAAW,EAAI,iBAAiB,CAC1D,CAAC,cAELZ,KAAA,MAAG2H,SAAS,CAAC,mBAAmB,CAAAC,QAAA,EAC7BlB,iBAAiB,CAACK,MAAM,CAAC,qBAC5B,EAAG,CAAC,EACD,CAAC,cAEN/G,KAAA,QAAK2H,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAE/B5H,KAAA,UAAO2H,SAAS,oBAAAH,MAAA,CAAqBvF,WAAW,CAAG,aAAa,CAAG,EAAE,CAAG,CAAA2F,QAAA,eACtE5H,KAAA,QAAK2H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9H,IAAA,OAAA8H,QAAA,CAAI,kBAAM,CAAI,CAAC,cACf9H,IAAA,WACE6H,SAAS,CAAC,eAAe,CACzBI,OAAO,CAAEA,CAAA,GAAM7F,cAAc,CAAC,KAAK,CAAE,CACrC,aAAW,+BAAa,CAAA0F,QAAA,cAExB9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,OAAO,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,CACzB,CAAC,EACN,CAAC,cAGN9H,KAAA,QAAK2H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9H,IAAA,UAAO6H,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,kBAAQ,CAAO,CAAC,cAChD9H,IAAA,UACEsI,IAAI,CAAC,MAAM,CACXT,SAAS,CAAC,cAAc,CACxBU,WAAW,CAAC,8BAAiB,CAC7BC,KAAK,CAAEnH,KAAM,CACboH,QAAQ,CAAGC,CAAC,EAAKpH,QAAQ,CAACoH,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAC3C,CAAC,EACC,CAAC,cAGNtI,KAAA,QAAK2H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9H,IAAA,UAAO6H,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,eAAQ,CAAO,CAAC,cAChD5H,KAAA,QAAK2H,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5B9H,IAAA,WACE6H,SAAS,kBAAAH,MAAA,CAAmB,CAAC5G,WAAW,CAAG,QAAQ,CAAG,EAAE,CAAG,CAC3DmH,OAAO,CAAEA,CAAA,GAAMZ,oBAAoB,CAAC,EAAE,CAAE,CAAAS,QAAA,CACzC,kBAED,CAAQ,CAAC,CACR7G,UAAU,CAAC2H,GAAG,CAAEC,GAAG,eAClB7I,IAAA,WAEE6H,SAAS,kBAAAH,MAAA,CACP,CAAAhE,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEU,EAAE,IAAKyE,GAAG,CAACzE,EAAE,CAAG,QAAQ,CAAG,EAAE,CAC/C,CACH6D,OAAO,CAAEA,CAAA,GAAMZ,oBAAoB,CAACwB,GAAG,CAAClI,IAAI,EAAIkI,GAAG,CAAC1E,IAAI,CAAE,CAAA2D,QAAA,CAEzDe,GAAG,CAAC1E,IAAI,EANJ0E,GAAG,CAACzE,EAOH,CACT,CAAC,EACC,CAAC,EACH,CAAC,cAGNlE,KAAA,QAAK2H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9H,IAAA,UAAO6H,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,oBAAU,CAAO,CAAC,cAClD5H,KAAA,QAAK2H,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eACjC9H,IAAA,UACEsI,IAAI,CAAC,QAAQ,CACbT,SAAS,CAAC,cAAc,CACxBU,WAAW,CAAC,SAAI,CAChBC,KAAK,CAAEjH,UAAU,CAACE,GAAI,CACtBgH,QAAQ,CAAGC,CAAC,EAAKlH,aAAa,CAACsH,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAErH,GAAG,CAAEiH,CAAC,CAACC,MAAM,CAACH,KAAK,EAAG,CAAE,CAC5E,CAAC,cACFxI,IAAA,SAAM6H,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAC,GAAC,CAAM,CAAC,cAC1C9H,IAAA,UACEsI,IAAI,CAAC,QAAQ,CACbT,SAAS,CAAC,cAAc,CACxBU,WAAW,CAAC,eAAK,CACjBC,KAAK,CAAEjH,UAAU,CAACG,GAAI,CACtB+G,QAAQ,CAAGC,CAAC,EAAKlH,aAAa,CAACsH,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAEpH,GAAG,CAAEgH,CAAC,CAACC,MAAM,CAACH,KAAK,EAAG,CAAE,CAC5E,CAAC,EACC,CAAC,EACH,CAAC,cAGNtI,KAAA,QAAK2H,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9H,IAAA,UAAO6H,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,mBAAO,CAAO,CAAC,cAC/C5H,KAAA,WACE2H,SAAS,CAAC,eAAe,CACzBW,KAAK,CAAE7G,MAAO,CACd8G,QAAQ,CAAGC,CAAC,EAAK9G,SAAS,CAAC8G,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE,CAAAV,QAAA,eAE3C9H,IAAA,WAAQwI,KAAK,CAAC,WAAW,CAAAV,QAAA,CAAC,cAAS,CAAQ,CAAC,cAC5C9H,IAAA,WAAQwI,KAAK,CAAC,WAAW,CAAAV,QAAA,CAAC,qCAAiB,CAAQ,CAAC,cACpD9H,IAAA,WAAQwI,KAAK,CAAC,YAAY,CAAAV,QAAA,CAAC,qCAAiB,CAAQ,CAAC,cACrD9H,IAAA,WAAQwI,KAAK,CAAC,MAAM,CAAAV,QAAA,CAAC,aAAQ,CAAQ,CAAC,cACtC9H,IAAA,WAAQwI,KAAK,CAAC,QAAQ,CAAAV,QAAA,CAAC,oBAAQ,CAAQ,CAAC,EAClC,CAAC,EACN,CAAC,cAGN9H,IAAA,WAAQ6H,SAAS,CAAC,mBAAmB,CAACI,OAAO,CAAEL,kBAAmB,CAAAE,QAAA,CAAC,yBAEnE,CAAQ,CAAC,EACJ,CAAC,cAGR5H,KAAA,QAAK2H,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAE/B5H,KAAA,QAAK2H,SAAS,CAAC,kBAAkB,CAAAC,QAAA,eAC/B5H,KAAA,WACE2H,SAAS,CAAC,oBAAoB,CAC9BI,OAAO,CAAEA,CAAA,GAAM7F,cAAc,CAAC,CAACD,WAAW,CAAE,CAAA2F,QAAA,eAE5C9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,QAAQ,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,cAChChI,IAAA,SAAA8H,QAAA,CAAM,kBAAM,CAAM,CAAC,EACb,CAAC,cAET9H,IAAA,CAACL,iBAAiB,EAChBqJ,CAAC,CAAE,EAAG,CACNC,OAAO,CAAEA,CAAA,GAAMjH,UAAU,CAAC,IAAI,CAAE,CAChCkH,QAAQ,CAAEA,CAAA,GAAMlH,UAAU,CAAC,KAAK,CAAE,CAClCmH,SAAS,CAAGC,MAAM,EAAK,CACrB9G,eAAe,CAAC8G,MAAM,CAAC,CACvBtH,cAAc,CAAC,CAAC,CAAC,CACjBM,cAAc,CAAC,KAAK,CAAC,CACvB,CAAE,CACFiH,OAAO,CAAGC,GAAG,EAAKpH,QAAQ,CAACoH,GAAG,CAAE,CACjC,CAAC,CAEDjH,YAAY,eACXrC,IAAA,WAAQ6H,SAAS,CAAC,KAAK,CAAC0B,KAAK,CAAE,CAAEC,UAAU,CAAE,CAAE,CAAE,CAACvB,OAAO,CAAEA,CAAA,GAAM3F,eAAe,CAAC,IAAI,CAAE,CAAAwF,QAAA,CAAC,qCAExF,CAAQ,CACT,cAED5H,KAAA,QAAK2H,SAAS,CAAC,cAAc,CAAAC,QAAA,EAAC,qBACnB,CAACZ,iBAAiB,CAACD,MAAM,CAAC,KAAG,CAACL,iBAAiB,CAACK,MAAM,CAAC,qBAChE,CAAC5E,YAAY,eAAIrC,IAAA,SAAMuJ,KAAK,CAAE,CAAEC,UAAU,CAAE,CAAC,CAAEC,KAAK,CAAE,MAAO,CAAE,CAAA3B,QAAA,CAAC,sCAAgB,CAAM,CAAC,EACpF,CAAC,EACH,CAAC,CAGLlB,iBAAiB,CAACK,MAAM,GAAK,CAAC,cAC7B/G,KAAA,QAAK2H,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC1B9H,IAAA,QAAK6H,SAAS,CAAC,YAAY,CAAAC,QAAA,cACzB9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,UAAU,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,CAC/B,CAAC,cACNhI,IAAA,OAAA8H,QAAA,CAAI,8CAAuB,CAAI,CAAC,cAChC9H,IAAA,MAAA8H,QAAA,CAAG,oGAAiD,CAAG,CAAC,cACxD9H,IAAA,WAAQ6H,SAAS,CAAC,iBAAiB,CAACI,OAAO,CAAEL,kBAAmB,CAAAE,QAAA,CAAC,yBAEjE,CAAQ,CAAC,EACN,CAAC,cAEN5H,KAAA,CAAAE,SAAA,EAAA0H,QAAA,eACE9H,IAAA,CAACN,WAAW,EAACyB,QAAQ,CAAE+F,iBAAkB,CAAE,CAAC,CAG3CJ,UAAU,CAAG,CAAC,eACb5G,KAAA,QAAK2H,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB5H,KAAA,WACE2H,SAAS,CAAC,gBAAgB,CAC1BI,OAAO,CAAEA,CAAA,GAAMnG,cAAc,CAAC4H,CAAC,EAAI3C,IAAI,CAACrF,GAAG,CAAC,CAAC,CAAEgI,CAAC,CAAG,CAAC,CAAC,CAAE,CACvDC,QAAQ,CAAE9H,WAAW,GAAK,CAAE,CAAAiG,QAAA,eAE5B9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,YAAY,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,cACpChI,IAAA,SAAA8H,QAAA,CAAM,iBAAK,CAAM,CAAC,EACZ,CAAC,cAET9H,IAAA,QAAK6H,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAC9B1E,KAAK,CAACwG,IAAI,CAAC,CAAE3C,MAAM,CAAEH,UAAW,CAAC,CAAE,CAAC+C,CAAC,CAAEC,CAAC,GAAKA,CAAC,CAAG,CAAC,CAAC,CAAClB,GAAG,CAACmB,IAAI,eAC3D/J,IAAA,WAEE6H,SAAS,oBAAAH,MAAA,CAAqB7F,WAAW,GAAKkI,IAAI,CAAG,QAAQ,CAAG,EAAE,CAAG,CACrE9B,OAAO,CAAEA,CAAA,GAAMnG,cAAc,CAACiI,IAAI,CAAE,CAAAjC,QAAA,CAEnCiC,IAAI,EAJAA,IAKC,CACT,CAAC,CACC,CAAC,cAEN7J,KAAA,WACE2H,SAAS,CAAC,gBAAgB,CAC1BI,OAAO,CAAEA,CAAA,GAAMnG,cAAc,CAAC4H,CAAC,EAAI3C,IAAI,CAACtF,GAAG,CAACqF,UAAU,CAAE4C,CAAC,CAAG,CAAC,CAAC,CAAE,CAChEC,QAAQ,CAAE9H,WAAW,GAAKiF,UAAW,CAAAgB,QAAA,eAErC9H,IAAA,SAAA8H,QAAA,CAAM,KAAG,CAAM,CAAC,cAChB9H,IAAA,CAACH,IAAI,EAACsE,IAAI,CAAC,aAAa,CAAC6D,IAAI,CAAE,EAAG,CAAE,CAAC,EAC/B,CAAC,EACN,CACN,EACD,CACH,EACE,CAAC,EACH,CAAC,EACH,CAAC,CAGL7F,WAAW,eACVnC,IAAA,QACE6H,SAAS,CAAC,0BAA0B,CACpCI,OAAO,CAAEA,CAAA,GAAM7F,cAAc,CAAC,KAAK,CAAE,CACtC,CACF,EACE,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}