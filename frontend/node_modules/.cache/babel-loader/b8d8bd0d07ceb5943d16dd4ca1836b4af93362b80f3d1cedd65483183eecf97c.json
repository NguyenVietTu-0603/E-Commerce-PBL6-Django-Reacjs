{"ast":null,"code":"const API = process.env.REACT_APP_API_URL || '';\nfunction getAuthHeader() {\n  const token = localStorage.getItem('access_token');\n  return token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n}\nasync function parseJson(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nexport async function login(username, password) {\n  const res = await fetch(`${API}/api/auth/login/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  // store token(s) & user if provided\n  if (data.access) localStorage.setItem('access_token', data.access);\n  if (data.refresh) localStorage.setItem('refresh_token', data.refresh);\n  if (data.token) localStorage.setItem('access_token', data.token);\n  if (data.user) localStorage.setItem('user', JSON.stringify(data.user));\n  return data;\n}\nexport async function register(payload) {\n  const res = await fetch(`${API}/api/auth/register/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  if (data.access) localStorage.setItem('access_token', data.access);\n  if (data.refresh) localStorage.setItem('refresh_token', data.refresh);\n  if (data.user) localStorage.setItem('user', JSON.stringify(data.user));\n  return data;\n}\nexport async function logout() {\n  try {\n    await fetch(`${API}/api/auth/logout/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeader()\n      }\n    });\n  } catch (e) {/* ignore network errors */}\n  localStorage.removeItem('access_token');\n  localStorage.removeItem('refresh_token');\n  localStorage.removeItem('user');\n}\nexport async function getCurrentUser() {\n  var _data$user;\n  const res = await fetch(`${API}/api/users/me/`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      ...getAuthHeader()\n    }\n  });\n  if (res.status === 401 || res.status === 403) {\n    throw new Error('Unauthorized');\n  }\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  // endpoint may return {user: {...}} or user object directly\n  return (_data$user = data.user) !== null && _data$user !== void 0 ? _data$user : data;\n}\nexport default {\n  login,\n  register,\n  logout,\n  getCurrentUser\n};","map":{"version":3,"names":["API","process","env","REACT_APP_API_URL","getAuthHeader","token","localStorage","getItem","Authorization","parseJson","res","text","JSON","parse","login","username","password","fetch","method","headers","body","stringify","data","ok","access","setItem","refresh","user","register","payload","logout","e","removeItem","getCurrentUser","_data$user","status","Error"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API = process.env.REACT_APP_API_URL || '';\r\n\r\nfunction getAuthHeader() {\r\n  const token = localStorage.getItem('access_token');\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseJson(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API}/api/auth/login/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  // store token(s) & user if provided\r\n  if (data.access) localStorage.setItem('access_token', data.access);\r\n  if (data.refresh) localStorage.setItem('refresh_token', data.refresh);\r\n  if (data.token) localStorage.setItem('access_token', data.token);\r\n  if (data.user) localStorage.setItem('user', JSON.stringify(data.user));\r\n  return data;\r\n}\r\n\r\nexport async function register(payload) {\r\n  const res = await fetch(`${API}/api/auth/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  if (data.access) localStorage.setItem('access_token', data.access);\r\n  if (data.refresh) localStorage.setItem('refresh_token', data.refresh);\r\n  if (data.user) localStorage.setItem('user', JSON.stringify(data.user));\r\n  return data;\r\n}\r\n\r\nexport async function logout() {\r\n  try {\r\n    await fetch(`${API}/api/auth/logout/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n    });\r\n  } catch (e) { /* ignore network errors */ }\r\n  localStorage.removeItem('access_token');\r\n  localStorage.removeItem('refresh_token');\r\n  localStorage.removeItem('user');\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const res = await fetch(`${API}/api/users/me/`, {\r\n    method: 'GET',\r\n    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n  });\r\n  if (res.status === 401 || res.status === 403) {\r\n    throw new Error('Unauthorized');\r\n  }\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  // endpoint may return {user: {...}} or user object directly\r\n  return data.user ?? data;\r\n}\r\n\r\nexport default {\r\n  login,\r\n  register,\r\n  logout,\r\n  getCurrentUser,\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}