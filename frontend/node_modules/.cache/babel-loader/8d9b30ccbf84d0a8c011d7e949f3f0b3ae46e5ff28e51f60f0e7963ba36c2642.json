{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import{useNavigate}from\"react-router-dom\";import{useCart}from\"../utils/CartContext\";import{useAuth}from\"../utils/AuthContext\";import{formatPrice}from\"../utils/formatPrice\";import{getCities,getDistrictsByCity,getWardsByDistrict}from\"../utils/locationsData\";import\"../assets/Checkout.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_BASE=process.env.REACT_APP_API_BASE||\"http://localhost:8000\";async function safeFetchJSON(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const res=await fetch(url,options);const ct=res.headers.get(\"content-type\")||\"\";if(!res.ok){const txt=await res.text().catch(()=>\"\");throw new Error(\"HTTP \".concat(res.status,\" - \").concat(txt.slice(0,200)));}if(!ct.includes(\"application/json\")){const txt=await res.text().catch(()=>\"\");throw new Error(\"Server trả về non-JSON: \"+txt.slice(0,200));}return res.json();}export default function Checkout(){const navigate=useNavigate();const{cartItems,clearCart,getCartTotal}=useCart();const{user}=useAuth();const[formData,setFormData]=useState({fullName:\"\",phone:\"\",email:\"\",address:\"\",city:\"\",district:\"\",ward:\"\",paymentMethod:\"cod\",notes:\"\"});const[errors,setErrors]=useState({});const[loading,setLoading]=useState(false);const[cities,setCities]=useState([]);const[districts,setDistricts]=useState([]);const[wards,setWards]=useState([]);useEffect(()=>{if(cartItems.length===0){navigate(\"/cart\");return;}if(user){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{fullName:user.full_name||\"\",phone:user.phone||\"\",email:user.email||\"\"}));const token=localStorage.getItem(\"access_token\");if(token){safeFetchJSON(\"\".concat(API_BASE,\"/api/user/address/\"),{headers:{Authorization:\"Bearer \".concat(token)}}).then(data=>{if(data&&(data.address||data.city)){setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{address:data.address||\"\",city:data.city||\"\",district:data.district||\"\",ward:data.ward||\"\"}));}}).catch(err=>console.error(\"Error loading address:\",err.message));}}setCities(getCities());},[cartItems,user,navigate]);useEffect(()=>{if(formData.city){setDistricts(getDistrictsByCity(formData.city));}else{setDistricts([]);setWards([]);}},[formData.city]);useEffect(()=>{if(formData.district){setWards(getWardsByDistrict(formData.district));}else{setWards([]);}},[formData.district]);const handleInputChange=e=>{const{name,value}=e.target;setFormData(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));if(errors[name]){setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:\"\"}));}};const validateForm=()=>{const newErrors={};if(!formData.fullName.trim())newErrors.fullName=\"Vui lòng nhập họ tên\";if(!formData.phone.trim())newErrors.phone=\"Vui lòng nhập số điện thoại\";else if(!/^[0-9]{10,11}$/.test(formData.phone.trim()))newErrors.phone=\"Số điện thoại không hợp lệ\";if(!formData.email.trim())newErrors.email=\"Vui lòng nhập email\";else if(!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email))newErrors.email=\"Email không hợp lệ\";if(!formData.address.trim())newErrors.address=\"Vui lòng nhập địa chỉ\";if(!formData.city)newErrors.city=\"Vui lòng chọn tỉnh/thành phố\";if(!formData.district)newErrors.district=\"Vui lòng chọn quận/huyện\";if(!formData.ward)newErrors.ward=\"Vui lòng chọn phường/xã\";setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleSubmit=async e=>{e.preventDefault();if(!validateForm())return;if(getCartTotal()<=0||cartItems.length===0)return;setLoading(true);try{var _result$order;const totalAmount=Math.round(Number(getCartTotal())||0);const orderData={full_name:formData.fullName,phone:formData.phone,email:formData.email,address:formData.address,ward:formData.ward,district:formData.district,city:formData.city,payment_method:formData.paymentMethod,notes:formData.notes,items:cartItems.map(item=>({product_id:item.id,quantity:item.quantity,color:item.color||\"\",size:item.size||\"\",price:Number(item.price)})),total_amount:totalAmount};const token=localStorage.getItem(\"access_token\");const headers=_objectSpread({\"Content-Type\":\"application/json\"},token?{Authorization:\"Bearer \".concat(token)}:{});if(formData.paymentMethod===\"vnpay\"){var _created$order,_created$order$total_;// 1) Create order first\nconst created=await safeFetchJSON(\"\".concat(API_BASE,\"/api/orders/\"),{method:\"POST\",headers,body:JSON.stringify(orderData)});if(!(created!==null&&created!==void 0&&created.success)||!(created!==null&&created!==void 0&&(_created$order=created.order)!==null&&_created$order!==void 0&&_created$order.order_id)){throw new Error((created===null||created===void 0?void 0:created.message)||\"Không tạo được đơn hàng\");}const orderId=created.order.order_id;const amount=Math.round(Number((_created$order$total_=created.order.total_amount)!==null&&_created$order$total_!==void 0?_created$order$total_:totalAmount));// 2) Request VNPay payment link with order_id + amount\nconst pay=await safeFetchJSON(\"\".concat(API_BASE,\"/api/payment/vnpay/\"),{method:\"POST\",headers,body:JSON.stringify({order_id:orderId,amount:created.order.total_amount})});if(pay!==null&&pay!==void 0&&pay.payment_url){// Clear cart after successful callback, not here\nwindow.location.href=pay.payment_url;return;}throw new Error((pay===null||pay===void 0?void 0:pay.message)||\"Không tạo được liên kết VNPay.\");}// COD or other methods\nconst result=await safeFetchJSON(\"\".concat(API_BASE,\"/api/orders/\"),{method:\"POST\",headers,body:JSON.stringify(orderData)});if(!result.success||!((_result$order=result.order)!==null&&_result$order!==void 0&&_result$order.order_id)){throw new Error(result.message||\"Đặt hàng thất bại\");}clearCart();navigate(\"/order-success\",{state:{orderId:result.order.order_id}});}catch(error){console.error(\"❌ Error submitting order:\",error);let errorMessage=\"Có lỗi xảy ra khi đặt hàng. Vui lòng thử lại!\";if(/Failed to fetch/i.test(error.message))errorMessage=\"Không thể kết nối đến server. Hãy kiểm tra backend.\";else if(/non-JSON|Server trả về non-JSON/i.test(error.message))errorMessage=\"Backend trả về dữ liệu không hợp lệ.\";else if(error.message)errorMessage=error.message;alert(errorMessage);}finally{setLoading(false);}};if(cartItems.length===0)return null;return/*#__PURE__*/_jsx(\"div\",{className:\"checkout-page\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-steps\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"step active\",children:\"1. Th\\xF4ng tin giao h\\xE0ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"step\",children:\"2. X\\xE1c nh\\u1EADn \\u0111\\u01A1n h\\xE0ng\"}),/*#__PURE__*/_jsx(\"div\",{className:\"step\",children:\"3. Ho\\xE0n t\\u1EA5t\"})]})]}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,className:\"checkout-form\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"checkout-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"shipping-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Th\\xF4ng tin giao h\\xE0ng\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"H\\u1ECD v\\xE0 t\\xEAn *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"fullName\",value:formData.fullName,onChange:handleInputChange,className:errors.fullName?\"error\":\"\",placeholder:\"Nh\\u1EADp h\\u1ECD v\\xE0 t\\xEAn\"}),errors.fullName&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.fullName})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",name:\"phone\",value:formData.phone,onChange:handleInputChange,className:errors.phone?\"error\":\"\",placeholder:\"Nh\\u1EADp s\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\"}),errors.phone&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.phone})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Email *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",name:\"email\",value:formData.email,onChange:handleInputChange,className:errors.email?\"error\":\"\",placeholder:\"Nh\\u1EADp email\"}),errors.email&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.email})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"T\\u1EC9nh/Th\\xE0nh ph\\u1ED1 *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"city\",value:formData.city,onChange:handleInputChange,className:errors.city?\"error\":\"\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Ch\\u1ECDn t\\u1EC9nh/th\\xE0nh ph\\u1ED1\"}),cities.map(c=>/*#__PURE__*/_jsx(\"option\",{value:c.id,children:c.name},c.id))]}),errors.city&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.city})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Qu\\u1EADn/Huy\\u1EC7n *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"district\",value:formData.district,onChange:handleInputChange,className:errors.district?\"error\":\"\",disabled:!formData.city,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Ch\\u1ECDn qu\\u1EADn/huy\\u1EC7n\"}),districts.map(d=>/*#__PURE__*/_jsx(\"option\",{value:d.id,children:d.name},d.id))]}),errors.district&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.district})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ph\\u01B0\\u1EDDng/X\\xE3 *\"}),/*#__PURE__*/_jsxs(\"select\",{name:\"ward\",value:formData.ward,onChange:handleInputChange,className:errors.ward?\"error\":\"\",disabled:!formData.district,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Ch\\u1ECDn ph\\u01B0\\u1EDDng/x\\xE3\"}),wards.map(w=>/*#__PURE__*/_jsx(\"option\",{value:w.id,children:w.name},w.id))]}),errors.ward&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.ward})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"\\u0110\\u1ECBa ch\\u1EC9 chi ti\\u1EBFt *\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"address\",value:formData.address,onChange:handleInputChange,className:errors.address?\"error\":\"\",placeholder:\"S\\u1ED1 nh\\xE0, t\\xEAn \\u0111\\u01B0\\u1EDDng...\"}),errors.address&&/*#__PURE__*/_jsx(\"span\",{className:\"error-message\",children:errors.address})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Ghi ch\\xFA\"}),/*#__PURE__*/_jsx(\"textarea\",{name:\"notes\",value:formData.notes,onChange:handleInputChange,placeholder:\"Ghi ch\\xFA th\\xEAm...\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-summary\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0110\\u01A1n h\\xE0ng c\\u1EE7a b\\u1EA1n\"}),/*#__PURE__*/_jsx(\"div\",{className:\"order-items\",children:cartItems.map((item,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"order-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:item.image||process.env.PUBLIC_URL+\"/default-product.png\",alt:item.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-info\",children:[/*#__PURE__*/_jsx(\"h4\",{children:item.name}),item.color&&/*#__PURE__*/_jsxs(\"span\",{children:[\"M\\xE0u: \",item.color]}),item.size&&/*#__PURE__*/_jsxs(\"span\",{children:[\"Size: \",item.size]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"S\\u1ED1 l\\u01B0\\u1EE3ng: \",item.quantity]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"item-price\",children:formatPrice(item.price*item.quantity)})]},idx))}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-method\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Ph\\u01B0\\u01A1ng th\\u1EE9c thanh to\\xE1n\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"payment-options\",children:[/*#__PURE__*/_jsxs(\"label\",{className:\"payment-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:\"cod\",checked:formData.paymentMethod===\"cod\",onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{children:\"Thanh to\\xE1n khi nh\\u1EADn h\\xE0ng (COD)\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"payment-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:\"vnpay\",checked:formData.paymentMethod===\"vnpay\",onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{children:\"Thanh to\\xE1n qua VNPay\"})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"payment-option\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"paymentMethod\",value:\"momo\",checked:formData.paymentMethod===\"momo\",onChange:handleInputChange}),/*#__PURE__*/_jsx(\"span\",{children:\"V\\xED MoMo\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"order-total\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\u1EA1m t\\xEDnh:\"}),/*#__PURE__*/_jsx(\"span\",{children:formatPrice(getCartTotal())})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-row\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Ph\\xED v\\u1EADn chuy\\u1EC3n:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"free-shipping\",children:\"Mi\\u1EC5n ph\\xED\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"total-row final\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"T\\u1ED5ng c\\u1ED9ng:\"}),/*#__PURE__*/_jsx(\"span\",{children:formatPrice(getCartTotal())})]})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"place-order-btn\",disabled:loading,children:loading?\"Đang xử lý...\":\"Đặt hàng\"})]})]})})]})});}","map":{"version":3,"names":["React","useState","useEffect","useNavigate","useCart","useAuth","formatPrice","getCities","getDistrictsByCity","getWardsByDistrict","jsx","_jsx","jsxs","_jsxs","API_BASE","process","env","REACT_APP_API_BASE","safeFetchJSON","url","options","arguments","length","undefined","res","fetch","ct","headers","get","ok","txt","text","catch","Error","concat","status","slice","includes","json","Checkout","navigate","cartItems","clearCart","getCartTotal","user","formData","setFormData","fullName","phone","email","address","city","district","ward","paymentMethod","notes","errors","setErrors","loading","setLoading","cities","setCities","districts","setDistricts","wards","setWards","prev","_objectSpread","full_name","token","localStorage","getItem","Authorization","then","data","err","console","error","message","handleInputChange","e","name","value","target","validateForm","newErrors","trim","test","Object","keys","handleSubmit","preventDefault","_result$order","totalAmount","Math","round","Number","orderData","payment_method","items","map","item","product_id","id","quantity","color","size","price","total_amount","_created$order","_created$order$total_","created","method","body","JSON","stringify","success","order","order_id","orderId","amount","pay","payment_url","window","location","href","result","state","errorMessage","alert","className","children","onSubmit","type","onChange","placeholder","c","disabled","d","w","idx","src","image","PUBLIC_URL","alt","checked"],"sources":["C:/VIET/PBL6/main/frontend/src/pages/Checkout.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useCart } from \"../utils/CartContext\";\r\nimport { useAuth } from \"../utils/AuthContext\";\r\nimport { formatPrice } from \"../utils/formatPrice\";\r\nimport {\r\n  getCities,\r\n  getDistrictsByCity,\r\n  getWardsByDistrict,\r\n} from \"../utils/locationsData\";\r\nimport \"../assets/Checkout.css\";\r\n\r\nconst API_BASE = process.env.REACT_APP_API_BASE || \"http://localhost:8000\";\r\n\r\nasync function safeFetchJSON(url, options = {}) {\r\n  const res = await fetch(url, options);\r\n  const ct = res.headers.get(\"content-type\") || \"\";\r\n  if (!res.ok) {\r\n    const txt = await res.text().catch(() => \"\");\r\n    throw new Error(`HTTP ${res.status} - ${txt.slice(0, 200)}`);\r\n  }\r\n  if (!ct.includes(\"application/json\")) {\r\n    const txt = await res.text().catch(() => \"\");\r\n    throw new Error(\"Server trả về non-JSON: \" + txt.slice(0, 200));\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport default function Checkout() {\r\n  const navigate = useNavigate();\r\n  const { cartItems, clearCart, getCartTotal } = useCart();\r\n  const { user } = useAuth();\r\n\r\n  const [formData, setFormData] = useState({\r\n    fullName: \"\",\r\n    phone: \"\",\r\n    email: \"\",\r\n    address: \"\",\r\n    city: \"\",\r\n    district: \"\",\r\n    ward: \"\",\r\n    paymentMethod: \"cod\",\r\n    notes: \"\",\r\n  });\r\n\r\n  const [errors, setErrors] = useState({});\r\n  const [loading, setLoading] = useState(false);\r\n  const [cities, setCities] = useState([]);\r\n  const [districts, setDistricts] = useState([]);\r\n  const [wards, setWards] = useState([]);\r\n\r\n  useEffect(() => {\r\n    if (cartItems.length === 0) {\r\n      navigate(\"/cart\");\r\n      return;\r\n    }\r\n\r\n    if (user) {\r\n      setFormData((prev) => ({\r\n        ...prev,\r\n        fullName: user.full_name || \"\",\r\n        phone: user.phone || \"\",\r\n        email: user.email || \"\",\r\n      }));\r\n\r\n      const token = localStorage.getItem(\"access_token\");\r\n      if (token) {\r\n        safeFetchJSON(`${API_BASE}/api/user/address/`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        })\r\n          .then((data) => {\r\n            if (data && (data.address || data.city)) {\r\n              setFormData((prev) => ({\r\n                ...prev,\r\n                address: data.address || \"\",\r\n                city: data.city || \"\",\r\n                district: data.district || \"\",\r\n                ward: data.ward || \"\",\r\n              }));\r\n            }\r\n          })\r\n          .catch((err) => console.error(\"Error loading address:\", err.message));\r\n      }\r\n    }\r\n\r\n    setCities(getCities());\r\n  }, [cartItems, user, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (formData.city) {\r\n      setDistricts(getDistrictsByCity(formData.city));\r\n    } else {\r\n      setDistricts([]);\r\n      setWards([]);\r\n    }\r\n  }, [formData.city]);\r\n\r\n  useEffect(() => {\r\n    if (formData.district) {\r\n      setWards(getWardsByDistrict(formData.district));\r\n    } else {\r\n      setWards([]);\r\n    }\r\n  }, [formData.district]);\r\n\r\n  const handleInputChange = (e) => {\r\n    const { name, value } = e.target;\r\n    setFormData((prev) => ({\r\n      ...prev,\r\n      [name]: value,\r\n    }));\r\n\r\n    if (errors[name]) {\r\n      setErrors((prev) => ({\r\n        ...prev,\r\n        [name]: \"\",\r\n      }));\r\n    }\r\n  };\r\n\r\n  const validateForm = () => {\r\n    const newErrors = {};\r\n    if (!formData.fullName.trim()) newErrors.fullName = \"Vui lòng nhập họ tên\";\r\n    if (!formData.phone.trim()) newErrors.phone = \"Vui lòng nhập số điện thoại\";\r\n    else if (!/^[0-9]{10,11}$/.test(formData.phone.trim()))\r\n      newErrors.phone = \"Số điện thoại không hợp lệ\";\r\n    if (!formData.email.trim()) newErrors.email = \"Vui lòng nhập email\";\r\n    else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(formData.email))\r\n      newErrors.email = \"Email không hợp lệ\";\r\n    if (!formData.address.trim()) newErrors.address = \"Vui lòng nhập địa chỉ\";\r\n    if (!formData.city) newErrors.city = \"Vui lòng chọn tỉnh/thành phố\";\r\n    if (!formData.district) newErrors.district = \"Vui lòng chọn quận/huyện\";\r\n    if (!formData.ward) newErrors.ward = \"Vui lòng chọn phường/xã\";\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!validateForm()) return;\r\n    if (getCartTotal() <= 0 || cartItems.length === 0) return;\r\n\r\n    setLoading(true);\r\n    try {\r\n      const totalAmount = Math.round(Number(getCartTotal()) || 0);\r\n\r\n      const orderData = {\r\n        full_name: formData.fullName,\r\n        phone: formData.phone,\r\n        email: formData.email,\r\n        address: formData.address,\r\n        ward: formData.ward,\r\n        district: formData.district,\r\n        city: formData.city,\r\n        payment_method: formData.paymentMethod,\r\n        notes: formData.notes,\r\n        items: cartItems.map((item) => ({\r\n          product_id: item.id,\r\n          quantity: item.quantity,\r\n          color: item.color || \"\",\r\n          size: item.size || \"\",\r\n          price: Number(item.price),\r\n        })),\r\n        total_amount: totalAmount,\r\n      };\r\n\r\n      const token = localStorage.getItem(\"access_token\");\r\n      const headers = {\r\n        \"Content-Type\": \"application/json\",\r\n        ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n      };\r\n\r\n      if (formData.paymentMethod === \"vnpay\") {\r\n        // 1) Create order first\r\n        const created = await safeFetchJSON(`${API_BASE}/api/orders/`, {\r\n          method: \"POST\",\r\n          headers,\r\n          body: JSON.stringify(orderData),\r\n        });\r\n        if (!created?.success || !created?.order?.order_id) {\r\n          throw new Error(created?.message || \"Không tạo được đơn hàng\");\r\n        }\r\n        const orderId = created.order.order_id;\r\n        const amount = Math.round(\r\n          Number(created.order.total_amount ?? totalAmount)\r\n        );\r\n\r\n        // 2) Request VNPay payment link with order_id + amount\r\n        const pay = await safeFetchJSON(`${API_BASE}/api/payment/vnpay/`, {\r\n          method: \"POST\",\r\n          headers,\r\n          body: JSON.stringify({ order_id: orderId, amount: created.order.total_amount }),\r\n        });\r\n        if (pay?.payment_url) {\r\n          // Clear cart after successful callback, not here\r\n          window.location.href = pay.payment_url;\r\n          return;\r\n        }\r\n        throw new Error(pay?.message || \"Không tạo được liên kết VNPay.\");\r\n      }\r\n\r\n      // COD or other methods\r\n      const result = await safeFetchJSON(`${API_BASE}/api/orders/`, {\r\n        method: \"POST\",\r\n        headers,\r\n        body: JSON.stringify(orderData),\r\n      });\r\n\r\n      if (!result.success || !result.order?.order_id) {\r\n        throw new Error(result.message || \"Đặt hàng thất bại\");\r\n      }\r\n\r\n      clearCart();\r\n      navigate(\"/order-success\", { state: { orderId: result.order.order_id } });\r\n    } catch (error) {\r\n      console.error(\"❌ Error submitting order:\", error);\r\n      let errorMessage = \"Có lỗi xảy ra khi đặt hàng. Vui lòng thử lại!\";\r\n      if (/Failed to fetch/i.test(error.message))\r\n        errorMessage = \"Không thể kết nối đến server. Hãy kiểm tra backend.\";\r\n      else if (/non-JSON|Server trả về non-JSON/i.test(error.message))\r\n        errorMessage = \"Backend trả về dữ liệu không hợp lệ.\";\r\n      else if (error.message) errorMessage = error.message;\r\n\r\n      alert(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  if (cartItems.length === 0) return null;\r\n\r\n  return (\r\n    <div className=\"checkout-page\">\r\n      <div className=\"checkout-container\">\r\n        <div className=\"checkout-header\">\r\n          <h1>Thanh toán</h1>\r\n          <div className=\"checkout-steps\">\r\n            <div className=\"step active\">1. Thông tin giao hàng</div>\r\n            <div className=\"step\">2. Xác nhận đơn hàng</div>\r\n            <div className=\"step\">3. Hoàn tất</div>\r\n          </div>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit} className=\"checkout-form\">\r\n          <div className=\"checkout-content\">\r\n            <div className=\"shipping-info\">\r\n              <h2>Thông tin giao hàng</h2>\r\n              {/* --- Form thông tin người nhận --- */}\r\n              {/* Họ tên, điện thoại */}\r\n              <div className=\"form-row\">\r\n                <div className=\"form-group\">\r\n                  <label>Họ và tên *</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    name=\"fullName\"\r\n                    value={formData.fullName}\r\n                    onChange={handleInputChange}\r\n                    className={errors.fullName ? \"error\" : \"\"}\r\n                    placeholder=\"Nhập họ và tên\"\r\n                  />\r\n                  {errors.fullName && (\r\n                    <span className=\"error-message\">{errors.fullName}</span>\r\n                  )}\r\n                </div>\r\n                <div className=\"form-group\">\r\n                  <label>Số điện thoại *</label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    name=\"phone\"\r\n                    value={formData.phone}\r\n                    onChange={handleInputChange}\r\n                    className={errors.phone ? \"error\" : \"\"}\r\n                    placeholder=\"Nhập số điện thoại\"\r\n                  />\r\n                  {errors.phone && (\r\n                    <span className=\"error-message\">{errors.phone}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Email */}\r\n              <div className=\"form-group\">\r\n                <label>Email *</label>\r\n                <input\r\n                  type=\"email\"\r\n                  name=\"email\"\r\n                  value={formData.email}\r\n                  onChange={handleInputChange}\r\n                  className={errors.email ? \"error\" : \"\"}\r\n                  placeholder=\"Nhập email\"\r\n                />\r\n                {errors.email && (\r\n                  <span className=\"error-message\">{errors.email}</span>\r\n                )}\r\n              </div>\r\n\r\n              {/* Địa chỉ */}\r\n              <div className=\"form-row\">\r\n                <div className=\"form-group\">\r\n                  <label>Tỉnh/Thành phố *</label>\r\n                  <select\r\n                    name=\"city\"\r\n                    value={formData.city}\r\n                    onChange={handleInputChange}\r\n                    className={errors.city ? \"error\" : \"\"}\r\n                  >\r\n                    <option value=\"\">Chọn tỉnh/thành phố</option>\r\n                    {cities.map((c) => (\r\n                      <option key={c.id} value={c.id}>\r\n                        {c.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {errors.city && (\r\n                    <span className=\"error-message\">{errors.city}</span>\r\n                  )}\r\n                </div>\r\n\r\n                <div className=\"form-group\">\r\n                  <label>Quận/Huyện *</label>\r\n                  <select\r\n                    name=\"district\"\r\n                    value={formData.district}\r\n                    onChange={handleInputChange}\r\n                    className={errors.district ? \"error\" : \"\"}\r\n                    disabled={!formData.city}\r\n                  >\r\n                    <option value=\"\">Chọn quận/huyện</option>\r\n                    {districts.map((d) => (\r\n                      <option key={d.id} value={d.id}>\r\n                        {d.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {errors.district && (\r\n                    <span className=\"error-message\">{errors.district}</span>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"form-group\">\r\n                <label>Phường/Xã *</label>\r\n                <select\r\n                  name=\"ward\"\r\n                  value={formData.ward}\r\n                  onChange={handleInputChange}\r\n                  className={errors.ward ? \"error\" : \"\"}\r\n                  disabled={!formData.district}\r\n                >\r\n                  <option value=\"\">Chọn phường/xã</option>\r\n                  {wards.map((w) => (\r\n                    <option key={w.id} value={w.id}>\r\n                      {w.name}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                {errors.ward && (\r\n                  <span className=\"error-message\">{errors.ward}</span>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"form-group\">\r\n                <label>Địa chỉ chi tiết *</label>\r\n                <textarea\r\n                  name=\"address\"\r\n                  value={formData.address}\r\n                  onChange={handleInputChange}\r\n                  className={errors.address ? \"error\" : \"\"}\r\n                  placeholder=\"Số nhà, tên đường...\"\r\n                />\r\n                {errors.address && (\r\n                  <span className=\"error-message\">{errors.address}</span>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"form-group\">\r\n                <label>Ghi chú</label>\r\n                <textarea\r\n                  name=\"notes\"\r\n                  value={formData.notes}\r\n                  onChange={handleInputChange}\r\n                  placeholder=\"Ghi chú thêm...\"\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            {/* --- Tóm tắt đơn hàng --- */}\r\n            <div className=\"order-summary\">\r\n              <h2>Đơn hàng của bạn</h2>\r\n              <div className=\"order-items\">\r\n                {cartItems.map((item, idx) => (\r\n                  <div key={idx} className=\"order-item\">\r\n                    <img\r\n                      src={\r\n                        item.image ||\r\n                        process.env.PUBLIC_URL + \"/default-product.png\"\r\n                      }\r\n                      alt={item.name}\r\n                    />\r\n                    <div className=\"item-info\">\r\n                      <h4>{item.name}</h4>\r\n                      {item.color && <span>Màu: {item.color}</span>}\r\n                      {item.size && <span>Size: {item.size}</span>}\r\n                      <div>Số lượng: {item.quantity}</div>\r\n                    </div>\r\n                    <div className=\"item-price\">\r\n                      {formatPrice(item.price * item.quantity)}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* --- Phương thức thanh toán --- */}\r\n              <div className=\"payment-method\">\r\n                <h3>Phương thức thanh toán</h3>\r\n                <div className=\"payment-options\">\r\n                  <label className=\"payment-option\">\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"paymentMethod\"\r\n                      value=\"cod\"\r\n                      checked={formData.paymentMethod === \"cod\"}\r\n                      onChange={handleInputChange}\r\n                    />\r\n                    <span>Thanh toán khi nhận hàng (COD)</span>\r\n                  </label>\r\n                  <label className=\"payment-option\">\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"paymentMethod\"\r\n                      value=\"vnpay\"\r\n                      checked={formData.paymentMethod === \"vnpay\"}\r\n                      onChange={handleInputChange}\r\n                    />\r\n                    <span>Thanh toán qua VNPay</span>\r\n                  </label>\r\n                  <label className=\"payment-option\">\r\n                    <input\r\n                      type=\"radio\"\r\n                      name=\"paymentMethod\"\r\n                      value=\"momo\"\r\n                      checked={formData.paymentMethod === \"momo\"}\r\n                      onChange={handleInputChange}\r\n                    />\r\n                    <span>Ví MoMo</span>\r\n                  </label>\r\n                </div>\r\n              </div>\r\n\r\n              {/* --- Tổng cộng --- */}\r\n              <div className=\"order-total\">\r\n                <div className=\"total-row\">\r\n                  <span>Tạm tính:</span>\r\n                  <span>{formatPrice(getCartTotal())}</span>\r\n                </div>\r\n                <div className=\"total-row\">\r\n                  <span>Phí vận chuyển:</span>\r\n                  <span className=\"free-shipping\">Miễn phí</span>\r\n                </div>\r\n                <div className=\"total-row final\">\r\n                  <span>Tổng cộng:</span>\r\n                  <span>{formatPrice(getCartTotal())}</span>\r\n                </div>\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                className=\"place-order-btn\"\r\n                disabled={loading}\r\n              >\r\n                {loading ? \"Đang xử lý...\" : \"Đặt hàng\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}