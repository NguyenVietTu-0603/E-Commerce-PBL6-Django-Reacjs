{"ast":null,"code":"import React,{useState,useEffect,useMemo,useRef}from'react';import{useParams,useNavigate,Link}from'react-router-dom';import{useCart}from'../utils/CartContext';import{useWishlist}from'../utils/WishlistContext';import{formatPrice}from'../utils/formatPrice';import'../assets/productDetail.css';import StarRating from'../components/StarRating';import{getProductReviews,getReviewEligibility,submitReview}from'../utils/reviewsApi';import Icon from'../components/Icon';import usePageTitle from'../hooks/usePageTitle';import flyToCart from'../utils/flyToCart';import{extractVariantOptions}from'../utils/variantUtils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ProductDetail(){var _product$category;const{id}=useParams();const navigate=useNavigate();const{addToCart}=useCart();const{findWishlistItem,toggleWishlist,isBuyer}=useWishlist();const[product,setProduct]=useState(null);const[loading,setLoading]=useState(true);const[mainImage,setMainImage]=useState('');const[color,setColor]=useState('');const[size,setSize]=useState('');const[qty,setQty]=useState(1);const[reviews,setReviews]=useState([]);const[avgRating,setAvgRating]=useState(0);const[ratingCount,setRatingCount]=useState(0);const[canReview,setCanReview]=useState(false);const[myReview,setMyReview]=useState(null);const[reviewRating,setReviewRating]=useState(0);const[reviewComment,setReviewComment]=useState('');const[reviewsLoading,setReviewsLoading]=useState(true);const[submitting,setSubmitting]=useState(false);const mainImageRef=useRef(null);usePageTitle((product===null||product===void 0?void 0:product.name)||'Chi tiết sản phẩm');useEffect(()=>{fetch(\"http://localhost:8000/api/products/\".concat(id,\"/\")).then(res=>{if(!res.ok)throw new Error('Product not found');return res.json();}).then(data=>{setProduct(data);setMainImage(data.image||'/default-product.png');setLoading(false);}).catch(err=>{console.error('Error loading product:',err);setLoading(false);});},[id]);useEffect(()=>{let cancelled=false;async function loadReviews(){try{setReviewsLoading(true);const[r1,r2]=await Promise.all([getProductReviews(id),getReviewEligibility(id).catch(()=>({can_review:false}))]);if(cancelled)return;setReviews(r1.reviews||[]);setAvgRating(Number(r1.average||0));setRatingCount(Number(r1.count||0));setCanReview(Boolean(r2.can_review));if(r2.my_review){setMyReview(r2.my_review);setReviewRating(r2.my_review.rating||0);setReviewComment(r2.my_review.comment||'');}else{setMyReview(null);setReviewRating(0);setReviewComment('');}if(r2.reason==='unauthenticated'){console.debug('Not logged in -> cannot review');}}finally{if(!cancelled)setReviewsLoading(false);}}loadReviews();return()=>{cancelled=true;};},[id]);const{colors,sizes}=useMemo(()=>extractVariantOptions(product||{}),[product]);useEffect(()=>{if(colors.length>0){setColor(prev=>prev&&colors.includes(prev)?prev:colors[0]);}else{setColor('');}if(sizes.length>0){setSize(prev=>prev&&sizes.includes(prev)?prev:sizes[0]);}else{setSize('');}},[colors,sizes]);async function handleSubmitReview(e){e.preventDefault();if(!reviewRating){alert('Vui lòng chọn số sao');return;}try{setSubmitting(true);const saved=await submitReview(id,{rating:reviewRating,comment:reviewComment});// Cập nhật trạng thái của chính review\nsetMyReview(saved);setCanReview(false);// Refresh danh sách + trung bình\nconst r=await getProductReviews(id);setReviews(r.reviews||[]);setAvgRating(Number(r.average||0));setRatingCount(Number(r.count||0));}catch(err){console.error(err);if(String(err).includes('401')||String(err.message||'').toLowerCase().includes('auth')){if(window.confirm('Bạn cần đăng nhập để đánh giá. Đi đến trang đăng nhập?')){// điều hướng sang login nếu app bạn có route này\nwindow.location.href='/login';}}else{alert('Gửi đánh giá thất bại. Vui lòng thử lại.');}}finally{setSubmitting(false);}}const wishlistEntry=useMemo(()=>{if(!product)return null;return findWishlistItem(product.id,color,size);},[product,color,size,findWishlistItem]);const handleToggleWishlist=async()=>{if(!product)return;if(!isBuyer){alert('Vui lòng đăng nhập bằng tài khoản người mua để sử dụng danh sách yêu thích.');return;}try{await toggleWishlist(product,{color,size});}catch(err){alert(err.message||'Không thể cập nhật danh sách yêu thích');}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"product-detail\",children:/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'80px 20px'},children:/*#__PURE__*/_jsx(\"p\",{children:\"\\u0110ang t\\u1EA3i s\\u1EA3n ph\\u1EA9m...\"})})});}if(!product){return/*#__PURE__*/_jsx(\"div\",{className:\"product-detail\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"pd-card\",style:{maxWidth:'600px',margin:'80px auto',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Kh\\xF4ng t\\xECm th\\u1EA5y s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(Link,{to:\"/\",style:{color:'var(--accent)'},children:\"Quay v\\u1EC1 trang ch\\u1EE7\"})})]})});}const vouchers=product.vouchers||[];const specs=product.specs||[];const description=product.description||'Chưa có mô tả cho sản phẩm này.';// Shop info\nconst shop={id:product.seller_id,name:product.seller_name||'Cửa hàng V-Market',avatar:'avatars/default-avatar.png',rating:product.rating||4.8,followers:product.followers||'150k'};function dec(){setQty(prev=>Math.max(1,prev-1));}function inc(){setQty(prev=>Math.min(prev+1,product.stock||999));}function handleAddToCart(e){if(e!==null&&e!==void 0&&e.preventDefault)e.preventDefault();if(colors.length>0&&!color){alert('Vui lòng chọn màu sắc');return;}if(sizes.length>0&&!size){alert('Vui lòng chọn kích thước');return;}addToCart(product,qty,{color,size});flyToCart(mainImageRef.current);alert(\"\\u0110\\xE3 th\\xEAm \".concat(qty,\" s\\u1EA3n ph\\u1EA9m v\\xE0o gi\\u1ECF h\\xE0ng\"));}function handleBuyNow(){if(colors.length>0&&!color){alert('Vui lòng chọn màu sắc');return;}if(sizes.length>0&&!size){alert('Vui lòng chọn kích thước');return;}addToCart(product,qty,{color,size});navigate('/cart');}function handleChatWithShop(){navigate(\"/chat/\".concat(shop.id,\"?product=\").concat(id));}function handleViewShop(){navigate(\"/shop/\".concat(shop.id));}return/*#__PURE__*/_jsxs(\"div\",{className:\"product-detail\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-detail-inner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"product-detail-media\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-main-media\",children:/*#__PURE__*/_jsx(\"img\",{ref:mainImageRef,src:mainImage,alt:product.name})}),product.images&&product.images.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"pd-thumbs\",children:product.images.map((img,i)=>/*#__PURE__*/_jsx(\"div\",{className:\"pd-thumb \".concat(mainImage===img?'active':''),onClick:()=>setMainImage(img),children:/*#__PURE__*/_jsx(\"img\",{src:img,alt:\"\".concat(product.name,\" \").concat(i+1)})},i))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"product-detail-info\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:12},children:[/*#__PURE__*/_jsx(\"h1\",{style:{flex:'1 1 auto',margin:0},children:product.name}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"wishlist-heart \".concat(wishlistEntry?'active':''),onClick:handleToggleWishlist,\"aria-label\":wishlistEntry?'Bỏ khỏi yêu thích':'Thêm vào yêu thích',style:{position:'static'},children:/*#__PURE__*/_jsx(Icon,{name:\"heart\",variant:wishlistEntry?'solid':'regular',size:22})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"product-detail-price\",children:formatPrice(product.price)}),/*#__PURE__*/_jsx(\"div\",{style:{margin:'8px 0 12px 0'},children:/*#__PURE__*/_jsx(StarRating,{value:avgRating,count:ratingCount,readOnly:true,showValue:true,size:16})}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-card\",children:[vouchers.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pd-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-label\",children:\"Voucher\"}),/*#__PURE__*/_jsx(\"div\",{children:vouchers.map(v=>/*#__PURE__*/_jsx(\"span\",{className:\"pd-chip\",children:v},v))})]}),product.shipping&&/*#__PURE__*/_jsxs(\"div\",{className:\"pd-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-label\",children:\"V\\u1EADn chuy\\u1EC3n\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"Giao \\u0111\\u1EBFn: \",/*#__PURE__*/_jsx(\"strong\",{children:product.shipping.area||'Toàn quốc'})]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'13px',color:'var(--text-muted)',marginTop:'4px'},children:[\"Ph\\xED ship: \",product.shipping.feeText||'Freeship đơn từ 0đ']})]})]}),colors.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pd-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-label\",children:\"M\\xE0u s\\u1EAFc\"}),/*#__PURE__*/_jsx(\"div\",{children:colors.map(c=>/*#__PURE__*/_jsx(\"button\",{className:\"pd-chip \".concat(color===c?'active':''),onClick:()=>setColor(c),children:c},c))})]}),sizes.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"pd-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-label\",children:\"K\\xEDch th\\u01B0\\u1EDBc\"}),/*#__PURE__*/_jsx(\"div\",{children:sizes.map(s=>/*#__PURE__*/_jsx(\"button\",{className:\"pd-chip \".concat(size===s?'active':''),onClick:()=>setSize(s),children:s},s))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"pd-label\",children:\"S\\u1ED1 l\\u01B0\\u1EE3ng\"}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"pd-qty\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:dec,\"aria-label\":\"Gi\\u1EA3m s\\u1ED1 l\\u01B0\\u1EE3ng\",children:/*#__PURE__*/_jsx(Icon,{name:\"minus\",size:12})}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:qty,readOnly:true}),/*#__PURE__*/_jsx(\"button\",{onClick:inc,\"aria-label\":\"T\\u0103ng s\\u1ED1 l\\u01B0\\u1EE3ng\",children:/*#__PURE__*/_jsx(Icon,{name:\"plus\",size:12})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"add-cart\",onClick:handleAddToCart,children:\"Th\\xEAm v\\xE0o gi\\u1ECF\"}),/*#__PURE__*/_jsx(\"button\",{className:\"buy-now\",onClick:handleBuyNow,children:\"Mua ngay\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-card shop-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"shop-avatar\",style:{backgroundImage:\"url(\".concat(shop.avatar,\")\"),backgroundSize:'cover',backgroundPosition:'center'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"shop-info\",children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 4px 0',fontSize:'16px',fontWeight:'700'},children:shop.name}),/*#__PURE__*/_jsxs(\"p\",{style:{margin:0,fontSize:'13px',color:'var(--text-muted)'},children:[\"\\u0110\\xE1nh gi\\xE1: \",/*#__PURE__*/_jsx(\"strong\",{children:shop.rating}),\" \\u2022 Ng\\u01B0\\u1EDDi theo d\\xF5i: \",/*#__PURE__*/_jsx(\"strong\",{children:shop.followers})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"shop-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleChatWithShop,children:\"Chat ngay\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleViewShop,children:\"Xem shop\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-meta\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pd-meta-row\",children:[/*#__PURE__*/_jsx(Icon,{name:\"box-open\",size:18,className:\"pd-meta-icon\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Danh m\\u1EE5c: \",((_product$category=product.category)===null||_product$category===void 0?void 0:_product$category.name)||'Chưa phân loại']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"pd-meta-row\",children:[/*#__PURE__*/_jsx(Icon,{name:\"chart-column\",size:18,className:\"pd-meta-icon\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"C\\xF2n l\\u1EA1i: \",product.stock||0,\" s\\u1EA3n ph\\u1EA9m\"]})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-sections\",children:[specs.length>0&&/*#__PURE__*/_jsxs(\"section\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Chi ti\\u1EBFt s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"div\",{className:\"specs\",children:specs.map((spec,i)=>/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pd-label\",children:[spec.label||spec[0],\":\"]}),/*#__PURE__*/_jsx(\"div\",{children:spec.value||spec[1]})]},i))})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"M\\xF4 t\\u1EA3 s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsx(\"div\",{className:\"pd-description\",children:/*#__PURE__*/_jsx(\"pre\",{children:description})})]}),/*#__PURE__*/_jsxs(\"section\",{className:\"detail-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u0110\\xE1nh gi\\xE1 s\\u1EA3n ph\\u1EA9m\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:16,marginBottom:12},children:[/*#__PURE__*/_jsx(StarRating,{value:avgRating,count:ratingCount,readOnly:true,showValue:true,size:20}),reviewsLoading?/*#__PURE__*/_jsx(\"span\",{children:\"\\u0110ang t\\u1EA3i \\u0111\\xE1nh gi\\xE1...\"}):null]}),(canReview||myReview)&&/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmitReview,className:\"pd-card\",style:{marginBottom:16},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:10},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:6},children:myReview?'Cập nhật đánh giá của bạn':'Đánh giá của bạn'}),/*#__PURE__*/_jsx(StarRating,{value:reviewRating,readOnly:false,onChange:setReviewRating,size:24})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:10},children:/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Chia s\\u1EBB c\\u1EA3m nh\\u1EADn v\\u1EC1 s\\u1EA3n ph\\u1EA9m...\",value:reviewComment,onChange:e=>setReviewComment(e.target.value),rows:4,style:{width:'100%',padding:10,borderRadius:6,border:'1px solid #e5e7eb'}})}),/*#__PURE__*/_jsx(\"button\",{className:\"add-cart\",disabled:submitting,children:submitting?'Đang gửi...':myReview?'Cập nhật đánh giá':'Gửi đánh giá'})]}),!canReview&&!reviewsLoading&&!myReview&&/*#__PURE__*/_jsxs(\"div\",{className:\"pd-card\",style:{color:'var(--text-muted)'},children:[\"Ch\\u1EC9 ng\\u01B0\\u1EDDi \\u0111\\xE3 mua s\\u1EA3n ph\\u1EA9m m\\u1EDBi c\\xF3 th\\u1EC3 \\u0111\\xE1nh gi\\xE1. \",/*#__PURE__*/_jsx(\"a\",{href:\"/login\",style:{color:'var(--accent)'},children:\"\\u0110\\u0103ng nh\\u1EADp\"})]}),reviews.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"pd-card\",style:{display:'grid',gap:12},children:reviews.map(rv=>/*#__PURE__*/_jsxs(\"div\",{style:{borderBottom:'1px solid #f0f0f0',paddingBottom:10},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8},children:[/*#__PURE__*/_jsx(\"strong\",{style:{fontSize:14},children:rv.user_name||'Người dùng'}),/*#__PURE__*/_jsx(StarRating,{value:rv.rating,readOnly:true,size:14}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:12,color:'var(--text-muted)'},children:rv.created_at?new Date(rv.created_at).toLocaleDateString('vi-VN'):''})]}),rv.comment?/*#__PURE__*/_jsx(\"div\",{style:{marginTop:6,whiteSpace:'pre-wrap'},children:rv.comment}):null]},rv.id||\"\".concat(rv.user_id,\"-\").concat(rv.created_at)))}):!reviewsLoading?/*#__PURE__*/_jsx(\"div\",{className:\"pd-card\",style:{color:'var(--text-muted)'},children:\"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1 n\\xE0o.\"}):null]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","useParams","useNavigate","Link","useCart","useWishlist","formatPrice","StarRating","getProductReviews","getReviewEligibility","submitReview","Icon","usePageTitle","flyToCart","extractVariantOptions","jsx","_jsx","jsxs","_jsxs","ProductDetail","_product$category","id","navigate","addToCart","findWishlistItem","toggleWishlist","isBuyer","product","setProduct","loading","setLoading","mainImage","setMainImage","color","setColor","size","setSize","qty","setQty","reviews","setReviews","avgRating","setAvgRating","ratingCount","setRatingCount","canReview","setCanReview","myReview","setMyReview","reviewRating","setReviewRating","reviewComment","setReviewComment","reviewsLoading","setReviewsLoading","submitting","setSubmitting","mainImageRef","name","fetch","concat","then","res","ok","Error","json","data","image","catch","err","console","error","cancelled","loadReviews","r1","r2","Promise","all","can_review","Number","average","count","Boolean","my_review","rating","comment","reason","debug","colors","sizes","length","prev","includes","handleSubmitReview","e","preventDefault","alert","saved","r","String","message","toLowerCase","window","confirm","location","href","wishlistEntry","handleToggleWishlist","className","children","style","textAlign","padding","maxWidth","margin","to","vouchers","specs","description","shop","seller_id","seller_name","avatar","followers","dec","Math","max","inc","min","stock","handleAddToCart","current","handleBuyNow","handleChatWithShop","handleViewShop","ref","src","alt","images","map","img","i","onClick","display","alignItems","gap","flex","type","position","variant","price","value","readOnly","showValue","v","shipping","area","fontSize","marginTop","feeText","c","s","backgroundImage","backgroundSize","backgroundPosition","fontWeight","category","spec","Fragment","label","marginBottom","onSubmit","onChange","placeholder","target","rows","width","borderRadius","border","disabled","rv","borderBottom","paddingBottom","user_name","created_at","Date","toLocaleDateString","whiteSpace","user_id"],"sources":["C:/VIET/PBL6/main/frontend/src/pages/ProductDetail.jsx"],"sourcesContent":["import React, { useState, useEffect, useMemo, useRef } from 'react';\r\nimport { useParams, useNavigate, Link } from 'react-router-dom';\r\nimport { useCart } from '../utils/CartContext';\r\nimport { useWishlist } from '../utils/WishlistContext';\r\nimport { formatPrice } from '../utils/formatPrice';\r\nimport '../assets/productDetail.css';\r\nimport StarRating from '../components/StarRating';\r\nimport { getProductReviews, getReviewEligibility, submitReview } from '../utils/reviewsApi';\r\nimport Icon from '../components/Icon';\r\nimport usePageTitle from '../hooks/usePageTitle';\r\nimport flyToCart from '../utils/flyToCart';\r\nimport { extractVariantOptions } from '../utils/variantUtils';\r\n\r\nexport default function ProductDetail() {\r\n    const { id } = useParams();\r\n    const navigate = useNavigate();\r\n    const { addToCart } = useCart();\r\n    const { findWishlistItem, toggleWishlist, isBuyer } = useWishlist();\r\n\r\n    const [product, setProduct] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n    const [mainImage, setMainImage] = useState('');\r\n    const [color, setColor] = useState('');\r\n    const [size, setSize] = useState('');\r\n    const [qty, setQty] = useState(1);\r\n    const [reviews, setReviews] = useState([]);\r\n    const [avgRating, setAvgRating] = useState(0);\r\n    const [ratingCount, setRatingCount] = useState(0);\r\n    const [canReview, setCanReview] = useState(false);\r\n    const [myReview, setMyReview] = useState(null);\r\n    const [reviewRating, setReviewRating] = useState(0);\r\n    const [reviewComment, setReviewComment] = useState('');\r\n    const [reviewsLoading, setReviewsLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const mainImageRef = useRef(null);\r\n\r\n    usePageTitle(product?.name || 'Chi tiết sản phẩm');\r\n\r\n    useEffect(() => {\r\n        fetch(`http://localhost:8000/api/products/${id}/`)\r\n            .then(res => {\r\n                if (!res.ok) throw new Error('Product not found');\r\n                return res.json();\r\n            })\r\n            .then(data => {\r\n                setProduct(data);\r\n                setMainImage(data.image || '/default-product.png');\r\n                setLoading(false);\r\n            })\r\n            .catch(err => {\r\n                console.error('Error loading product:', err);\r\n                setLoading(false);\r\n            });\r\n    }, [id]);\r\n\r\n    useEffect(() => {\r\n        let cancelled = false;\r\n        async function loadReviews() {\r\n            try {\r\n                setReviewsLoading(true);\r\n                const [r1, r2] = await Promise.all([\r\n                    getProductReviews(id),\r\n                    getReviewEligibility(id).catch(() => ({ can_review: false }))\r\n                ]);\r\n                if (cancelled) return;\r\n                setReviews(r1.reviews || []);\r\n                setAvgRating(Number(r1.average || 0));\r\n                setRatingCount(Number(r1.count || 0));\r\n                setCanReview(Boolean(r2.can_review));\r\n                if (r2.my_review) {\r\n                    setMyReview(r2.my_review);\r\n                    setReviewRating(r2.my_review.rating || 0);\r\n                    setReviewComment(r2.my_review.comment || '');\r\n                } else {\r\n                    setMyReview(null);\r\n                    setReviewRating(0);\r\n                    setReviewComment('');\r\n                }\r\n                if (r2.reason === 'unauthenticated') {\r\n                    console.debug('Not logged in -> cannot review');\r\n                }\r\n            } finally {\r\n                if (!cancelled) setReviewsLoading(false);\r\n            }\r\n        }\r\n        loadReviews();\r\n        return () => { cancelled = true; };\r\n    }, [id]);\r\n\r\n    const { colors, sizes } = useMemo(() => extractVariantOptions(product || {}), [product]);\r\n\r\n    useEffect(() => {\r\n        if (colors.length > 0) {\r\n            setColor(prev => (prev && colors.includes(prev) ? prev : colors[0]));\r\n        } else {\r\n            setColor('');\r\n        }\r\n\r\n        if (sizes.length > 0) {\r\n            setSize(prev => (prev && sizes.includes(prev) ? prev : sizes[0]));\r\n        } else {\r\n            setSize('');\r\n        }\r\n    }, [colors, sizes]);\r\n\r\n    async function handleSubmitReview(e) {\r\n        e.preventDefault();\r\n        if (!reviewRating) {\r\n            alert('Vui lòng chọn số sao');\r\n            return;\r\n        }\r\n        try {\r\n            setSubmitting(true);\r\n            const saved = await submitReview(id, { rating: reviewRating, comment: reviewComment });\r\n            // Cập nhật trạng thái của chính review\r\n            setMyReview(saved);\r\n            setCanReview(false);\r\n            // Refresh danh sách + trung bình\r\n            const r = await getProductReviews(id);\r\n            setReviews(r.reviews || []);\r\n            setAvgRating(Number(r.average || 0));\r\n            setRatingCount(Number(r.count || 0));\r\n        } catch (err) {\r\n            console.error(err);\r\n            if (String(err).includes('401') || String(err.message || '').toLowerCase().includes('auth')) {\r\n                if (window.confirm('Bạn cần đăng nhập để đánh giá. Đi đến trang đăng nhập?')) {\r\n                    // điều hướng sang login nếu app bạn có route này\r\n                    window.location.href = '/login';\r\n                }\r\n            } else {\r\n                alert('Gửi đánh giá thất bại. Vui lòng thử lại.');\r\n            }\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    }\r\n\r\n    const wishlistEntry = useMemo(() => {\r\n        if (!product) return null;\r\n        return findWishlistItem(product.id, color, size);\r\n    }, [product, color, size, findWishlistItem]);\r\n\r\n    const handleToggleWishlist = async () => {\r\n        if (!product) return;\r\n        if (!isBuyer) {\r\n            alert('Vui lòng đăng nhập bằng tài khoản người mua để sử dụng danh sách yêu thích.');\r\n            return;\r\n        }\r\n        try {\r\n            await toggleWishlist(product, { color, size });\r\n        } catch (err) {\r\n            alert(err.message || 'Không thể cập nhật danh sách yêu thích');\r\n        }\r\n    };\r\n\r\n    if (loading) {\r\n        return (\r\n            <div className=\"product-detail\">\r\n                <div style={{ textAlign: 'center', padding: '80px 20px' }}>\r\n                    <p>Đang tải sản phẩm...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!product) {\r\n        return (\r\n            <div className=\"product-detail\">\r\n                <div className=\"pd-card\" style={{ maxWidth: '600px', margin: '80px auto', textAlign: 'center' }}>\r\n                    <h2>Không tìm thấy sản phẩm</h2>\r\n                    <p><Link to=\"/\" style={{ color: 'var(--accent)' }}>Quay về trang chủ</Link></p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    const vouchers = product.vouchers || [];\r\n    const specs = product.specs || [];\r\n    const description = product.description || 'Chưa có mô tả cho sản phẩm này.';\r\n\r\n    // Shop info\r\n    const shop = {\r\n        id: product.seller_id,\r\n        name: product.seller_name || 'Cửa hàng V-Market',\r\n        avatar: 'avatars/default-avatar.png',\r\n        rating: product.rating || 4.8,\r\n        followers: product.followers || '150k'\r\n    };\r\n\r\n    function dec() {\r\n        setQty(prev => Math.max(1, prev - 1));\r\n    }\r\n\r\n    function inc() {\r\n        setQty(prev => Math.min(prev + 1, product.stock || 999));\r\n    }\r\n\r\n    function handleAddToCart(e) {\r\n        if (e?.preventDefault) e.preventDefault();\r\n        if (colors.length > 0 && !color) {\r\n            alert('Vui lòng chọn màu sắc');\r\n            return;\r\n        }\r\n        if (sizes.length > 0 && !size) {\r\n            alert('Vui lòng chọn kích thước');\r\n            return;\r\n        }\r\n        addToCart(product, qty, { color, size });\r\n        flyToCart(mainImageRef.current);\r\n        alert(`Đã thêm ${qty} sản phẩm vào giỏ hàng`);\r\n    }\r\n\r\n    function handleBuyNow() {\r\n        if (colors.length > 0 && !color) {\r\n            alert('Vui lòng chọn màu sắc');\r\n            return;\r\n        }\r\n        if (sizes.length > 0 && !size) {\r\n            alert('Vui lòng chọn kích thước');\r\n            return;\r\n        }\r\n        addToCart(product, qty, { color, size });\r\n        navigate('/cart');\r\n    }\r\n\r\n    function handleChatWithShop() {\r\n        navigate(`/chat/${shop.id}?product=${id}`);\r\n    }\r\n\r\n    function handleViewShop() {\r\n        navigate(`/shop/${shop.id}`);\r\n    }\r\n\r\n    return (\r\n        <div className=\"product-detail\">\r\n            <div className=\"product-detail-inner\">\r\n                {/* Left: Media */}\r\n                <div className=\"product-detail-media\">\r\n                    <div className=\"pd-main-media\">\r\n                        <img ref={mainImageRef} src={mainImage} alt={product.name} />\r\n                    </div>\r\n\r\n                    {product.images && product.images.length > 0 && (\r\n                        <div className=\"pd-thumbs\">\r\n                            {product.images.map((img, i) => (\r\n                                <div\r\n                                    key={i}\r\n                                    className={`pd-thumb ${mainImage === img ? 'active' : ''}`}\r\n                                    onClick={() => setMainImage(img)}\r\n                                >\r\n                                    <img src={img} alt={`${product.name} ${i + 1}`} />\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Right: Info */}\r\n                <div className=\"product-detail-info\">\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                        <h1 style={{ flex: '1 1 auto', margin: 0 }}>{product.name}</h1>\r\n                        <button\r\n                            type=\"button\"\r\n                            className={`wishlist-heart ${wishlistEntry ? 'active' : ''}`}\r\n                            onClick={handleToggleWishlist}\r\n                            aria-label={wishlistEntry ? 'Bỏ khỏi yêu thích' : 'Thêm vào yêu thích'}\r\n                            style={{ position: 'static' }}\r\n                        >\r\n                            <Icon\r\n                                name=\"heart\"\r\n                                variant={wishlistEntry ? 'solid' : 'regular'}\r\n                                size={22}\r\n                            />\r\n                        </button>\r\n                    </div>\r\n                    <div className=\"product-detail-price\">\r\n                        {formatPrice(product.price)}\r\n                    </div>\r\n\r\n                    {/* Rating summary line */}\r\n                    <div style={{ margin: '8px 0 12px 0' }}>\r\n                        <StarRating value={avgRating} count={ratingCount} readOnly showValue size={16} />\r\n                    </div>\r\n\r\n                    <div className=\"pd-card\">\r\n                        {/* Voucher */}\r\n                        {vouchers.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Voucher</div>\r\n                                <div>\r\n                                    {vouchers.map(v => (\r\n                                        <span key={v} className=\"pd-chip\">{v}</span>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Vận chuyển */}\r\n                        {product.shipping && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Vận chuyển</div>\r\n                                <div>\r\n                                    <div>Giao đến: <strong>{product.shipping.area || 'Toàn quốc'}</strong></div>\r\n                                    <div style={{ fontSize: '13px', color: 'var(--text-muted)', marginTop: '4px' }}>\r\n                                        Phí ship: {product.shipping.feeText || 'Freeship đơn từ 0đ'}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Color selection */}\r\n                        {colors.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Màu sắc</div>\r\n                                <div>\r\n                                    {colors.map(c => (\r\n                                        <button\r\n                                            key={c}\r\n                                            className={`pd-chip ${color === c ? 'active' : ''}`}\r\n                                            onClick={() => setColor(c)}\r\n                                        >\r\n                                            {c}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Size selection */}\r\n                        {sizes.length > 0 && (\r\n                            <div className=\"pd-row\">\r\n                                <div className=\"pd-label\">Kích thước</div>\r\n                                <div>\r\n                                    {sizes.map(s => (\r\n                                        <button\r\n                                            key={s}\r\n                                            className={`pd-chip ${size === s ? 'active' : ''}`}\r\n                                            onClick={() => setSize(s)}\r\n                                        >\r\n                                            {s}\r\n                                        </button>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Quantity */}\r\n                        <div className=\"pd-row\">\r\n                            <div className=\"pd-label\">Số lượng</div>\r\n                            <div>\r\n                                <div className=\"pd-qty\">\r\n                                    <button onClick={dec} aria-label=\"Giảm số lượng\">\r\n                                        <Icon name=\"minus\" size={12} />\r\n                                    </button>\r\n                                    <input type=\"number\" value={qty} readOnly />\r\n                                    <button onClick={inc} aria-label=\"Tăng số lượng\">\r\n                                        <Icon name=\"plus\" size={12} />\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Actions */}\r\n                        <div className=\"pd-actions\">\r\n                            <button className=\"add-cart\" onClick={handleAddToCart}>\r\n                                Thêm vào giỏ\r\n                            </button>\r\n                            <button className=\"buy-now\" onClick={handleBuyNow}>\r\n                                Mua ngay\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Shop card */}\r\n                    <div className=\"pd-card shop-card\">\r\n                        <div\r\n                            className=\"shop-avatar\"\r\n                            style={{\r\n                                backgroundImage: `url(${shop.avatar})`,\r\n                                backgroundSize: 'cover',\r\n                                backgroundPosition: 'center'\r\n                            }}\r\n                        />\r\n                        <div className=\"shop-info\">\r\n                            <h4 style={{ margin: '0 0 4px 0', fontSize: '16px', fontWeight: '700' }}>\r\n                                {shop.name}\r\n                            </h4>\r\n                            <p style={{ margin: 0, fontSize: '13px', color: 'var(--text-muted)' }}>\r\n                                Đánh giá: <strong>{shop.rating}</strong> • Người theo dõi: <strong>{shop.followers}</strong>\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"shop-actions\">\r\n                            <button onClick={handleChatWithShop}>Chat ngay</button>\r\n                            <button onClick={handleViewShop}>Xem shop</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Meta info */}\r\n                    <div className=\"pd-meta\">\r\n                        <div className=\"pd-meta-row\">\r\n                            <Icon name=\"box-open\" size={18} className=\"pd-meta-icon\" />\r\n                            <span>Danh mục: {product.category?.name || 'Chưa phân loại'}</span>\r\n                        </div>\r\n                        <div className=\"pd-meta-row\">\r\n                            <Icon name=\"chart-column\" size={18} className=\"pd-meta-icon\" />\r\n                            <span>Còn lại: {product.stock || 0} sản phẩm</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Sections below */}\r\n            <div className=\"detail-sections\">\r\n                {/* Specifications */}\r\n                {specs.length > 0 && (\r\n                    <section className=\"detail-section\">\r\n                        <h3>Chi tiết sản phẩm</h3>\r\n                        <div className=\"specs\">\r\n                            {specs.map((spec, i) => (\r\n                                <React.Fragment key={i}>\r\n                                    <div className=\"pd-label\">{spec.label || spec[0]}:</div>\r\n                                    <div>{spec.value || spec[1]}</div>\r\n                                </React.Fragment>\r\n                            ))}\r\n                        </div>\r\n                    </section>\r\n                )}\r\n\r\n                {/* Description */}\r\n                <section className=\"detail-section\">\r\n                    <h3>Mô tả sản phẩm</h3>\r\n                    <div className=\"pd-description\">\r\n                        <pre>{description}</pre>\r\n                    </div>\r\n                </section>\r\n\r\n                {/* Reviews */}\r\n                <section className=\"detail-section\">\r\n                    <h3>Đánh giá sản phẩm</h3>\r\n\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 16, marginBottom: 12 }}>\r\n                        <StarRating value={avgRating} count={ratingCount} readOnly showValue size={20} />\r\n                        {reviewsLoading ? <span>Đang tải đánh giá...</span> : null}\r\n                    </div>\r\n\r\n                    {(canReview || myReview) && (\r\n                        <form onSubmit={handleSubmitReview} className=\"pd-card\" style={{ marginBottom: 16 }}>\r\n                            <div style={{ marginBottom: 10 }}>\r\n                                <div style={{ marginBottom: 6 }}>{myReview ? 'Cập nhật đánh giá của bạn' : 'Đánh giá của bạn'}</div>\r\n                                <StarRating\r\n                                    value={reviewRating}\r\n                                    readOnly={false}\r\n                                    onChange={setReviewRating}\r\n                                    size={24}\r\n                                />\r\n                            </div>\r\n                            <div style={{ marginBottom: 10 }}>\r\n                                <textarea\r\n                                    placeholder=\"Chia sẻ cảm nhận về sản phẩm...\"\r\n                                    value={reviewComment}\r\n                                    onChange={(e) => setReviewComment(e.target.value)}\r\n                                    rows={4}\r\n                                    style={{ width: '100%', padding: 10, borderRadius: 6, border: '1px solid #e5e7eb' }}\r\n                                />\r\n                            </div>\r\n                            <button className=\"add-cart\" disabled={submitting}>\r\n                                {submitting ? 'Đang gửi...' : (myReview ? 'Cập nhật đánh giá' : 'Gửi đánh giá')}\r\n                            </button>\r\n                        </form>\r\n                    )}\r\n\r\n                    {!canReview && !reviewsLoading && !myReview && (\r\n                        <div className=\"pd-card\" style={{ color: 'var(--text-muted)' }}>\r\n                            Chỉ người đã mua sản phẩm mới có thể đánh giá. <a href=\"/login\" style={{ color: 'var(--accent)' }}>Đăng nhập</a>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Reviews list */}\r\n                    {reviews.length > 0 ? (\r\n                        <div className=\"pd-card\" style={{ display: 'grid', gap: 12 }}>\r\n                            {reviews.map((rv) => (\r\n                                <div key={rv.id || `${rv.user_id}-${rv.created_at}`} style={{ borderBottom: '1px solid #f0f0f0', paddingBottom: 10 }}>\r\n                                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                                        <strong style={{ fontSize: 14 }}>{rv.user_name || 'Người dùng'}</strong>\r\n                                        <StarRating value={rv.rating} readOnly size={14} />\r\n                                        <span style={{ fontSize: 12, color: 'var(--text-muted)' }}>\r\n                                            {rv.created_at ? new Date(rv.created_at).toLocaleDateString('vi-VN') : ''}\r\n                                        </span>\r\n                                    </div>\r\n                                    {rv.comment ? (\r\n                                        <div style={{ marginTop: 6, whiteSpace: 'pre-wrap' }}>{rv.comment}</div>\r\n                                    ) : null}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    ) : !reviewsLoading ? (\r\n                        <div className=\"pd-card\" style={{ color: 'var(--text-muted)' }}>\r\n                            Chưa có đánh giá nào.\r\n                        </div>\r\n                    ) : null}\r\n                </section>\r\n            </div>\r\n        </div>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}