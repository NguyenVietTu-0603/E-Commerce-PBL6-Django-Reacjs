{"ast":null,"code":"const API = process.env.REACT_APP_API_URL || '';\nfunction getToken() {\n  return localStorage.getItem('access_token') || null;\n}\nfunction getAuthHeader() {\n  const token = getToken();\n  return token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n}\nasync function parseJson(res) {\n  const text = await res.text();\n  try {\n    return JSON.parse(text);\n  } catch {\n    return text;\n  }\n}\nexport async function login(username, password) {\n  var _data$access, _data$tokens, _data$refresh, _data$tokens2, _ref, _data$user;\n  const res = await fetch(`${API}/api/users/token/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      username,\n      password\n    })\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  const access = (_data$access = data.access) !== null && _data$access !== void 0 ? _data$access : (_data$tokens = data.tokens) === null || _data$tokens === void 0 ? void 0 : _data$tokens.access;\n  const refresh = (_data$refresh = data.refresh) !== null && _data$refresh !== void 0 ? _data$refresh : (_data$tokens2 = data.tokens) === null || _data$tokens2 === void 0 ? void 0 : _data$tokens2.refresh;\n  const user = (_ref = (_data$user = data.user) !== null && _data$user !== void 0 ? _data$user : data.user_info) !== null && _ref !== void 0 ? _ref : null;\n  if (access) localStorage.setItem('access_token', access);\n  if (refresh) localStorage.setItem('refresh_token', refresh);\n  if (user) localStorage.setItem('user', JSON.stringify(user));\n  return {\n    access,\n    refresh,\n    user\n  };\n}\nexport async function register(payload) {\n  var _data$access2, _data$tokens3, _data$refresh2, _data$tokens4, _data$user2;\n  const res = await fetch(`${API}/api/auth/register/`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify(payload)\n  });\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  const access = (_data$access2 = data.access) !== null && _data$access2 !== void 0 ? _data$access2 : (_data$tokens3 = data.tokens) === null || _data$tokens3 === void 0 ? void 0 : _data$tokens3.access;\n  const refresh = (_data$refresh2 = data.refresh) !== null && _data$refresh2 !== void 0 ? _data$refresh2 : (_data$tokens4 = data.tokens) === null || _data$tokens4 === void 0 ? void 0 : _data$tokens4.refresh;\n  const user = (_data$user2 = data.user) !== null && _data$user2 !== void 0 ? _data$user2 : null;\n  if (access) localStorage.setItem('access_token', access);\n  if (refresh) localStorage.setItem('refresh_token', refresh);\n  if (user) localStorage.setItem('user', JSON.stringify(user));\n  return data;\n}\nexport async function logout() {\n  try {\n    await fetch(`${API}/api/auth/logout/`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...getAuthHeader()\n      }\n    });\n  } catch (e) {/* ignore */}\n\n  // Xóa sạch mọi token + user\n  const TOKEN_KEYS = ['access', 'access_token', 'accessToken', 'token', 'jwt', 'authToken', 'refresh', 'refresh_token'];\n  TOKEN_KEYS.forEach(k => localStorage.removeItem(k));\n  localStorage.removeItem('user');\n\n  // Xóa cookie session nếu có\n  document.cookie.split(\";\").forEach(c => {\n    document.cookie = c.replace(/^ +/, \"\").replace(/=.*/, \"=;expires=\" + new Date().toUTCString() + \";path=/\");\n  });\n}\nexport async function getCurrentUser() {\n  var _data$user3;\n  const res = await fetch(`${API}/api/users/me/`, {\n    headers: {\n      'Content-Type': 'application/json',\n      ...getAuthHeader()\n    }\n  });\n  if (res.status === 401 || res.status === 403) throw new Error('Unauthorized');\n  const data = await parseJson(res);\n  if (!res.ok) throw data;\n  return (_data$user3 = data.user) !== null && _data$user3 !== void 0 ? _data$user3 : data;\n}\nexport default {\n  login,\n  register,\n  logout,\n  getCurrentUser\n};","map":{"version":3,"names":["API","process","env","REACT_APP_API_URL","getToken","localStorage","getItem","getAuthHeader","token","Authorization","parseJson","res","text","JSON","parse","login","username","password","_data$access","_data$tokens","_data$refresh","_data$tokens2","_ref","_data$user","fetch","method","headers","body","stringify","data","ok","access","tokens","refresh","user","user_info","setItem","register","payload","_data$access2","_data$tokens3","_data$refresh2","_data$tokens4","_data$user2","logout","e","TOKEN_KEYS","forEach","k","removeItem","document","cookie","split","c","replace","Date","toUTCString","getCurrentUser","_data$user3","status","Error"],"sources":["C:/VIET/PBL6/main/frontend/src/utils/authService.js"],"sourcesContent":["const API = process.env.REACT_APP_API_URL || '';\r\n\r\nfunction getToken() {\r\n  return localStorage.getItem('access_token') || null;\r\n}\r\n\r\nfunction getAuthHeader() {\r\n  const token = getToken();\r\n  return token ? { Authorization: `Bearer ${token}` } : {};\r\n}\r\n\r\nasync function parseJson(res) {\r\n  const text = await res.text();\r\n  try { return JSON.parse(text); } catch { return text; }\r\n}\r\n\r\nexport async function login(username, password) {\r\n  const res = await fetch(`${API}/api/users/token/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ username, password }),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  const user = data.user ?? data.user_info ?? null;\r\n\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n\r\n  return { access, refresh, user };\r\n}\r\n\r\nexport async function register(payload) {\r\n  const res = await fetch(`${API}/api/auth/register/`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n\r\n  const access = data.access ?? data.tokens?.access;\r\n  const refresh = data.refresh ?? data.tokens?.refresh;\r\n  const user = data.user ?? null;\r\n\r\n  if (access) localStorage.setItem('access_token', access);\r\n  if (refresh) localStorage.setItem('refresh_token', refresh);\r\n  if (user) localStorage.setItem('user', JSON.stringify(user));\r\n\r\n  return data;\r\n}\r\n\r\nexport async function logout() {\r\n  try {\r\n    await fetch(`${API}/api/auth/logout/`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n    });\r\n  } catch (e) { /* ignore */ }\r\n\r\n  // Xóa sạch mọi token + user\r\n  const TOKEN_KEYS = ['access', 'access_token', 'accessToken', 'token', 'jwt', 'authToken', 'refresh', 'refresh_token'];\r\n  TOKEN_KEYS.forEach(k => localStorage.removeItem(k));\r\n  localStorage.removeItem('user');\r\n\r\n  // Xóa cookie session nếu có\r\n  document.cookie.split(\";\").forEach(c => {\r\n    document.cookie = c.replace(/^ +/, \"\").replace(/=.*/, \"=;expires=\" + new Date().toUTCString() + \";path=/\");\r\n  });\r\n}\r\n\r\nexport async function getCurrentUser() {\r\n  const res = await fetch(`${API}/api/users/me/`, {\r\n    headers: { 'Content-Type': 'application/json', ...getAuthHeader() },\r\n  });\r\n  if (res.status === 401 || res.status === 403) throw new Error('Unauthorized');\r\n  const data = await parseJson(res);\r\n  if (!res.ok) throw data;\r\n  return data.user ?? data;\r\n}\r\n\r\nexport default { login, register, logout, getCurrentUser };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}