{"ast":null,"code":"import _objectSpread from\"C:/VIET/PBL6/main/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useRef}from'react';import Icon from'./Icon';import{jsx as _jsx,Fragment as _Fragment,jsxs as _jsxs}from\"react/jsx-runtime\";export default function ImageSearchUpload(_ref){let{endpoint='http://localhost:8000/api/search/image/',k=48,label='Tìm bằng ảnh',onStart,onFinish,onResults,onError,className='btn btn-primary',icon='image'}=_ref;const inputRef=useRef(null);async function handleChange(e){var _e$target$files;const file=(_e$target$files=e.target.files)===null||_e$target$files===void 0?void 0:_e$target$files[0];if(!file)return;try{var _json;onStart===null||onStart===void 0?void 0:onStart();const fd=new FormData();fd.append('file',file);const res=await fetch(\"\".concat(endpoint,\"?k=\").concat(k),{method:'POST',body:fd});const text=await res.text();let json={};try{json=JSON.parse(text);}catch(_unused){/* HTML error page */}if(!res.ok)throw new Error(((_json=json)===null||_json===void 0?void 0:_json.error)||\"HTTP \".concat(res.status));const results=Array.isArray(json.results)?json.results:[];const mapped=results.map(p=>_objectSpread(_objectSpread({},p),{},{image:p.image||p.image_url||''}));onResults===null||onResults===void 0?void 0:onResults(mapped);}catch(err){console.error(err);onError===null||onError===void 0?void 0:onError(String((err===null||err===void 0?void 0:err.message)||'Tìm kiếm bằng ảnh thất bại.'));}finally{onFinish===null||onFinish===void 0?void 0:onFinish();if(inputRef.current)inputRef.current.value='';}}const content=typeof label==='string'?/*#__PURE__*/_jsxs(_Fragment,{children:[icon&&/*#__PURE__*/_jsx(Icon,{name:icon,size:16,style:{marginRight:6}}),/*#__PURE__*/_jsx(\"span\",{children:label})]}):label;return/*#__PURE__*/_jsxs(\"label\",{className:className,style:{cursor:'pointer',display:'inline-flex',alignItems:'center',gap:6},children:[content,/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"file\",accept:\"image/*\",style:{display:'none'},onChange:handleChange})]});}","map":{"version":3,"names":["React","useRef","Icon","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","ImageSearchUpload","_ref","endpoint","k","label","onStart","onFinish","onResults","onError","className","icon","inputRef","handleChange","e","_e$target$files","file","target","files","_json","fd","FormData","append","res","fetch","concat","method","body","text","json","JSON","parse","_unused","ok","Error","error","status","results","Array","isArray","mapped","map","p","_objectSpread","image","image_url","err","console","String","message","current","value","content","children","name","size","style","marginRight","cursor","display","alignItems","gap","ref","type","accept","onChange"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ImageSearchUpload.jsx"],"sourcesContent":["import React, { useRef } from 'react';\r\nimport Icon from './Icon';\r\n\r\nexport default function ImageSearchUpload({\r\n  endpoint = 'http://localhost:8000/api/search/image/',\r\n  k = 48,\r\n  label = 'Tìm bằng ảnh',\r\n  onStart,\r\n  onFinish,\r\n  onResults,\r\n  onError,\r\n  className = 'btn btn-primary',\r\n  icon = 'image'\r\n}) {\r\n  const inputRef = useRef(null);\r\n\r\n  async function handleChange(e) {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    try {\r\n      onStart?.();\r\n      const fd = new FormData();\r\n      fd.append('file', file);\r\n\r\n      const res = await fetch(`${endpoint}?k=${k}`, { method: 'POST', body: fd });\r\n      const text = await res.text();\r\n      let json = {};\r\n      try { json = JSON.parse(text); } catch { /* HTML error page */ }\r\n\r\n      if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);\r\n\r\n      const results = Array.isArray(json.results) ? json.results : [];\r\n      const mapped = results.map(p => ({ ...p, image: p.image || p.image_url || '' }));\r\n      onResults?.(mapped);\r\n    } catch (err) {\r\n      console.error(err);\r\n      onError?.(String(err?.message || 'Tìm kiếm bằng ảnh thất bại.'));\r\n    } finally {\r\n      onFinish?.();\r\n      if (inputRef.current) inputRef.current.value = '';\r\n    }\r\n  }\r\n\r\n  const content = typeof label === 'string'\r\n    ? (\r\n        <>\r\n          {icon && <Icon name={icon} size={16} style={{ marginRight: 6 }} />}\r\n          <span>{label}</span>\r\n        </>\r\n      )\r\n    : label;\r\n\r\n  return (\r\n    <label\r\n      className={className}\r\n      style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', gap: 6 }}\r\n    >\r\n      {content}\r\n      <input\r\n        ref={inputRef}\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        style={{ display: 'none' }}\r\n        onChange={handleChange}\r\n      />\r\n    </label>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}