{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\components\\\\ChatButton.jsx\",\n  _s = $RefreshSig$();\n// components/ChatButton.jsx\nimport React, { useState, useEffect } from 'react';\nimport PopupChat from './PopupChat';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000';\nexport default function ChatButton({\n  user\n}) {\n  _s();\n  const [conversations, setConversations] = useState([]);\n  const [openChats, setOpenChats] = useState([]);\n\n  // Fetch conversations\n  useEffect(() => {\n    const fetchChats = async () => {\n      try {\n        const token = localStorage.getItem('access_token');\n        if (!token) return;\n        const res = await fetch(`${API_BASE}/api/chat/my-conversations/`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\n        const data = await res.json();\n        setConversations(Array.isArray(data) ? data : []);\n      } catch (err) {\n        console.error('Failed to fetch chats', err);\n      }\n    };\n    if (user) fetchChats();\n  }, [user]);\n  const toggleChat = convId => {\n    setOpenChats(prev => prev.includes(convId) ? prev.filter(id => id !== convId) : [...prev, convId]);\n  };\n  if (!user) return null;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        bottom: 20,\n        right: 20,\n        display: 'flex',\n        flexDirection: 'column-reverse',\n        gap: 10,\n        zIndex: 9999\n      },\n      children: conversations.map(conv => {\n        // Hiển thị tên người chat\n        const name = (user.is_seller ? conv.buyer_name || `Buyer #${conv.buyer_id}` : conv.shop_name || `Shop #${conv.shop_id}`) || '?';\n        return /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleChat(conv.id),\n          title: name,\n          style: {\n            width: 50,\n            height: 50,\n            borderRadius: '50%',\n            background: '#2563eb',\n            color: '#fff',\n            border: 'none',\n            cursor: 'pointer',\n            fontWeight: 600,\n            fontSize: 18\n          },\n          children: name[0].toUpperCase()\n        }, conv.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 7\n    }, this), openChats.map(convId => {\n      const conv = conversations.find(c => c.id === convId);\n      if (!conv) return null;\n      const chatProps = user.is_seller ? {\n        shopId: user.user_id,\n        buyerId: conv.buyer_id\n      } : {\n        shopId: conv.shop_id,\n        buyerId: user.user_id\n      };\n      return /*#__PURE__*/_jsxDEV(PopupChat, {\n        conversationId: convId,\n        ...chatProps,\n        onClose: () => toggleChat(convId)\n      }, convId, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }, this);\n    })]\n  }, void 0, true);\n}\n_s(ChatButton, \"NVBGVYMy/iHuWEo8vRbZZRy6hxY=\");\n_c = ChatButton;\nvar _c;\n$RefreshReg$(_c, \"ChatButton\");","map":{"version":3,"names":["React","useState","useEffect","PopupChat","jsxDEV","_jsxDEV","Fragment","_Fragment","API_BASE","process","env","REACT_APP_API_BASE","ChatButton","user","_s","conversations","setConversations","openChats","setOpenChats","fetchChats","token","localStorage","getItem","res","fetch","headers","Authorization","ok","Error","status","data","json","Array","isArray","err","console","error","toggleChat","convId","prev","includes","filter","id","children","style","position","bottom","right","display","flexDirection","gap","zIndex","map","conv","name","is_seller","buyer_name","buyer_id","shop_name","shop_id","onClick","title","width","height","borderRadius","background","color","border","cursor","fontWeight","fontSize","toUpperCase","fileName","_jsxFileName","lineNumber","columnNumber","find","c","chatProps","shopId","user_id","buyerId","conversationId","onClose","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ChatButton.jsx"],"sourcesContent":["// components/ChatButton.jsx\r\nimport React, { useState, useEffect } from 'react';\r\nimport PopupChat from './PopupChat';\r\n\r\nconst API_BASE = process.env.REACT_APP_API_BASE || 'http://localhost:8000';\r\n\r\nexport default function ChatButton({ user }) {\r\n  const [conversations, setConversations] = useState([]);\r\n  const [openChats, setOpenChats] = useState([]);\r\n\r\n  // Fetch conversations\r\n  useEffect(() => {\r\n    const fetchChats = async () => {\r\n      try {\r\n        const token = localStorage.getItem('access_token');\r\n        if (!token) return;\r\n        const res = await fetch(`${API_BASE}/api/chat/my-conversations/`, {\r\n          headers: { Authorization: `Bearer ${token}` }\r\n        });\r\n        if (!res.ok) throw new Error(`HTTP ${res.status}`);\r\n        const data = await res.json();\r\n        setConversations(Array.isArray(data) ? data : []);\r\n      } catch (err) {\r\n        console.error('Failed to fetch chats', err);\r\n      }\r\n    };\r\n\r\n    if (user) fetchChats();\r\n  }, [user]);\r\n\r\n  const toggleChat = (convId) => {\r\n    setOpenChats(prev => prev.includes(convId) ? prev.filter(id => id !== convId) : [...prev, convId]);\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  return (\r\n    <>\r\n      {/* Icon Messenger góc phải dưới */}\r\n      <div style={{\r\n        position: 'fixed',\r\n        bottom: 20,\r\n        right: 20,\r\n        display: 'flex',\r\n        flexDirection: 'column-reverse',\r\n        gap: 10,\r\n        zIndex: 9999\r\n      }}>\r\n        {conversations.map(conv => {\r\n          // Hiển thị tên người chat\r\n          const name = (user.is_seller\r\n            ? conv.buyer_name || `Buyer #${conv.buyer_id}`\r\n            : conv.shop_name || `Shop #${conv.shop_id}`) || '?';\r\n\r\n          return (\r\n            <button\r\n              key={conv.id}\r\n              onClick={() => toggleChat(conv.id)}\r\n              title={name}\r\n              style={{\r\n                width: 50,\r\n                height: 50,\r\n                borderRadius: '50%',\r\n                background: '#2563eb',\r\n                color: '#fff',\r\n                border: 'none',\r\n                cursor: 'pointer',\r\n                fontWeight: 600,\r\n                fontSize: 18\r\n              }}\r\n            >\r\n              {name[0].toUpperCase()}\r\n            </button>\r\n          );\r\n        })}\r\n      </div>\r\n\r\n      {/* Popup chat */}\r\n      {openChats.map(convId => {\r\n        const conv = conversations.find(c => c.id === convId);\r\n        if (!conv) return null;\r\n\r\n        const chatProps = user.is_seller\r\n          ? { shopId: user.user_id, buyerId: conv.buyer_id }\r\n          : { shopId: conv.shop_id, buyerId: user.user_id };\r\n\r\n        return (\r\n          <PopupChat\r\n            key={convId}\r\n            conversationId={convId}\r\n            {...chatProps}\r\n            onClose={() => toggleChat(convId)}\r\n          />\r\n        );\r\n      })}\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}