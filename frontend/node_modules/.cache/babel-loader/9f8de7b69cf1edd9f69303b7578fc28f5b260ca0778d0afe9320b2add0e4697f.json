{"ast":null,"code":"var _jsxFileName = \"C:\\\\VIET\\\\PBL6\\\\main\\\\frontend\\\\src\\\\components\\\\ImageSearchUpload.jsx\",\n  _s = $RefreshSig$();\nimport React, { useRef } from 'react';\nimport Icon from './Icon';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function ImageSearchUpload({\n  endpoint = 'http://localhost:8000/api/search/image/',\n  k = 48,\n  label = 'Tìm bằng ảnh',\n  onStart,\n  onFinish,\n  onResults,\n  onError,\n  className = 'btn btn-primary'\n}) {\n  _s();\n  const inputRef = useRef(null);\n  async function handleChange(e) {\n    var _e$target$files;\n    const file = (_e$target$files = e.target.files) === null || _e$target$files === void 0 ? void 0 : _e$target$files[0];\n    if (!file) return;\n    try {\n      var _json;\n      onStart === null || onStart === void 0 ? void 0 : onStart();\n      const fd = new FormData();\n      fd.append('file', file);\n      const res = await fetch(`${endpoint}?k=${k}`, {\n        method: 'POST',\n        body: fd\n      });\n      const text = await res.text();\n      let json = {};\n      try {\n        json = JSON.parse(text);\n      } catch {/* HTML error page */}\n      if (!res.ok) throw new Error(((_json = json) === null || _json === void 0 ? void 0 : _json.error) || `HTTP ${res.status}`);\n      const results = Array.isArray(json.results) ? json.results : [];\n      const mapped = results.map(p => ({\n        ...p,\n        image: p.image || p.image_url || ''\n      }));\n      onResults === null || onResults === void 0 ? void 0 : onResults(mapped);\n    } catch (err) {\n      console.error(err);\n      onError === null || onError === void 0 ? void 0 : onError(String((err === null || err === void 0 ? void 0 : err.message) || 'Tìm kiếm bằng ảnh thất bại.'));\n    } finally {\n      onFinish === null || onFinish === void 0 ? void 0 : onFinish();\n      if (inputRef.current) inputRef.current.value = '';\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"label\", {\n    className: className,\n    style: {\n      cursor: 'pointer',\n      display: 'inline-flex',\n      alignItems: 'center',\n      gap: 8\n    },\n    children: [typeof label === 'string' ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Icon, {\n        name: \"image_search\",\n        size: 20,\n        \"aria-hidden\": true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        children: label\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true) : label, /*#__PURE__*/_jsxDEV(\"input\", {\n      ref: inputRef,\n      type: \"file\",\n      accept: \"image/*\",\n      style: {\n        display: 'none'\n      },\n      onChange: handleChange\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 44,\n    columnNumber: 5\n  }, this);\n}\n_s(ImageSearchUpload, \"iD9XNNsNOlNDckBemnvlLS+aHYk=\");\n_c = ImageSearchUpload;\nvar _c;\n$RefreshReg$(_c, \"ImageSearchUpload\");","map":{"version":3,"names":["React","useRef","Icon","jsxDEV","_jsxDEV","Fragment","_Fragment","ImageSearchUpload","endpoint","k","label","onStart","onFinish","onResults","onError","className","_s","inputRef","handleChange","e","_e$target$files","file","target","files","_json","fd","FormData","append","res","fetch","method","body","text","json","JSON","parse","ok","Error","error","status","results","Array","isArray","mapped","map","p","image","image_url","err","console","String","message","current","value","style","cursor","display","alignItems","gap","children","name","size","fileName","_jsxFileName","lineNumber","columnNumber","ref","type","accept","onChange","_c","$RefreshReg$"],"sources":["C:/VIET/PBL6/main/frontend/src/components/ImageSearchUpload.jsx"],"sourcesContent":["import React, { useRef } from 'react';\r\nimport Icon from './Icon';\r\n\r\nexport default function ImageSearchUpload({\r\n  endpoint = 'http://localhost:8000/api/search/image/',\r\n  k = 48,\r\n  label = 'Tìm bằng ảnh',\r\n  onStart,\r\n  onFinish,\r\n  onResults,\r\n  onError,\r\n  className = 'btn btn-primary',\r\n}) {\r\n  const inputRef = useRef(null);\r\n\r\n  async function handleChange(e) {\r\n    const file = e.target.files?.[0];\r\n    if (!file) return;\r\n    try {\r\n      onStart?.();\r\n      const fd = new FormData();\r\n      fd.append('file', file);\r\n\r\n      const res = await fetch(`${endpoint}?k=${k}`, { method: 'POST', body: fd });\r\n      const text = await res.text();\r\n      let json = {};\r\n      try { json = JSON.parse(text); } catch { /* HTML error page */ }\r\n\r\n      if (!res.ok) throw new Error(json?.error || `HTTP ${res.status}`);\r\n\r\n      const results = Array.isArray(json.results) ? json.results : [];\r\n      const mapped = results.map(p => ({ ...p, image: p.image || p.image_url || '' }));\r\n      onResults?.(mapped);\r\n    } catch (err) {\r\n      console.error(err);\r\n      onError?.(String(err?.message || 'Tìm kiếm bằng ảnh thất bại.'));\r\n    } finally {\r\n      onFinish?.();\r\n      if (inputRef.current) inputRef.current.value = '';\r\n    }\r\n  }\r\n\r\n  return (\r\n    <label className={className} style={{ cursor: 'pointer', display: 'inline-flex', alignItems: 'center', gap: 8 }}>\r\n      {typeof label === 'string' ? (\r\n        <>\r\n          <Icon name=\"image_search\" size={20} aria-hidden />\r\n          <span>{label}</span>\r\n        </>\r\n      ) : (\r\n        label\r\n      )}\r\n      <input\r\n        ref={inputRef}\r\n        type=\"file\"\r\n        accept=\"image/*\"\r\n        style={{ display: 'none' }}\r\n        onChange={handleChange}\r\n      />\r\n    </label>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}